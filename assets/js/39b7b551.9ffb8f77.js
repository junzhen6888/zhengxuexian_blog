"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3957],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=n.createContext({}),u=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(r),h=o,d=c["".concat(i,".").concat(h)]||c[h]||m[h]||a;return r?n.createElement(d,l(l({ref:t},p),{},{components:r})):n.createElement(d,l({ref:t},p))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=c;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,l[1]=s;for(var u=2;u<a;u++)l[u]=r[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},92124:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var n=r(87462),o=(r(67294),r(3905));const a={last_update:{author:"\u90d1\u5b66\u8d24"}},l="1.2 Prometheus \u5b89\u88c5",s={unversionedId:"prometheus/Basic/1.2-prometheus-install",id:"prometheus/Basic/1.2-prometheus-install",title:"1.2 Prometheus \u5b89\u88c5",description:"Prometheus\u662f\u4e00\u4e2a\u76d1\u63a7\u5e73\u53f0\uff0c\u5b83\u901a\u8fc7\u6293\u53d6\u8fd9\u4e9b\u76ee\u6807\u4e3b\u673a\u4e0a\u91c7\u96c6\u5668\u66b4\u9732\u7684\u6307\u6807\u6765\u5c55\u793a\u76d1\u63a7\u6570\u636e\u3002\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u5b89\u88c5\u3001\u914d\u7f6e\u548c\u76d1\u63a7 Prometheus\u3002\u4f60\u9700\u8981\u4e0b\u8f7d\u5b89\u88c5 Prometheus \u5e76\u4e14\u5b89\u88c5 Exporter\uff0c\u8fd9\u4e9b\u5de5\u5177\u91c7\u96c6\u4e86\u4e3b\u673a\u548c\u5bf9\u5e94\u670d\u52a1\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a Exporter \u662f Prometheus \u672c\u8eab\uff0c\u5b83\u63d0\u4f9b\u4e86\u5173\u4e8e\u5185\u5b58\u4f7f\u7528\u3001\u5783\u573e\u6536\u96c6\u7b49\u5404\u79cd\u5404\u6837\u7684\u4e3b\u673a\u7ea7\u6307\u6807\u3002",source:"@site/wiki/ops/prometheus/01-Basic/1.2-prometheus-install.md",sourceDirName:"prometheus/01-Basic",slug:"/prometheus/Basic/1.2-prometheus-install",permalink:"/zhengxuexian_blog/ops/prometheus/Basic/1.2-prometheus-install",draft:!1,tags:[],version:"current",lastUpdatedBy:"\u90d1\u5b66\u8d24",lastUpdatedAt:1661930328,formattedLastUpdatedAt:"2022\u5e748\u670831\u65e5",frontMatter:{last_update:{author:"\u90d1\u5b66\u8d24"}},sidebar:"tutorialSidebar",previous:{title:"1.1 Prometheus \u7b80\u4ecb",permalink:"/zhengxuexian_blog/ops/prometheus/Basic/1.1-prometheus-introduction"},next:{title:"1.3 \u65f6\u5e8f\u6570\u636e\u5e93\u4e3a\u4ec0\u4e48\u9009 Prometheus",permalink:"/zhengxuexian_blog/ops/prometheus/Basic/1.3-tsdb-comparison"}},i={},u=[{value:"\u4e0b\u8f7d Prometheus",id:"\u4e0b\u8f7d-prometheus",level:2},{value:"\u914d\u7f6e Prometheus",id:"\u914d\u7f6e-prometheus",level:2},{value:"\u542f\u52a8 Prometheus",id:"\u542f\u52a8-prometheus",level:2},{value:"\u4f7f\u7528\u6d4f\u89c8\u5668\u67e5\u770b",id:"\u4f7f\u7528\u6d4f\u89c8\u5668\u67e5\u770b",level:2},{value:"\u63a8\u8350\u76ee\u5f55\u7ed3\u6784",id:"\u63a8\u8350\u76ee\u5f55\u7ed3\u6784",level:2}],p={toc:u};function m(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"12-prometheus-\u5b89\u88c5"},"1.2 Prometheus \u5b89\u88c5"),(0,o.kt)("p",null,"Prometheus\u662f\u4e00\u4e2a\u76d1\u63a7\u5e73\u53f0\uff0c\u5b83\u901a\u8fc7\u6293\u53d6\u8fd9\u4e9b\u76ee\u6807\u4e3b\u673a\u4e0a\u91c7\u96c6\u5668\u66b4\u9732\u7684\u6307\u6807\u6765\u5c55\u793a\u76d1\u63a7\u6570\u636e\u3002\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u5b89\u88c5\u3001\u914d\u7f6e\u548c\u76d1\u63a7 Prometheus\u3002\u4f60\u9700\u8981\u4e0b\u8f7d\u5b89\u88c5 Prometheus \u5e76\u4e14\u5b89\u88c5 Exporter\uff0c\u8fd9\u4e9b\u5de5\u5177\u91c7\u96c6\u4e86\u4e3b\u673a\u548c\u5bf9\u5e94\u670d\u52a1\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a Exporter \u662f Prometheus \u672c\u8eab\uff0c\u5b83\u63d0\u4f9b\u4e86\u5173\u4e8e\u5185\u5b58\u4f7f\u7528\u3001\u5783\u573e\u6536\u96c6\u7b49\u5404\u79cd\u5404\u6837\u7684\u4e3b\u673a\u7ea7\u6307\u6807\u3002"),(0,o.kt)("h2",{id:"\u4e0b\u8f7d-prometheus"},"\u4e0b\u8f7d Prometheus"),(0,o.kt)("p",null,"\u9996\u5148\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684 Prometheus \u7136\u540e\u89e3\u538b\uff0c\u4e0b\u8f7d\u5730\u5740\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/download"},"https://prometheus.io/download")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"tar xvfz prometheus-*.tar.gz\ncd prometheus-*\n")),(0,o.kt)("p",null,"Prometheus \u670d\u52a1\u662f\u4e00\u4e2a\u540d\u4e3a Prometheus( \u6216Windows\u7cfb\u7edf\u4e0a\u7684 prometheus.exe)\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5e76\u901a\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"--help")," \u53c2\u6570\u9009\u9879\u6765\u67e5\u770b\u5e2e\u52a9\uff0c\u5982\u4e0b\u6240\u793a\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ ./prometheus --help\nusage: prometheus [<flags>]\n\nThe Prometheus monitoring server\n\nFlags:\n  -h, --help                     Show context-sensitive help (also try --help-long and --help-man).\n      --version                  Show application version.\n      --config.file="prometheus.yml"\n                                 Prometheus configuration file path.\n      --web.listen-address="0.0.0.0:9090"\n                                 Address to listen on for UI, API, and telemetry.\n      --web.read-timeout=5m      Maximum duration before timing out read of the request, and closing idle connections.\n      --web.max-connections=512  Maximum number of simultaneous connections.\n      --web.external-url=<URL>   The URL under which Prometheus is externally reachable (for example, if Prometheus is served via a reverse\n                                 proxy). Used for generating relative and absolute links back to Prometheus itself. If the URL has a path\n                                 portion, it will be used to prefix all HTTP endpoints served by Prometheus. If omitted, relevant URL\n                                 components will be derived automatically.\n      --web.route-prefix=<path>  Prefix for the internal routes of web endpoints. Defaults to path of --web.external-url.\n      --web.user-assets=<path>   Path to static asset directory, available at /user.\n      --web.enable-lifecycle     Enable shutdown and reload via HTTP request.\n      --web.enable-admin-api     Enable API endpoints for admin control actions.\n      --web.console.templates="consoles"\n                                 Path to the console template directory, available at /consoles.\n      --web.console.libraries="console_libraries"\n                                 Path to the console library directory.\n      --web.page-title="Prometheus Time Series Collection and Processing Server"\n                                 Document title of Prometheus instance.\n      --storage.tsdb.path="data/"\n                                 Base path for metrics storage.\n      --storage.tsdb.retention=15d\n                                 How long to retain samples in storage.\n      --storage.tsdb.no-lockfile\n                                 Do not create lockfile in data directory.\n      --storage.remote.flush-deadline=<duration>\n                                 How long to wait flushing sample on shutdown or config reload.\n      --storage.remote.read-sample-limit=5e7\n                                 Maximum overall number of samples to return via the remote read interface, in a single query. 0 means no\n                                 limit.\n      --storage.remote.read-concurrent-limit=10\n                                 Maximum number of concurrent remote read calls. 0 means no limit.\n      --rules.alert.for-outage-tolerance=1h\n                                 Max time to tolerate prometheus outage for restoring \'for\' state of alert.\n      --rules.alert.for-grace-period=10m\n                                 Minimum duration between alert and restored \'for\' state. This is maintained only for alerts with configured\n                                 \'for\' time greater than grace period.\n      --rules.alert.resend-delay=1m\n                                 Minimum amount of time to wait before resending an alert to Alertmanager.\n      --alertmanager.notification-queue-capacity=10000\n                                 The capacity of the queue for pending Alertmanager notifications.\n      --alertmanager.timeout=10s\n                                 Timeout for sending alerts to Alertmanager.\n      --query.lookback-delta=5m  The delta difference allowed for retrieving metrics during expression evaluations.\n      --query.timeout=2m         Maximum time a query may take before being aborted.\n      --query.max-concurrency=20\n                                 Maximum number of queries executed concurrently.\n      --query.max-samples=50000000\n                                 Maximum number of samples a single query can load into memory. Note that queries will fail if they would\n                                 load more samples than this into memory, so this also limits the number of samples a query can return.\n      --log.level=info           Only log messages with the given severity or above. One of: [debug, info, warn, error]\n      --log.format=logfmt        Output format of log messages. One of: [logfmt, json]\n\n')),(0,o.kt)("h2",{id:"\u914d\u7f6e-prometheus"},"\u914d\u7f6e Prometheus"),(0,o.kt)("p",null,"Prometheus \u7684\u914d\u7f6e\u91c7\u7528\u4e86 YAML \u8bed\u6cd5\u63cf\u8ff0\uff0cPrometheus \u4e0b\u8f7d\u597d\u4ee5\u540e\u4f1a\u6709\u4e00\u4e2a\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u53eb ",(0,o.kt)("inlineCode",{parentName:"p"},"prometheus.yml")," \uff0c\u53ef\u4ee5\u5148\u914d\u7f6e\u8fd9\u4e2a\u6587\u4ef6\u3002"),(0,o.kt)("p",null,"\u5c06\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u5220\u9664\u6ce8\u91ca\u548c\u4e00\u4e9b\u9ad8\u7ea7\u914d\u7f6e\u4ee5\u540e\uff0c\u5269\u4e0b\u7684\u6700\u57fa\u672c\u3001\u6700\u5c11\u7684\u914d\u7f6e\u9879\u5982\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'global:\n  scrape_interval:     15s\n  evaluation_interval: 15s\n\nrule_files:\n  # - "first.rules"\n  # - "second.rules"\n\nscrape_configs:\n  - job_name: prometheus\n    static_configs:\n      - targets: [\'localhost:9090\']\n')),(0,o.kt)("p",null,"\u5728\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e09\u4e2a\u914d\u7f6e\u5757\uff1aglobal\u3001rule_files\u3001scrape_configs \u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"global")," \u5757\u63a7\u5236 Prometheus \u670d\u52a1\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u6709\u4e24\u4e2a\u9009\u9879\u3002",(0,o.kt)("inlineCode",{parentName:"p"},"scrape_interval")," \u63a7\u5236Prometheus \u91c7\u96c6\u6570\u636e\u7684\u9891\u7387\u3002\u4f60\u53ef\u4ee5\u4e3a\u67d0\u4e9b\u6307\u6807\u6570\u636e\u8986\u76d6\u6b64\u9009\u9879\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5168\u5c40\u8bbe\u7f6e\u662f\u6bcf15\u79d2\u91c7\u96c6\u4e00\u6b21\u3002",(0,o.kt)("inlineCode",{parentName:"p"},"evaluation_interval"),"\u9009\u9879\u63a7\u5236 Prometheus \u8bc4\u4f30\u89c4\u5219\u7684\u9891\u7387\u3002Prometheus \u4f7f\u7528\u89c4\u5219\u521b\u5efa\u65b0\u7684\u65f6\u95f4\u5e8f\u5217\u5e76\u751f\u6210\u8b66\u62a5\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"rule_files")," \u7528\u6765\u6307\u5b9a\u6211\u4eec\u9700\u8981\u52a0\u8f7d\u7684\u89c4\u5219\u7684\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e5f\u662f YAML \u8bed\u6cd5\u3002\u5f53\u524d\u6ca1\u6709\u914d\u7f6e\u89c4\u5219\uff0c\u8fd9\u90e8\u5206\u6ce8\u91ca\u6389\u4e0d\u751f\u6548\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"scrape_configs")," \u63a7\u5236 Prometheus \u76d1\u542c\u7684\u8d44\u6e90\u3002\u7531\u4e8e Prometheus \u8fd8\u5c06\u81ea\u5df1\u7684\u6570\u636e\u4f5c\u901a\u8fc7 HTTP \u516c\u5f00\u51fa\u6765\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u6536\u96c6\u548c\u76d1\u63a7\u81ea\u5df1\u7684\u5065\u5eb7\u72b6\u51b5\u3002\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e2d\u6709\u4e00\u4e2a\u540d\u4e3aprometheus \u7684 job\uff0c\u5b83\u6293\u53d6 prometheus \u670d\u52a1\u516c\u5f00\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002\u8be5 Job \u5305\u542b\u4e00\u4e2a\u9759\u6001\u914d\u7f6e\u7684\u76ee\u6807\uff0c\u4e00\u822c\u662f\u672c\u5730\u4e3b\u673a\u7684 9090 \u7aef\u53e3\u3002 Prometheus \u5e0c\u671b Metric \u80fd\u591f\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"/metric")," \u7684\u8def\u5f84\u4e0a\u53ef\u7528\u3002\u6240\u4ee5\u9ed8\u8ba4\u7684 job \u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b RUEL \u6765\u91c7\u96c6\uff0chttp://localhost:9090/metrics ."),(0,o.kt)("p",null,"\u8fd4\u56de\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8be6\u7ec6\u63cf\u8ff0\u4e86 Prometheus \u670d\u52a1\u7684\u72b6\u6001\u548c\u6027\u80fd\u3002"),(0,o.kt)("p",null,"\u5bf9\u4e8e\u5b8c\u6574\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u67e5\u770b",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/"},"\u5b98\u7f51\u7684\u6587\u6863")," \uff0c \u540e\u7eed\u6211\u4e5f\u4f1a\u6574\u7406\u51fa\u6765\u3002"),(0,o.kt)("h2",{id:"\u542f\u52a8-prometheus"},"\u542f\u52a8 Prometheus"),(0,o.kt)("p",null,"\u4f7f\u7528\u521a\u624d\u4fee\u6539\u597d\u7684\u914d\u7f6e\u6587\u4ef6\u6765\u542f\u52a8 Prometheus\uff0c\u5207\u6362\u5230 Prometheus \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u76ee\u5f55\u4e0b\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./prometheus --config.file=prometheus.yml\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5f53\u4e8c\u8fdb\u5236\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e0a\u8ff0\u547d\u4ee4\u3002\u5982\u679c\u4e0d\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\uff0c\u8bf7\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002")),(0,o.kt)("p",null,"\u8fd9\u6837 Prometheus \u5c31\u4f1a\u542f\u52a8\u8d77\u6765\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee http://localhost:9090 \u5730\u5740\u53ef\u4ee5\u770b\u5230\u5173\u4e8e\u5b83\u81ea\u8eab\u7684\u72b6\u6001\u9875\u9762\uff0cPrometheus \u5728\u542f\u52a8 30 \u79d2\u4ee5\u540e\u5728\u9875\u9762\u5c31\u53ef\u4ee5\u770b\u5230\u6570\u636e\u4e86\u3002"),(0,o.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee http://localhost:9090/metrics\uff0c\u6765\u9a8c\u8bc1 Prometheus \u662f\u5426\u5728\u66b4\u9732\u81ea\u5df1\u7684\u6307\u6807\u3002"),(0,o.kt)("h2",{id:"\u4f7f\u7528\u6d4f\u89c8\u5668\u67e5\u770b"},"\u4f7f\u7528\u6d4f\u89c8\u5668\u67e5\u770b"),(0,o.kt)("p",null,"\u6211\u4eec\u6765\u770b\u4e00\u4e0b Prometheus \u6536\u96c6\u7684\u4e00\u4e9b\u5173\u4e8e\u81ea\u5df1\u7684\u6570\u636e\u3002\u8bbf\u95ee http://localhost:9090/graph\uff0c\u5e76\u5728 \u201cgraph\u201d \u9009\u9879\u5361\u4e2d\u9009\u62e9 \u201cConsole\u201d \u89c6\u56fe\u3002"),(0,o.kt)("p",null,"\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"promhttp_metric_handler_requests_total")," (Prometheus \u63d0\u4f9b\u7684\u4e00\u4e2aMetric \u540d\u79f0) \u8f93\u5165\u5230\u63a7\u5236\u53f0\uff0c\u8fd9\u5c06\u8fd4\u56de\u8bb8\u591a\u4e0d\u540c\u7684\u65f6\u95f4\u5e8f\u5217(\u4ee5\u53ca\u4e3a\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8bb0\u5f55\u7684\u6700\u65b0\u503c)\uff0c\u6240\u6709\u8fd9\u4e9b\u65f6\u95f4\u5e8f\u5217\u7684 Metric \u540d\u79f0\u90fd\u662f promhttp_metric_handler_requests_total\uff0c\u4f46\u662f\u5177\u6709\u4e0d\u540c\u7684 label \u3002\u8fd9\u4e9b label \u6307\u5b9a\u4e0d\u540c\u7684\u8bf7\u6c42\u72b6\u6001\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u60f3\u770b HTTP \u8bf7\u6c42\u8fd4\u56de\u7801 200 \u7684\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'promhttp_metric_handler_requests_total{code="200"}\n')),(0,o.kt)("p",null,"\u5982\u679c\u8981\u8ba1\u7b97\u8fd4\u56de\u7684\u65f6\u95f4\u5e8f\u5217\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528 count \u6765\u67e5\u8be2\uff0c\u540e\u8fb9\u4f1a\u5199\u5230\u51fd\u6570\u76f8\u5173\u7684\u5185\u5bb9:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"count(promhttp_metric_handler_requests_total)\n")),(0,o.kt)("h2",{id:"\u63a8\u8350\u76ee\u5f55\u7ed3\u6784"},"\u63a8\u8350\u76ee\u5f55\u7ed3\u6784"),(0,o.kt)("p",null,"\u65b0\u5b89\u88c5\u7684 Prometheus \u5efa\u8bae\u4f7f\u7528\u5982\u4e0b\u76ee\u5f55\u7ed3\u6784\u8fdb\u884c\u8c03\u6574\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 conf\n\u2502\xa0\xa0 \u2514\u2500\u2500 prometheus.yml\n\u251c\u2500\u2500 current -> deploy/prometheus-2.8.1.linux-amd64\n\u251c\u2500\u2500 data\n\u251c\u2500\u2500 deploy\n\u2502\xa0\xa0 \u2514\u2500\u2500 prometheus-2.8.1.linux-amd64\n\u2502\xa0\xa0     \u251c\u2500\u2500 LICENSE\n\u2502\xa0\xa0     \u251c\u2500\u2500 NOTICE\n\u2502\xa0\xa0     \u251c\u2500\u2500 console_libraries\n\u2502\xa0\xa0     \u251c\u2500\u2500 consoles\n\u2502\xa0\xa0     \u251c\u2500\u2500 prometheus\n\u2502\xa0\xa0     \u251c\u2500\u2500 prometheus.yml\n\u2502\xa0\xa0     \u2514\u2500\u2500 promtool\n\u251c\u2500\u2500 logs\n\u2502\xa0\xa0 \u2514\u2500\u2500 prometheus.log\n\u251c\u2500\u2500 run\n\u2502\xa0\xa0 \u2514\u2500\u2500 prometheus.pid\n\u2514\u2500\u2500 scripts\n    \u2514\u2500\u2500 run.sh\n\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"conf")," \u76ee\u5f55\u7528\u6765\u5b58\u50a8 Prometheus \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u542f\u52a8\u7684\u65f6\u5019\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"current")," \u8be5\u76ee\u5f55\u8f6f\u8fde\u63a5\u5230\u4e8c\u8fdb\u5236\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"data")," Prometheus \u6570\u636e\u5e93\u7684\u6570\u636e\u5b58\u50a8\u4f4d\u7f6e\uff0c"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"deploy")," \u653e\u7f6e Prometheus \u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u65b9\u4fbf current \u8fdb\u884c\u8f6f\u8fde\u63a5"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"logs")," \u5b58\u653e\u65e5\u5fd7\u3002\u5982\u679c\u666e\u901a\u7528\u6237\u542f\u52a8\uff0c\u5efa\u8bae\u65e5\u5fd7\u653e\u7f6e\u5728\u8fd9\u4e2a\u76ee\u5f55\u3002\u5982\u679c root \u7528\u6237\u542f\u52a8\uff0c\u65e5\u5fd7\u53ef\u4ee5\u653e\u5728\u8fd9\u4e2a\u76ee\u5f55\uff0c\u4e5f\u53ef\u4ee5\u653e\u5728 /var/log/messages "),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"scripts")," \u653e\u7f6e\u542f\u52a8\u811a\u672c\u3002\u5982\u679c\u666e\u901a\u7528\u6237\u542f\u52a8 \uff0c\u653e\u7f6e\u542f\u52a8\u8fdb\u7a0b\u7684\u811a\u672c\u3002\u5982\u679c root \u7528\u6237\u542f\u52a8\uff0c\u53ef\u4ee5\u653e\u7f6e\u811a\u672c\u5230\u8be5\u76ee\u5f55\uff0c\u6216\u8005\u5199\u6210\u7cfb\u7edf\u670d\u52a1\u3002"),(0,o.kt)("p",null,"\u4f7f\u7528\u8be5\u76ee\u5f55\u7ed3\u6784\u53ef\u4ee5\u65b9\u4fbf\u7684\u8fdb\u884c\u5907\u4efd\u3001\u8fc1\u79fb\u3001\u5347\u7ea7\u3001\u7ef4\u62a4\u3002"),(0,o.kt)("p",null,"\u63d0\u4f9b\u4e00\u4e2a\u542f\u52a8\u811a\u672c start.sh \u7684\u53c2\u8003\u6a21\u677f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PATH=/opt/prometheus\nLOG=$BASEPATH/logs\nnohup $PATH/current/prometheus --config.file=$PATH/conf/prometheus.yml --web.listen-address=:9090 --storage.tsdb.path=$PATH/data/  --storage.tsdb.retention=30d >> $LOG/prometheus.log  2>&1 & echo $! > $PATH/run/prometheus.pid\n")),(0,o.kt)("p",null,"\u8be5\u811a\u672c\u505a\u4e86\u5982\u4e0b\u5185\u5bb9"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6570\u636e\u66b4\u9732\u7684\u7aef\u53e3"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u5b58\u50a8\u7684\u8def\u5f84"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u5b58\u50a8\u7684\u65f6\u95f4\uff08\u8f6e\u8be2\u65f6\u95f4\uff09"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u65e5\u5fd7\u7684\u5b58\u50a8\u4f4d\u7f6e\uff08nohup \u8f93\u51fa\u4f5c\u4e3a\u65e5\u5fd7\uff09"),(0,o.kt)("li",{parentName:"ul"},"\u751f\u6210 PID \u6587\u4ef6")),(0,o.kt)("p",null,"CentOS 7 \u542f\u52a8\u811a\u672c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u6a21\u677f\uff0c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[Unit]\nDescription=Prometheus Node Exporter\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/current/prometheus --config.file=/opt/prometheus/conf/prometheus.yml --web.listen-address=:9090 --storage.tsdb.path=/opt/prometheus/data/  --storage.tsdb.retention=30d\nUser=root\n\n[Install]\nWantedBy=multi-user.target\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u4f7f\u7528 root \u7528\u6237\u542f\u52a8"),(0,o.kt)("li",{parentName:"ul"},"\u65e5\u5fd7\u4f1a\u5b58\u50a8\u5728 /var/log/messages"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6570\u636e\u66b4\u9732\u7684\u7aef\u53e3"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u5b58\u50a8\u7684\u8def\u5f84"),(0,o.kt)("li",{parentName:"ul"},"\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u5b58\u50a8\u7684\u65f6\u95f4\uff08\u8f6e\u8be2\u65f6\u95f4\uff09")),(0,o.kt)("p",null,"\u5927\u5bb6\u6839\u636e\u81ea\u5df1\u9700\u6c42\u53d6\u7528\u3001\u4fee\u6539\u3002"))}m.isMDXComponent=!0}}]);