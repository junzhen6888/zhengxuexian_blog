"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[619],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>c});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),m=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=m(e.components);return a.createElement(p.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),u=m(n),c=l,d=u["".concat(p,".").concat(c)]||u[c]||k[c]||r;return n?a.createElement(d,o(o({ref:t},s),{},{components:n})):a.createElement(d,o({ref:t},s))}));function c(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var m=2;m<r;m++)o[m]=n[m];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},86479:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>k,frontMatter:()=>r,metadata:()=>i,toc:()=>m});var a=n(87462),l=(n(67294),n(3905));const r={},o="Prometheus \u5185\u7f6e\u51fd\u6570",i={unversionedId:"prometheus/PromQL/5.4-querying-functions",id:"prometheus/PromQL/5.4-querying-functions",title:"Prometheus \u5185\u7f6e\u51fd\u6570",description:"\u6709\u4e9b\u51fd\u6570\u6709\u9ed8\u8ba4\u53c2\u6570\uff0c\u4f8b\u5982year(v=vector(time()) instant-vector)\u3002\u8fd9\u610f\u5473\u7740\u6709\u4e00\u4e2a\u53c2\u6570v\u662f\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\uff0c\u5b83\u5c06\u9ed8\u8ba4\u4e3a\u8868\u8fbe\u5f0fvector(time())\u7684\u503c\u3002instant-vector \u8868\u793a\u53c2\u6570\u7c7b\u578b\u3002",source:"@site/wiki/ops/prometheus/05-PromQL/5.4-querying-functions.md",sourceDirName:"prometheus/05-PromQL",slug:"/prometheus/PromQL/5.4-querying-functions",permalink:"/zhengxuexian_blog/ops/prometheus/PromQL/5.4-querying-functions",draft:!1,tags:[],version:"current",lastUpdatedBy:"zhengxuexian",lastUpdatedAt:1662026865,formattedLastUpdatedAt:"2022\u5e749\u67081\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Prometheus\u67e5\u8be2\u64cd\u4f5c\u7b26\u4f8b\u5b50",permalink:"/zhengxuexian_blog/ops/prometheus/PromQL/5.3-querying-operator-examples"},next:{title:"\u5b50\u67e5\u8be2",permalink:"/zhengxuexian_blog/ops/prometheus/PromQL/5.5-querying-functions-examples"}},p={},m=[],s={toc:m};function k(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"prometheus-\u5185\u7f6e\u51fd\u6570"},"Prometheus \u5185\u7f6e\u51fd\u6570"),(0,l.kt)("p",null,"\u6709\u4e9b\u51fd\u6570\u6709\u9ed8\u8ba4\u53c2\u6570\uff0c\u4f8b\u5982",(0,l.kt)("inlineCode",{parentName:"p"},"year(v=vector(time()) instant-vector)"),"\u3002\u8fd9\u610f\u5473\u7740\u6709\u4e00\u4e2a\u53c2\u6570v\u662f\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\uff0c\u5b83\u5c06\u9ed8\u8ba4\u4e3a\u8868\u8fbe\u5f0f",(0,l.kt)("inlineCode",{parentName:"p"},"vector(time())"),"\u7684\u503c\u3002instant-vector \u8868\u793a\u53c2\u6570\u7c7b\u578b\u3002"),(0,l.kt)("p",null,"Prometheus \u5f53\u524d\u6709 42 \u4e2a\u5185\u7f6e\u51fd\u6570\uff08\u57fa\u4e8e Prometheus v2.30.0\uff09\u3002\u5206\u522b\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"abs()\nabsent()\nabsent_over_time()\nceil()\nchanges()\nclamp()\nclamp_max()\nclamp_min()\nday_of_month()\nday_of_week()\ndays_in_month()\ndelta()\nderiv()\nexp()\nfloor()\nhistogram_quantile()\nholt_winters()\nhour()\nidelta()\nincrease()\nirate()\nlabel_join()\nlabel_replace()\nln()\nlog2()\nlog10()\nminute()\nmonth()\npredict_linear()\nrate()\nresets()\nround()\nscalar()\nsgn()\nsort()\nsort_desc()\nsqrt()\ntime()\ntimestamp()\nvector()\nyear()\n\\<aggregation\\>_over_time()\n")),(0,l.kt)("h1",{id:"abs"},"abs()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"abs(v instant-vector)")," \u8fd4\u56de\u8f93\u5165\u5411\u91cf\uff0c\u6240\u6709\u6837\u672c\u503c\u90fd\u8f6c\u6362\u4e3a\u5176\u7edd\u5bf9\u503c\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u9488\u5bf9\u5355\u4e2a Metric \u6ca1\u4ec0\u4e48\u6548\u679c\uff0c\u6216\u8005\u8bf4\u8fd9\u4e2a\u51fd\u6570\u5e94\u8be5\u662f\u7528\u5728\u4e24\u4e2a Metric \u505a\u5dee\u7684\u65f6\u5019\uff0c\u4fdd\u8bc1\u7ed3\u679c\u6c38\u8fdc\u662f\u6b63\u6570\u3002"),(0,l.kt)("h1",{id:"absent"},"absent()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"absent(v instant-vector)")," \u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u5411\u91cf\u5177\u6709\u4efb\u4f55\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u7a7a\u5411\u91cf;\u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u5411\u91cf\u6ca1\u6709\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u503c\u4e3a1\u76841\u5143\u7d20\u5411\u91cf\u3002"),(0,l.kt)("p",null,"\u8fd9\u8fd9\u4e2a\u51fd\u6570\u4e3b\u8981\u7528\u5728\u7ed9\u5b9a Metric \u540d\u79f0\u548c Label \u7ec4\u5408\u4e0d\u5b58\u5728\u65f6\u95f4\u5e8f\u5217\u65f6\u53d1\u51fa\u8b66\u62a5\u6216\u8005\u5728\u9875\u9762\u4e0a\u5c55\u793a\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'# \u8fd9\u91cc\u63d0\u4f9b\u7684\u5411\u91cf\u6709\u6837\u672c\u6570\u636e\nabsent(http_requests_total{method="get"})  => no data\nabsent(sum(http_requests_total{method="get"}))  => no data\n\n# \u7531\u4e8e\u4e0d\u5b58\u5728 Metric nonexistent\uff0c\u6240\u4ee5\u8fd4\u56de\u4e0d\u5e26 Metric \u540d\u79f0\u4e14\u5e26\u6709 label \u7684\u65f6\u95f4\u5e8f\u5217\uff0c\u4e14\u6837\u672c\u503c\u4e3a1\nabsent(nonexistent{job="myjob"})  => {job="myjob"}  1\n# \u6b63\u5219\u5339\u914d\u7684 instance \u4e0d\u4f5c\u4e3a\u8fd4\u56de labels \u4e2d\u7684\u4e00\u90e8\u5206\nabsent(nonexistent{job="myjob",instance=~".*"})  => {job="myjob"}  1\n\n# sum \u51fd\u6570\u8fd4\u56de\u7684\u65f6\u95f4\u5e8f\u5217\u4e0d\u5e26\u6709 label\uff0c\u4e14\u6ca1\u6709\u6837\u672c\u6570\u636e\nabsent(sum(nonexistent{job="myjob"}))  => {}  1\n# \u8fd9\u4e2a\u65f6\u5019\u5373\u4f7f\u4f7f\u7528 by \uff0c\u9488\u5bf9 sum \u8fd9\u4e9b\u805a\u5408\u51fd\u6570\u4e5f\u4e0d\u4f1a\u8fd4\u56de label\u3002\nabsent(sum(nonexistent{job="myjob"}) by (job))  => {}  1\n')),(0,l.kt)("h1",{id:"absent_over_time"},"absent_over_time()"),(0,l.kt)("p",null,"absent_over_time() \u548c absent() \u975e\u5e38\u7c7b\u4f3c\u3002"),(0,l.kt)("p",null,"absent_over_time(v range-vector) \u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u8303\u56f4\u5411\u91cf\u6709\u4efb\u4f55\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u7a7a\u5411\u91cf\uff0c\u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u8303\u56f4\u5411\u91cf\u6ca1\u6709\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u503c\u4e3a 1 \u7684 1 \u5143\u7d20\u5411\u91cf\u3002"),(0,l.kt)("p",null,"\u8fd9\u5bf9\u4e8e\u5728\u7ed9\u5b9a\u7684\u6307\u6807\u540d\u79f0\u548c\u6807\u7b7e\u7ec4\u5408\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u4e0d\u5b58\u5728\u65f6\u95f4\u5e8f\u5217\u65f6\u53d1\u51fa\u8b66\u62a5\u975e\u5e38\u6709\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'absent_over_time(nonexistent{job="myjob"}[1h])  => {job="myjob"}\n\nabsent_over_time(nonexistent{job="myjob",instance=~".*"}[1h])  => {job="myjob"}\n\nabsent_over_time(sum(nonexistent{job="myjob"})[1h:])  => {}\n\n')),(0,l.kt)("h1",{id:"ceil"},"ceil()"),(0,l.kt)("p",null,"ceil(v instant-vector) \u5c06 v \u4e2d\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\u5411\u4e0a\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u6574\u6570\u3002\u4e5f\u5c31\u662f\u8fdb 1\u6cd5\uff0c\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'node_load5{instance="192.168.1.75:9100"} # \u7ed3\u679c\u4e3a 2.65\nceil(node_load5{instance="192.168.1.75:9100"}) # \u7ed3\u679c\u4e3a 3\n')),(0,l.kt)("h1",{id:"changes"},"changes()"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u6bcf\u4e2a\u8f93\u5165\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"changes(v range-vector)")," \u5c06\u8fd4\u56de\u5176\u503c\u5728\u6240\u63d0\u4f9b\u7684\u65f6\u95f4\u8303\u56f4\u5185\u66f4\u6539\u7684\u6b21\u6570\u4f5c\u4e3a\u5373\u65f6\u5411\u91cf\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'# \u5982\u679c\u6837\u672c\u6570\u636e\u503c\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u5219\u8fd4\u56de\u7ed3\u679c\u4e3a 0\nchanges(node_load5{instance="10.32.50.24"}[1m]) # \u7ed3\u679c\u4e3a 0\n')),(0,l.kt)("h1",{id:"clamp"},"clamp()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"clamp(v instant-vector, min scalar, max scalar)")," \u5c06\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\u94b3\u5236\u5728v\u4e0b\u9650\u4e3amin\u548c\u4e0a\u9650\u4e3amax\u3002"),(0,l.kt)("p",null,"\u7279\u6b8a\u60c5\u51b5\uff1a - \u8fd4\u56de\u7a7a\u5411\u91cf if min > max - \u8fd4\u56deNaNifmin\u6216maxisNaN"),(0,l.kt)("h1",{id:"clamp_max"},"clamp_max()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"clamp_max(v instant-vector, max scalar)")," \u51fd\u6570\uff0c\u8f93\u5165\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u548c\u6700\u5927\u503c\uff0c\u6837\u672c\u6570\u636e\u503c\u82e5\u5927\u4e8e max\uff0c\u5219\u6539\u4e3a max\uff0c\u5426\u5219\u4e0d\u53d8\u3002\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'node_load5{instance="10.32.50.24"} # \u7ed3\u679c\u4e3a 2.79\nclamp_max(node_load5{instance="10.32.50.24"}, 2) # \u7ed3\u679c\u4e3a 2\n')),(0,l.kt)("h1",{id:"clamp_min"},"clamp_min()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"clamp_min(v instant-vector, min scalar)")," \u51fd\u6570\uff0c\u8f93\u5165\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u548c\u6700\u5c0f\u503c\uff0c\u6837\u672c\u6570\u636e\u503c\u82e5\u5c0f\u4e8e min\uff0c\u5219\u6539\u4e3a min\uff0c\u5426\u5219\u4e0d\u53d8\u3002\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'node_load5{instance="10.32.50.24"} # \u7ed3\u679c\u4e3a 2.79\nclamp_min(node_load5{instance="10.32.50.24"}, 3) # \u7ed3\u679c\u4e3a 3\n')),(0,l.kt)("h1",{id:"day_of_month"},"day_of_month()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"day_of_month(v=vector(time()) instant-vector)")," \u51fd\u6570\uff0c\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u6240\u5728\u6708\u7684\u7b2c\u51e0\u5929\u3002\u8fd4\u56de\u503c\u8303\u56f4\uff1a1~31\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"day_of_month(vector(time())) # # \u503c\u662f23\uff0c \u8fd4\u56de\u662f\u6309\u7167 UTC \u65f6\u95f4\u8ba1\u7b97\u7684\n")),(0,l.kt)("h1",{id:"day_of_week"},"day_of_week()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"day_of_week(v=vector(time()) instant-vector)"),"\n\u51fd\u6570\uff0c\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u6240\u5728\u5468\u7684\u7b2c\u51e0\u5929\u3002\u8fd4\u56de\u503c\u8303\u56f4\uff1a0~6\uff0c0 \u8868\u793a\u661f\u671f\u5929\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"day_of_week(vector(time())) \n# \u503c\u662f 6\uff0c\u5f53\u524d\u662f\u5468\u516d\u3002 \u8fd4\u56de\u662f UTC \u65f6\u95f4\n\n\n")),(0,l.kt)("h1",{id:"days_in_month"},"days_in_month()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"days_in_month(v=vector(time()) instant-vector)")," \u51fd\u6570\uff0c\u8fd4\u56de\u5f53\u6708\u4e00\u5171\u6709\u591a\u5c11\u5929\u3002\u8fd4\u56de\u503c\u8303\u56f4\uff1a28~31\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'days_in_month(node_load5{instance="10.32.58.24"})\n# \u503c\u662f 31 \uff0c\u56e0\u4e3a\u5f53\u524d\u662f 10 \u6708\u3002\ndays_in_month(vector(time())) \n')),(0,l.kt)("h1",{id:"delta"},"delta()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"delta(v range-vector)")," \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\uff0c\u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u3002\u5b83\u8ba1\u7b97\u4e00\u4e2a\u533a\u95f4\u5411\u91cf v \u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e4b\u95f4\u7684\u5dee\u503c\u3002\u7531\u4e8e\u8fd9\u4e2a\u503c\u88ab\u5916\u63a8\u5230\u6307\u5b9a\u7684\u6574\u4e2a\u65f6\u95f4\u8303\u56f4\uff0c\u6240\u4ee5\u5373\u4f7f\u6837\u672c\u503c\u90fd\u662f\u6574\u6570\uff0c\u4f60\u4ecd\u7136\u53ef\u80fd\u4f1a\u5f97\u5230\u4e00\u4e2a\u975e\u6574\u6570\u503c\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u8fd4\u56de\u8fc7\u53bb\u4e00\u5c0f\u65f6\u7684 CPU 5 \u5206\u949f\u8d1f\u8f7d\u7684\u5dee\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"delta(node_load5[1h])\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002"),(0,l.kt)("h1",{id:"deriv"},"deriv()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"deriv(v range-vector)")," \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf,\u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u3002\u5b83\u4f7f\u7528\u7b80\u5355\u7684\u7ebf\u6027\u56de\u5f52\u8ba1\u7b97\u533a\u95f4\u5411\u91cf v \u4e2d\u5404\u4e2a\u65f6\u95f4\u5e8f\u5217\u7684\u5bfc\u6570\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"deriv(node_load5[1h])\n")),(0,l.kt)("h1",{id:"exp"},"exp()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"exp(v instant-vector)")," \u51fd\u6570\uff0c\u8f93\u5165\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff0c\u8fd4\u56de\u5404\u4e2a\u6837\u672c\u503c\u7684 e \u7684\u6307\u6570\u503c\uff0c\u5373 e \u7684 N \u6b21\u65b9\u3002\u5f53 N \u7684\u503c\u8db3\u591f\u5927\u65f6\u4f1a\u8fd4\u56de +Inf\u3002\u7279\u6b8a\u60c5\u51b5\u4e3a\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Exp(+Inf) = +Inf"),(0,l.kt)("li",{parentName:"ul"},"Exp(NaN) = NaN")),(0,l.kt)("h1",{id:"floor"},"floor()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"floor(v instant-vector)")," \u51fd\u6570\u4e0e ",(0,l.kt)("inlineCode",{parentName:"p"},"ceil()")," \u51fd\u6570\u76f8\u53cd\uff0c\u5c06 v \u4e2d\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\u5411\u4e0b\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u6574\u6570\u3002\u4e5f\u5c31\u662f\u53bb\u5c3e\u6cd5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'node_load5{instance="10.23.50.24"} # \u7ed3\u679c\u4e3a 2.65\nceil(node_load5{instance="10.23.50.24"}) # \u7ed3\u679c\u4e3a 2\n')),(0,l.kt)("h1",{id:"histogram_quantile"},"histogram_quantile()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"histogram_quantile(\u03c6 float, b instant-vector)")," \u4ece ",(0,l.kt)("inlineCode",{parentName:"p"},"bucket")," \u7c7b\u578b\u7684\u5411\u91cf b \u4e2d\u8ba1\u7b97 ",(0,l.kt)("inlineCode",{parentName:"p"},"\u03c6 (0 \u2264 \u03c6 \u2264 1)")," \u5206\u4f4d\u6570\uff08\u767e\u5206\u4f4d\u6570\u7684\u4e00\u822c\u5f62\u5f0f\uff09\u7684\u6837\u672c\u7684\u6700\u5927\u503c\u3002\uff08\u6709\u5173 \u03c6 \u5206\u4f4d\u6570\u7684\u8be6\u7ec6\u8bf4\u660e\u4ee5\u53ca\u76f4\u65b9\u56fe\u6307\u6807\u7c7b\u578b\u7684\u4f7f\u7528\uff0c\u8bf7\u53c2\u9605\u76f4\u65b9\u56fe\u548c\u6458\u8981\uff09\u3002\u5411\u91cf b \u4e2d\u7684\u6837\u672c\u662f\u6bcf\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"bucket")," \u7684\u91c7\u6837\u70b9\u6570\u91cf\u3002\u6bcf\u4e2a\u6837\u672c\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"labels")," \u4e2d\u5fc5\u987b\u8981\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"le "),"\u8fd9\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"label")," \u6765\u8868\u793a\u6bcf\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"bucket")," \u7684\u4e0a\u8fb9\u754c\uff0c\u6ca1\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"le")," \u6807\u7b7e\u7684\u6837\u672c\u4f1a\u88ab\u5ffd\u7565\u3002\u76f4\u65b9\u56fe\u6307\u6807\u7c7b\u578b\u81ea\u52a8\u63d0\u4f9b\u5e26\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"_bucket")," \u540e\u7f00\u548c\u76f8\u5e94\u6807\u7b7e\u7684\u65f6\u95f4\u5e8f\u5217\u3002"),(0,l.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"rate()")," \u51fd\u6570\u6765\u6307\u5b9a\u5206\u4f4d\u6570\u8ba1\u7b97\u7684\u65f6\u95f4\u7a97\u53e3\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u4e00\u4e2a\u76f4\u65b9\u56fe\u6307\u6807\u540d\u79f0\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"employee_age_bucket_bucket"),"\uff0c\u8981\u8ba1\u7b97\u8fc7\u53bb 10 \u5206\u949f\u5185 \u7b2c 90 \u4e2a\u767e\u5206\u4f4d\u6570\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u8868\u8fbe\u5f0f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"histogram_quantile(0.9, rate(employee_age_bucket_bucket[10m]))\n")),(0,l.kt)("p",null,"\u8fd4\u56de\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'{instance="10.0.86.71:8080",job="prometheus"} 35.714285714285715\n')),(0,l.kt)("p",null,"\u8fd9\u8868\u793a\u6700\u8fd1 10 \u5206\u949f\u4e4b\u5185 90% \u7684\u6837\u672c\u7684\u6700\u5927\u503c\u4e3a 35.714285714285715\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u8ba1\u7b97\u7ed3\u679c\u662f\u6bcf\u7ec4\u6807\u7b7e\u7ec4\u5408\u6210\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u3002\u6211\u4eec\u53ef\u80fd\u4e0d\u4f1a\u5bf9\u6240\u6709\u8fd9\u4e9b\u7ef4\u5ea6\uff08\u5982 job\u3001instance \u548c method\uff09\u611f\u5174\u8da3\uff0c\u5e76\u5e0c\u671b\u5c06\u5176\u4e2d\u7684\u4e00\u4e9b\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 sum() \u51fd\u6570\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u6839\u636e job \u6807\u7b7e\u6765\u5bf9\u7b2c 90 \u4e2a\u767e\u5206\u4f4d\u6570\u8fdb\u884c\u805a\u5408\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"# histogram_quantile() \u51fd\u6570\u5fc5\u987b\u5305\u542b le \u6807\u7b7e\nhistogram_quantile(0.9, sum(rate(employee_age_bucket_bucket[10m])) by (job, le))\n")),(0,l.kt)("p",null,"\u5982\u679c\u8981\u805a\u5408\u6240\u6709\u7684\u6807\u7b7e\uff0c\u5219\u4f7f\u7528\u5982\u4e0b\u8868\u8fbe\u5f0f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"histogram_quantile(0.9,sum(rate(employee_age_bucket_bucket[10m])) by (le))\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"histogram_quantile")," \u8fd9\u4e2a\u51fd\u6570\u662f\u6839\u636e\u5047\u5b9a\u6bcf\u4e2a\u533a\u95f4\u5185\u7684\u6837\u672c\u5206\u5e03\u662f\u7ebf\u6027\u5206\u5e03\u6765\u8ba1\u7b97\u7ed3\u679c\u503c\u7684(\u4e5f\u5c31\u662f\u8bf4\u5b83\u7684\u7ed3\u679c\u672a\u5fc5\u51c6\u786e)\uff0c\u6700\u9ad8\u7684 bucket \u5fc5\u987b\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},'le="+Inf"')," (\u5426\u5219\u5c31\u8fd4\u56de NaN)\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u5206\u4f4d\u6570\u4f4d\u4e8e\u6700\u9ad8\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"bucket\uff08+Inf\uff09")," \u4e2d\uff0c\u5219\u8fd4\u56de\u7b2c\u4e8c\u4e2a\u6700\u9ad8\u7684 bucket \u7684\u4e0a\u8fb9\u754c\u3002\u5982\u679c\u8be5 bucket \u7684\u4e0a\u8fb9\u754c\u5927\u4e8e 0\uff0c\u5219\u5047\u8bbe\u6700\u4f4e\u7684 bucket \u7684\u7684\u4e0b\u8fb9\u754c\u4e3a 0\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5728\u8be5 bucket \u5185\u4f7f\u7528\u5e38\u89c4\u7684\u7ebf\u6027\u63d2\u503c\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u5206\u4f4d\u6570\u4f4d\u4e8e\u6700\u4f4e\u7684 bucket \u4e2d\uff0c\u5219\u8fd4\u56de\u6700\u4f4e bucket \u7684\u4e0a\u8fb9\u754c\u3002"),(0,l.kt)("h1",{id:"holt_winters"},"holt_winters()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"holt_winters(v range-vector, sf scalar, tf scalar)")," \u51fd\u6570\u57fa\u4e8e\u533a\u95f4\u5411\u91cf v\uff0c\u751f\u6210\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e73\u6ed1\u503c\u3002\u5e73\u6ed1\u56e0\u5b50 ",(0,l.kt)("inlineCode",{parentName:"p"},"sf")," \u8d8a\u4f4e, \u5bf9\u65e7\u6570\u636e\u7684\u91cd\u89c6\u7a0b\u5ea6\u8d8a\u9ad8\u3002\u8d8b\u52bf\u56e0\u5b50 ",(0,l.kt)("inlineCode",{parentName:"p"},"tf")," \u8d8a\u9ad8\uff0c\u5bf9\u6570\u636e\u7684\u8d8b\u52bf\u7684\u8003\u8651\u5c31\u8d8a\u591a\u3002\u5176\u4e2d\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"0< sf"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"tf <=1"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"holt_winters")," \u4ec5\u9002\u7528\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"Gauge")," \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u3002"),(0,l.kt)("h1",{id:"hour"},"hour()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"hour(v=vector(time()) instant-vector)")," \u51fd\u6570\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u7684\u5f53\u524d\u7b2c\u51e0\u4e2a\u5c0f\u65f6\uff0c\u65f6\u95f4\u8303\u56f4\uff1a0~23\u3002"),(0,l.kt)("h1",{id:"idelta"},"idelta()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"idelta(v range-vector) "),"\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf, \u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u3002\u5b83\u8ba1\u7b97\u6700\u65b0\u7684 2 \u4e2a\u6837\u672c\u503c\u4e4b\u95f4\u7684\u5dee\u503c\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"Gauge")," \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002"),(0,l.kt)("h1",{id:"increase"},"increase()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"increase(v range-vector)")," \u51fd\u6570\u83b7\u53d6\u533a\u95f4\u5411\u91cf\u4e2d\u7684\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u6837\u672c\u5e76\u8fd4\u56de\u5176\u589e\u957f\u91cf, \u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u91c7\u6837\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\u3002\u7531\u4e8e\u8fd9\u4e2a\u503c\u88ab\u5916\u63a8\u5230\u6307\u5b9a\u7684\u6574\u4e2a\u65f6\u95f4\u8303\u56f4\uff0c\u6240\u4ee5\u5373\u4f7f\u6837\u672c\u503c\u90fd\u662f\u6574\u6570\uff0c\u4f60\u4ecd\u7136\u53ef\u80fd\u4f1a\u5f97\u5230\u4e00\u4e2a\u975e\u6574\u6570\u503c\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u533a\u95f4\u5411\u91cf\u4e2d\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8fc7\u53bb 5 \u5206\u949f\u5185 HTTP \u8bf7\u6c42\u6570\u7684\u589e\u957f\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'increase(http_requests_total{job="apiserver"}[5m])\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"increase")," \u7684\u8fd4\u56de\u503c\u7c7b\u578b\u53ea\u80fd\u662f\u8ba1\u6570\u5668\u7c7b\u578b\uff0c\u4e3b\u8981\u4f5c\u7528\u662f\u589e\u52a0\u56fe\u8868\u548c\u6570\u636e\u7684\u53ef\u8bfb\u6027\u3002\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"rate(v)")," \u51fd\u6570\u8bb0\u5f55\u89c4\u5219\u7684\u4f7f\u7528\u7387\uff0c\u4ee5\u4fbf\u6301\u7eed\u8ddf\u8e2a\u6570\u636e\u6837\u672c\u503c\u7684\u53d8\u5316\u3002"),(0,l.kt)("h1",{id:"irate"},"irate()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"irate(v range-vector)")," \u51fd\u6570\u7528\u4e8e\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u7684\u589e\u957f\u7387\uff0c\u4f46\u662f\u5176\u53cd\u5e94\u51fa\u7684\u662f\u77ac\u65f6\u589e\u957f\u7387\u3002irate \u51fd\u6570\u662f\u901a\u8fc7\u533a\u95f4\u5411\u91cf\u4e2d\u6700\u540e\u4e24\u4e2a\u4e24\u672c\u6570\u636e\u6765\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u7684\u589e\u957f\u901f\u7387\uff0c\u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u91c7\u6837\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\u3002\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\u5728\u65f6\u95f4\u7a97\u53e3\u8303\u56f4\u5185\u7684\u201c\u957f\u5c3e\u95ee\u9898\u201d\uff0c\u5e76\u4e14\u4f53\u73b0\u51fa\u66f4\u597d\u7684\u7075\u654f\u5ea6\uff0c\u901a\u8fc7irate\u51fd\u6570\u7ed8\u5236\u7684\u56fe\u6807\u80fd\u591f\u66f4\u597d\u7684\u53cd\u5e94\u6837\u672c\u6570\u636e\u7684\u77ac\u65f6\u53d8\u5316\u72b6\u6001\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u533a\u95f4\u5411\u91cf\u4e2d\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8fc7\u53bb 5 \u5206\u949f\u5185\u6700\u540e\u4e24\u4e2a\u6837\u672c\u6570\u636e\u7684 HTTP \u8bf7\u6c42\u6570\u7684\u589e\u957f\u7387\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'irate(http_requests_total{job="api-server"}[5m])\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"irate")," \u53ea\u80fd\u7528\u4e8e\u7ed8\u5236\u5feb\u901f\u53d8\u5316\u7684\u8ba1\u6570\u5668\uff0c\u5728\u957f\u671f\u8d8b\u52bf\u5206\u6790\u6216\u8005\u544a\u8b66\u4e2d\u66f4\u63a8\u8350\u4f7f\u7528 rate \u51fd\u6570\u3002\u56e0\u4e3a\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"irate")," \u51fd\u6570\u65f6\uff0c\u901f\u7387\u7684\u7b80\u77ed\u53d8\u5316\u4f1a\u91cd\u7f6e FOR \u8bed\u53e5\uff0c\u5f62\u6210\u7684\u56fe\u5f62\u6709\u5f88\u591a\u6ce2\u5cf0\uff0c\u96be\u4ee5\u9605\u8bfb\u3002"),(0,l.kt)("p",null,"\u5f53\u5c06 ",(0,l.kt)("inlineCode",{parentName:"p"},"irate() "),"\u51fd\u6570\u4e0e\u805a\u5408\u8fd0\u7b97\u7b26\uff08\u4f8b\u5982 ",(0,l.kt)("inlineCode",{parentName:"p"},"sum()"),"\uff09\u6216\u968f\u65f6\u95f4\u805a\u5408\u7684\u51fd\u6570\uff08\u4efb\u4f55\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"_over_time")," \u7ed3\u5c3e\u7684\u51fd\u6570\uff09\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5fc5\u987b\u5148\u6267\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"irate()")," \u51fd\u6570\uff0c\u7136\u540e\u518d\u8fdb\u884c\u805a\u5408\u64cd\u4f5c\uff0c\u5426\u5219\u5f53\u91c7\u6837\u76ee\u6807\u91cd\u65b0\u542f\u52a8\u65f6 ",(0,l.kt)("inlineCode",{parentName:"p"},"irate()")," \u65e0\u6cd5\u68c0\u6d4b\u5230\u8ba1\u6570\u5668\u662f\u5426\u88ab\u91cd\u7f6e\u3002"),(0,l.kt)("h1",{id:"label_join"},"label_join()"),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u5141\u8bb8\u4f60\u5c06\u6807\u7b7e\u7eb8\u8fde\u63a5\u5728\u7528\uff0c\u7c7b\u4f3c\u4e8e\u5728\u91cd\u65b0\u6807\u8bb0\u65f6\u5904\u7406",(0,l.kt)("inlineCode",{parentName:"p"},"souce_lables"),"\u65b9\u6cd5\uff0c\u540c\u6837\u8be5\u51fd\u6570\u4e5f\u4e0d\u4f1a\u5220\u9664\u6307\u6807\u540d\u79f0\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\u683c\u5f0f\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)")," \u3002"),(0,l.kt)("p",null,"\u51fd\u6570\u53ef\u4ee5\u5c06\u65f6\u95f4\u5e8f\u5217 v \u4e2d\u591a\u4e2a\u6807\u7b7e ",(0,l.kt)("inlineCode",{parentName:"p"},"src_label")," \u7684\u503c\uff0c\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"separator")," \u4f5c\u4e3a\u8fde\u63a5\u7b26\u5199\u5165\u5230\u4e00\u4e2a\u65b0\u7684\u6807\u7b7e ",(0,l.kt)("inlineCode",{parentName:"p"},"dst_label")," \u4e2d\u3002\u53ef\u4ee5\u6709\u591a\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"src_label")," \u6807\u7b7e\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u7684\u65f6\u95f4\u5e8f\u5217\u591a\u4e86\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"foo")," \u6807\u7b7e\uff0c\u6807\u7b7e\u503c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"}," etcd,etcd-k8s"),"\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'up{endpoint="api",instance="192.168.123.248:2379",job="etcd",namespace="monitoring",service="etcd-k8s"}\n==> up{endpoint="api",instance="192.168.123.248:2379",job="etcd",namespace="monitoring",service="etcd-k8s"} 1\n \nlabel_join(up{endpoint="api",instance="192.168.123.248:2379",job="etcd",namespace="monitoring",service="etcd-k8s"}, "foo", ",", "job", "service")\n==> up{endpoint="api",foo="etcd,etcd-k8s",instance="192.168.123.248:2379",job="etcd",namespace="monitoring",service="etcd-k8s"} 1\n')),(0,l.kt)("p",null,"\u518d\u770b\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'go_info{job="LocalServer"}\n   ==> go_info{instance="localhost:9090", job="LocalServer", version="go1.16.4"} 1\n\nlabel_join(go_info{job="LocalServer"},"newlable",\'|\',"job","version")\n   ==> go_info{instance="localhost:9090", job="LocalServer", newlable="LocalServer|go1.16.4", version="go1.16.4"} 1 \n\n')),(0,l.kt)("h1",{id:"label_replace"},"label_replace()"),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u5141\u8bb8\u4f60\u5bf9\u6807\u7b7e\u503c\u8fdb\u884c\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u3002\u4e0e\u5927\u591a\u6570\u51fd\u6570\u4e0d\u540c\u7684\u662f\uff0c\u8be5\u51fd\u6570\u4e0d\u4f1a\u5220\u9664\u6307\u6807\u540d\u79f0\u3002"),(0,l.kt)("p",null,"\u4e3a\u4e86\u80fd\u591f\u8ba9\u5ba2\u6237\u7aef\u7684\u56fe\u6807\u66f4\u5177\u6709\u53ef\u8bfb\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"label_replace")," \u51fd\u6570\u4e3a\u65f6\u95f4\u5e8f\u5217\u6dfb\u52a0\u989d\u5916\u7684\u6807\u7b7e\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"label_replace")," \u7684\u5177\u4f53\u53c2\u6570\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)\n")),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u4f1a\u4f9d\u6b21\u5bf9 v \u4e2d\u7684\u6bcf\u4e00\u6761\u65f6\u95f4\u5e8f\u5217\u8fdb\u884c\u5904\u7406\uff0c\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"regex")," \u5339\u914d ",(0,l.kt)("inlineCode",{parentName:"p"},"src_label")," \u7684\u503c\uff0c\u5e76\u5c06\u5339\u914d\u90e8\u5206 relacement \u5199\u5165\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"dst_label")," \u6807\u7b7e\u4e2d\u3002\u5982\u4e0b\u6240\u793a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'label_replace(up, "host", "$1", "instance", "(.*):.*")\nlabel_replace(up{job="api-server",service="a:c"}, "foo", "$1", "service", "(.*):.*")\n\n')),(0,l.kt)("p",null,"\u51fd\u6570\u5904\u7406\u540e\uff0c\u65f6\u95f4\u5e8f\u5217\u5c06\u5305\u542b\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"host")," \u6807\u7b7e\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"host")," \u6807\u7b7e\u7684\u503c\u4e3a Exporter \u5b9e\u4f8b\u7684 IP \u5730\u5740\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'up{host="localhost",instance="localhost:8080",job="cadvisor"} 1\nup{host="localhost",instance="localhost:9090",job="prometheus"} 1\nup{host="localhost",instance="localhost:9100",job="node"} 1\n')),(0,l.kt)("p",null,"\u518d\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'up{job="LocalServer"}\n==> up{instance="localhost:9090", job="LocalServer"}\n\nlabel_replace(up{job="LocalServer"}, "instance", "$1:9200", "job",  "(.*)")\n==> up{instance="LocalServer:9200", job="LocalServer"} \n')),(0,l.kt)("h1",{id:"ln"},"ln()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ln(v instant-vector)")," \u8ba1\u7b97\u77ac\u65f6\u5411\u91cf v \u4e2d\u6240\u6709\u6837\u672c\u6570\u636e\u7684\u81ea\u7136\u5bf9\u6570\u3002\u7279\u6b8a\u60c5\u51b5\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ln(+Inf) = +Inf"),(0,l.kt)("li",{parentName:"ul"},"ln(0) = -Inf"),(0,l.kt)("li",{parentName:"ul"},"ln(x < 0) = NaN"),(0,l.kt)("li",{parentName:"ul"},"ln(NaN) = NaN")),(0,l.kt)("h1",{id:"log2"},"log2()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"log2(v instant-vector)")," \u51fd\u6570\u8ba1\u7b97\u77ac\u65f6\u5411\u91cf v \u4e2d\u6240\u6709\u6837\u672c\u6570\u636e\u7684\u4e8c\u8fdb\u5236\u5bf9\u6570\u3002\u7279\u6b8a\u60c5\u51b5:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ln(+Inf) = +Inf"),(0,l.kt)("li",{parentName:"ul"},"ln(0) = -Inf"),(0,l.kt)("li",{parentName:"ul"},"ln(x < 0) = NaN"),(0,l.kt)("li",{parentName:"ul"},"ln(NaN) = NaN")),(0,l.kt)("p",null,"\u6bd4\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"log2(vector(2)) # {} 1 \n")),(0,l.kt)("h1",{id:"log10"},"log10()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"log10(v instant-vector)")," \u8ba1\u7b97\u77ac\u65f6\u5411\u91cf v \u4e2d\u6240\u6709\u6837\u672c\u6570\u636e\u7684\u5341\u8fdb\u5236\u5bf9\u6570\u3002\u7279\u6b8a\u60c5\u51b5:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ln(+Inf) = +Inf"),(0,l.kt)("li",{parentName:"ul"},"ln(0) = -Inf"),(0,l.kt)("li",{parentName:"ul"},"ln(x < 0) = NaN"),(0,l.kt)("li",{parentName:"ul"},"ln(NaN) = NaN\n\u6bd4\u5982\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"log10(vector(10)) # {} 1 \n")),(0,l.kt)("h1",{id:"minute"},"minute()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"minute(v=vector(time()) instant-vector)")," \u51fd\u6570\u8fd4\u56de\u7ed9\u5b9a UTC \u65f6\u95f4\u5f53\u524d\u5c0f\u65f6\u7684\u7b2c\u591a\u5c11\u5206\u949f\u3002\u7ed3\u679c\u8303\u56f4\uff1a0~59\u3002"),(0,l.kt)("h1",{id:"month"},"month()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"month(v=vector(time()) instant-vector)")," \u51fd\u6570\u8fd4\u56de\u7ed9\u5b9a UTC \u65f6\u95f4\u5f53\u524d\u5c5e\u4e8e\u7b2c\u51e0\u4e2a\u6708\uff0c\u7ed3\u679c\u8303\u56f4\uff1a0~12\u3002"),(0,l.kt)("h1",{id:"predict_linear"},"predict_linear()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"predict_linear(v range-vector, t scalar)")," \u51fd\u6570\u53ef\u4ee5\u9884\u6d4b\u65f6\u95f4\u5e8f\u5217 v \u5728 t \u79d2\u540e\u7684\u503c\u3002\u5b83\u57fa\u4e8e\u7b80\u5355\u7ebf\u6027\u56de\u5f52\u7684\u65b9\u5f0f\uff0c\u5bf9\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u6837\u672c\u6570\u636e\u8fdb\u884c\u7edf\u8ba1\uff0c\u4ece\u800c\u53ef\u4ee5\u5bf9\u65f6\u95f4\u5e8f\u5217\u7684\u53d8\u5316\u8d8b\u52bf\u505a\u51fa\u9884\u6d4b\u3002\u8be5\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c\u4e0d\u5e26\u6709\u5ea6\u91cf\u6307\u6807\uff0c\u53ea\u6709\u6807\u7b7e\u5217\u8868\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u57fa\u4e8e 2 \u5c0f\u65f6\u7684\u6837\u672c\u6570\u636e\uff0c\u6765\u9884\u6d4b\u4e3b\u673a\u53ef\u7528\u78c1\u76d8\u7a7a\u95f4\u7684\u662f\u5426\u5728 4 \u4e2a\u5c0f\u65f6\u5019\u88ab\u5360\u6ee1\uff0c\u53ef\u4ee5\u4f7f\u7528\u8868\u8fbe\u5f0f\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},'predict_linear(node_filesystem_free{job="node"}[2h], 4 * 3600) < 0')),(0,l.kt)("p",null,"\u901a\u8fc7\u4e0b\u9762\u7684\u4f8b\u5b50\u6765\u89c2\u5bdf\u8fd4\u56de\u503c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'predict_linear(http_requests_total{code="200",instance="120.77.65.193:9090",job="prometheus",method="get"}[5m], 5)\n\n\u7ed3\u679c\uff1a\n{code="200",handler="query_range",instance="120.77.65.193:9090",job="prometheus",method="get"} 1\n{code="200",handler="prometheus",instance="120.77.65.193:9090",job="prometheus",method="get"} 4283.449995397104\n{code="200",handler="static",instance="120.77.65.193:9090",job="prometheus",method="get"} 22.99999999999999\n...\n')),(0,l.kt)("p",null,"\u4f8b\u5982, \u9884\u6d4b\u56db\u4e2a\u5c0f\u65f6\u5185\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf\u5269\u4f59\u7684\u53ef\u7528\u7a7a\u95f4\u91cf\u3002 "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'predict_linear(node_filesystem_free_bytes{instance="192.168.1.107:9100"}[1h],4 * 3600)\n==>  {device="/dev/mapper/ubuntu--vg-lv--0",fstype="ext4", instance="192.168.1.107:9100", job="linux_exporter", mountpoint="/"}\n    81532763513.3\n# \u7b49\u540c\u4e8e\nderiv(node_filesystem_free_bytes{instance="192.168.1.107:9100"}[1h] * 4 * 3600) + node_filesystem_free_bytes{instance="192.168.1.107:9100"}[1h] \n')),(0,l.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"Gauge")," \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002"),(0,l.kt)("h1",{id:"rate"},"rate()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"rate(v range-vector)")," \u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u533a\u95f4\u5411\u91cf v \u5728\u65f6\u95f4\u7a97\u53e3\u5185\u5e73\u5747\u589e\u957f\u901f\u7387\uff0c\u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u91c7\u6837\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\u3002\u8be5\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c\u4e0d\u5e26\u6709\u5ea6\u91cf\u6307\u6807\uff0c\u53ea\u6709\u6807\u7b7e\u5217\u8868\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u533a\u95f4\u5411\u91cf\u4e2d\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8fc7\u53bb 5 \u5206\u949f\u5185 HTTP \u8bf7\u6c42\u6570\u7684\u6bcf\u79d2\u589e\u957f\u7387\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'rate(http_requests_total[5m])\n\u7ed3\u679c\uff1a\n{code="200",handler="label_values",instance="120.77.65.193:9090",job="prometheus",method="get"} 0\n{code="200",handler="query_range",instance="120.77.65.193:9090",job="prometheus",method="get"} 0\n{code="200",handler="prometheus",instance="120.77.65.193:9090",job="prometheus",method="get"} 0.2\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"rate()")," \u51fd\u6570\u8fd4\u56de\u503c\u7c7b\u578b\u53ea\u80fd\u7528\u8ba1\u6570\u5668\uff0c\u5728\u957f\u671f\u8d8b\u52bf\u5206\u6790\u6216\u8005\u544a\u8b66\u4e2d\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\u3002"),(0,l.kt)("p",null,"\u5f53\u5c06 ",(0,l.kt)("inlineCode",{parentName:"p"},"rate()")," \u51fd\u6570\u4e0e\u805a\u5408\u8fd0\u7b97\u7b26\uff08\u4f8b\u5982 ",(0,l.kt)("inlineCode",{parentName:"p"},"sum()"),"\uff09\u6216\u968f\u65f6\u95f4\u805a\u5408\u7684\u51fd\u6570\uff08\u4efb\u4f55\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"_over_time")," \u7ed3\u5c3e\u7684\u51fd\u6570\uff09\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5fc5\u987b\u5148\u6267\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"rate()")," \u51fd\u6570\uff0c\u7136\u540e\u518d\u8fdb\u884c\u805a\u5408\u64cd\u4f5c\uff0c\u5426\u5219\u5f53\u91c7\u6837\u76ee\u6807\u91cd\u65b0\u542f\u52a8\u65f6 ",(0,l.kt)("inlineCode",{parentName:"p"},"rate()")," \u65e0\u6cd5\u68c0\u6d4b\u5230\u8ba1\u6570\u5668\u662f\u5426\u88ab\u91cd\u7f6e\u3002"),(0,l.kt)("h1",{id:"resets"},"resets()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"resets(v range-vector)")," \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\uff0c\u5b83\u90fd\u8fd4\u56de\u4e00\u4e2a\u8ba1\u6570\u5668\u91cd\u7f6e\u7684\u6b21\u6570\u3002\u4e24\u4e2a\u8fde\u7eed\u6837\u672c\u4e4b\u95f4\u7684\u503c\u7684\u51cf\u5c11\u88ab\u8ba4\u4e3a\u662f\u4e00\u6b21\u8ba1\u6570\u5668\u91cd\u7f6e\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\uff0c\u663e\u793a\u8fdb\u7a0b\u7684 CPU \u65f6\u95f4\u5728\u8fc7\u53bb\u4e00\u4e2a\u5c0f\u65f6\u91cd\u7f6e\u7684\u6b21\u6570\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'resets(process_cpu_seconds_total[1h])\n==> {instance="localhost:9090", job="prom-Server"}  0 \n')),(0,l.kt)("p",null,"\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728\u8ba1\u6570\u5668\u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002"),(0,l.kt)("h1",{id:"round"},"round()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"round(v instant-vector, to_nearest=1 scalar)")," \u51fd\u6570\u4e0e ",(0,l.kt)("inlineCode",{parentName:"p"},"ceil")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"floor")," \u51fd\u6570\u7c7b\u4f3c\uff0c\u8fd4\u56de\u5411\u91cf\u4e2d\u6240\u6709\u6837\u672c\u503c\u7684\u6700\u63a5\u8fd1\u7684\u6574\u6570\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"to_nearest")," \u53c2\u6570\u662f\u53ef\u9009\u7684,\u9ed8\u8ba4\u4e3a 1,\u8868\u793a\u6837\u672c\u8fd4\u56de\u7684\u662f\u6700\u63a5\u8fd1 1 \u7684\u6574\u6570\u500d\u7684\u503c\u3002\u4f60\u4e5f\u53ef\u4ee5\u5c06\u8be5\u53c2\u6570\u6307\u5b9a\u4e3a\u4efb\u610f\u503c\uff08\u4e5f\u53ef\u4ee5\u662f\u5c0f\u6570\uff09\uff0c\u8868\u793a\u6837\u672c\u8fd4\u56de\u7684\u662f\u6700\u63a5\u8fd1\u5b83\u7684\u6574\u6570\u500d\u7684\u503c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"round(vector(6.5)) # 7\nround(vector(6.4)) # 6 \n")),(0,l.kt)("h1",{id:"scalar"},"scalar()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"scalar(v instant-vector)")," \u51fd\u6570\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u5355\u5143\u7d20\u7684\u77ac\u65f6\u5411\u91cf,\u5b83\u8fd4\u56de\u5176\u552f\u4e00\u7684\u65f6\u95f4\u5e8f\u5217\u7684\u503c\u4f5c\u4e3a\u4e00\u4e2a\u6807\u91cf\u3002\u5982\u679c\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u91cf\u5927\u4e8e 1 \u6216\u8005\u7b49\u4e8e 0, \u5219\u8fd4\u56de NaN\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'# 1.\u5904\u7406\u6807\u91cf\u5e38\u91cf\u4e14\u4ec5\u4ec5\u9002\u7528\u4e8e\u77ac\u65f6\u5411\u91cf\u7684\u6570\u5b66\u51fd\u6570\nscalar(sqrt(vector(4)))  # >> scalar    2\n\n# 2.\u4e0e\u65f6\u95f4\u51fd\u6570\u8fde\u7528\nscalar(year())  # >> scalar 2021\n\n# 3.\u4e3a\u4f60\u63d0\u4f9b\u8ba1\u7b97\u673aCPU\u975e\u7a7a\u95f2\u7684\u65f6\u95f4\u6bd4\u4f8b(\u4f7f\u7528scalar\u4f1a\u4e22\u5931\u6240\u6709\u7684\u6807\u7b7e)\nsum(rate(node_cpu_seconds_total{mode!="idle"}[5m])) / scalar(count(node_cpu_seconds_total{mode="idle"})) # {} 0.017490234375018142\n\n')),(0,l.kt)("h1",{id:"sgn"},"sgn()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"sgn(v instant-vector)")," \u8fd4\u56de\u4e00\u4e2a\u5411\u91cf\uff0c\u8be5\u5411\u91cf\u5c06\u6240\u6709\u6837\u672c\u503c\u8f6c\u6362\u4e3a\u5176\u7b26\u53f7\uff0c\u5b9a\u4e49\u5982\u4e0b:\u5982\u679cv\u662f\u6b63\u7684\uff0c\u5219\u4e3a1;\u5982\u679cv\u662f\u8d1f\u7684\uff0c\u5219\u4e3a-1;\u5982\u679cv\u7b49\u4e8e0\uff0c\u5219\u4e3a0\u3002"),(0,l.kt)("h1",{id:"sort"},"sort()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"sort(v instant-vector)")," \u51fd\u6570\u5bf9\u5411\u91cf\u6309\u5143\u7d20\u7684\u503c\u8fdb\u884c\u5347\u5e8f\u6392\u5e8f\uff0c\u8fd4\u56de\u7ed3\u679c\uff1akey: value = \u5ea6\u91cf\u6307\u6807\uff1a\u6837\u672c\u503c","[\u5347\u5e8f\u6392\u5217]"),(0,l.kt)("p",null,"\u6b63\u5e8f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sort(node_load5{}) \n")),(0,l.kt)("h1",{id:"sort_desc"},"sort_desc()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"sort(v instant-vector)")," \u51fd\u6570\u5bf9\u5411\u91cf\u6309\u5143\u7d20\u7684\u503c\u8fdb\u884c\u964d\u5e8f\u6392\u5e8f\uff0c\u8fd4\u56de\u7ed3\u679c\uff1akey: value = \u5ea6\u91cf\u6307\u6807\uff1a\u6837\u672c\u503c","[\u964d\u5e8f\u6392\u5217]","\u3002"),(0,l.kt)("p",null,"\u53cd\u5e8f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sort_desc(node_load5{}) \n")),(0,l.kt)("h1",{id:"sqrt"},"sqrt()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"sqrt(v instant-vector)")," \u51fd\u6570\u8ba1\u7b97\u5411\u91cf v \u4e2d\u6240\u6709\u5143\u7d20\u7684\u5e73\u65b9\u6839\u3002"),(0,l.kt)("h1",{id:"time"},"time()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"time()")," \u51fd\u6570\u8fd4\u56de\u4ece 1970-01-01 \u5230\u73b0\u5728\u7684\u79d2\u6570\u3002\u6ce8\u610f\uff1a\u5b83\u4e0d\u662f\u76f4\u63a5\u8fd4\u56de\u5f53\u524d\u65f6\u95f4\uff0c\u800c\u662f\u65f6\u95f4\u6233"),(0,l.kt)("h1",{id:"timestamp"},"timestamp()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"timestamp(v instant-vector)"),"\xa0\u51fd\u6570\u8fd4\u56de\u5411\u91cf v \u4e2d\u7684\u6bcf\u4e2a\u6837\u672c\u7684\u65f6\u95f4\u6233\uff08\u4ece 1970-01-01 \u5230\u73b0\u5728\u7684\u79d2\u6570\uff09\u3002"),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u4ece Prometheus 2.0 \u7248\u672c\u5f00\u59cb\u5f15\u5165, \u4e0e\u5176\u5b83\u65f6\u95f4\u51fd\u6570\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u67e5\u770b\u77ac\u65f6\u5411\u91cf\u4e2d\u7684\u6837\u672c\u7684\u65f6\u95f4\u6233\u800c\u4e0d\u662f\u503c\u3002"),(0,l.kt)("p",null,"\u4f8b\u5b50 1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"timestamp(vector(time()))  \n\n==> {}  1629783662.714\n")),(0,l.kt)("p",null,"\u4f8b\u5b50 2\uff0c\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u76ee\u6807\u7684\u6700\u540e\u5f02\u5e38\u6293\u53d6\u7684\u5f00\u59cb\u65f6\u95f4\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'timestamp(up) \n==> {instance="localhost:9090", job="Server"} 1629783745.147\n')),(0,l.kt)("p",null,"\u4f8b\u5b50 3\uff0c\u8fd4\u56dePrometheus\u542f\u52a8\u8282\u70b9\u5bfc\u51fa\u5668\u6293\u53d6\u65f6\u95f4\u4e0e\u8282\u70b9\u5bfc\u51fa\u5668\u8ba4\u4e3a\u7684\u5f53\u524d\u5b9e\u8df5\u7684\u5dee\u503c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'node_time_seconds - timestamp(node_time_seconds) \n==> {instance="192.168.1.107:9100", job="linux_exporter"} 0.0025420188903808594 \n')),(0,l.kt)("h1",{id:"vector"},"vector()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"vector(s scalar)")," \u51fd\u6570\u5c06\u6807\u91cf s \u4f5c\u4e3a\u6ca1\u6709\u6807\u7b7e\u7684\u5411\u91cf\u8fd4\u56de\uff0c\u5373\u8fd4\u56de\u7ed3\u679c\u4e3a\uff1akey: value= {}, s\u3002\n\u4f8b\u5982\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"vector(1024)")," \u8fd4\u56de\xa0",(0,l.kt)("inlineCode",{parentName:"p"},"{} 1024"),"\n\u4f8b\u5982\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"sum(node_not_metrics)")," \u6216\u8005 ",(0,l.kt)("inlineCode",{parentName:"p"},"vector(1024)")," \u8fd4\u56de\xa0",(0,l.kt)("inlineCode",{parentName:"p"},"{} 1024"),"\uff0c\u4e0d\u5b58\u5728\u7684\u6307\u6807\u4e5f\u59cb\u7ec8\u8fd4\u56de\u4e00\u4e2a\u6837\u672c\u3002"),(0,l.kt)("h1",{id:"year"},"year()"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"year(v=vector(time()) instant-vector)"),"\xa0\u51fd\u6570\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u7684\u5f53\u524d\u5e74\u4efd\u3002"),(0,l.kt)("p",null,"\u6ce8\u610f: \u5373\u4f7f\u533a\u95f4\u5411\u91cf\u5185\u7684\u503c\u5206\u5e03\u4e0d\u5747\u5300\uff0c\u5b83\u4eec\u5728\u805a\u5408\u65f6\u7684\u6743\u91cd\u4e5f\u662f\u76f8\u540c\u7684\u3002"),(0,l.kt)("p",null,"\u5b9e\u4f8b\u6f14\u793a:"),(0,l.kt)("p",null,"1.\u67e5\u770b\u8fdb\u7a0b\u662f\u54ea\u4e00\u5e74\u5f00\u59cb\u8fd0\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'year(process_start_time_seconds) \n==>  {instance="localhost:9090", job="Server"} 2021\n')),(0,l.kt)("p",null,"2.\u8ba1\u7b97\u672c\u6708\u542f\u52a8\u7684\u8fdb\u7a0b\u7684\u65f6\u95f4\u5e8f\u5217"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'year(process_start_time_seconds) == bool scalar(year())  * (month(process_start_time_seconds) == bool scalar(month()))\n==>  {instance="localhost:9090", job="Server"} 1\n==>  {instance="192.168.1.225:9100", job="linux_exporter"} 0\n')),(0,l.kt)("p",null,"3.\u8ba1\u7b97\u672c\u6708\u542f\u52a8\u7684\u8fdb\u7a0b\u7684\u65f6\u95f4\u5e8f\u5217\u4e2a\u6570"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sum(year(process_start_time_seconds) == bool scalar(year())  * (month(process_start_time_seconds) == bool scalar(month())))  \n\n==> {} 1\n")),(0,l.kt)("p",null,"Tips : \u4e58\u6cd5\u8fd0\u7b97\u7b26\u5728\u5e03\u5c14\u503c\u4f7f\u7528\u65f6\u5c31\u50cf\u548c\u8fd0\u7b97\u7b26\u4e00\u6837\u503c1\u8868\u793a\u771f\uff0c\u5426\u5219\u4e3a\u5047\u3002"),(0,l.kt)("h1",{id:"aggregation_over_time"},"\\<aggregation",">","_over_time()"),(0,l.kt)("p",null,"\u4e0b\u9762\u7684\u51fd\u6570\u5217\u8868\u5141\u8bb8\u4f20\u5165\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\uff0c\u5b83\u4eec\u4f1a\u805a\u5408\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u7684\u8303\u56f4\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"* avg_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u5e73\u5747\u503c\u3002\n* min_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6700\u5c0f\u503c\u3002\n* max_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6700\u5927\u503c\u3002\n* sum_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6c42\u548c\u3002\n* count_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u636e\u4e2a\u6570\u3002\n* quantile_over_time(scalar, range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u636e\u503c\u5206\u4f4d\u6570\uff0c\u03c6-quantile (0 \u2264 \u03c6 \u2264 1)\u3002\n* stddev_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u603b\u4f53\u6807\u51c6\u5dee\u3002\n* stdvar_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u603b\u4f53\u6807\u51c6\u65b9\u5dee\u3002\n")),(0,l.kt)("p",null,"\u8fd9\u4e9b\u503c\u6307\u5b9a\u95f4\u9694\u5185\u7684\u6240\u6709\u503c\u5728\u805a\u5408\u4e2d\u5177\u6709\u76f8\u540c\u7684\u6743\u91cd\uff0c\u5373\u4f7f\u8fd9\u4e9b\u503c\u5728\u6574\u4e2a\u95f4\u9694\u5185\u7684\u95f4\u9694\u4e0d\u76f8\u7b49\u3002"),(0,l.kt)("p",null,"Prometheus \u57fa\u4e8e\u5f53\u524d \u7684 2.30.0 \u7248\u672c\u5171\u8ba1\u6709 42 \u4e2a\u5185\u7f6e\u51fd\u6570\uff0c\u6309\u7167\u5b57\u6bcd\u6392\u5e8f\u5206\u522b\u662f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"abs()\nabsent()\nabsent_over_time()\nceil()\nchanges()\nclamp()\nclamp_max()\nclamp_min()\nday_of_month()\nday_of_week()\ndays_in_month()\ndelta()\nderiv()\nexp()\nfloor()\nhistogram_quantile()\nholt_winters()\nhour()\nidelta()\nincrease()\nirate()\nlabel_join()\nlabel_replace()\nln()\nlog2()\nlog10()\nminute()\nmonth()\npredict_linear()\nrate()\nresets()\nround()\nscalar()\nsgn()\nsort()\nsort_desc()\nsqrt()\ntime()\ntimestamp()\nvector()\nyear()\n\\<aggregation\\>_over_time()\n\n")),(0,l.kt)("p",null,"\u8fd9\u4e9b\u51fd\u6570\u8fd8\u53ef\u4ee5\u6309\u7167\u529f\u80fd\u8fdb\u884c\u5206\u7c7b\uff0c"),(0,l.kt)("h1",{id:"1-\u805a\u5408\u51fd\u6570"},"<1> \u805a\u5408\u51fd\u6570"),(0,l.kt)("p",null,"\u5bf9\u6307\u6807\u8fdb\u884c\u6c42\u548c\u3001\u6c42\u5e73\u5747\u3001\u8ba1\u6570\u3001\u6700\u5927\u503c\u3001\u6700\u5c0f\u503c\u3001Top \u3001Bottom\u3001\u767e\u5206\u4f4d\u6570\u7b49\u6570\u636e\u805a\u5408\u64cd\u4f5c\u60f3\u51fd\u6570\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"sum \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"avg() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"count() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"count_values() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"min() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"max() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"stddev() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"stdvar() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"topk() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"bottomk() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"quantile() \u51fd\u6570")),(0,l.kt)("h1",{id:"2-\u7c7b\u578b\u51fd\u6570"},"<2> \u7c7b\u578b\u51fd\u6570"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"vector() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"scalar() \u51fd\u6570")),(0,l.kt)("h1",{id:"3-\u6570\u5b66\u51fd\u6570"},"<3> \u6570\u5b66\u51fd\u6570"),(0,l.kt)("p",null,"\u5bf9\u6307\u6807\u8fdb\u884c\u5404\u79cd\u6570\u5b66\u8ba1\u7b97\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u6c42\u5bfc\u3001\u6c42\u5e73\u65b9\u3001\u6c42\u5f00\u65b9\u7b49\u7b49\uff0c\u6570\u5b66\u662f\u7814\u7a76\u6570\u636e\u7684\u4e00\u95e8\u79d1\u5b66\uff0c\u4e0d\u8981\u4e00\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u6790\uff0c\u5c31\u6c42\u5e73\u5747\u6570\uff0c\u8fd8\u662f\u6709\u5f88\u591a\u6570\u5b66\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528\u7684\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"abs() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"ln() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"log2() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"log10() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"exp() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"sqrt() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"ceil() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"floor() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"round() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"clamp() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"clamp_max() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"clamp_min() \u51fd\u6570")),(0,l.kt)("h1",{id:"4-\u65f6\u95f4\u51fd\u6570"},"<4> \u65f6\u95f4\u51fd\u6570"),(0,l.kt)("p",null,"\u5bf9\u6307\u6807\u7684\u65f6\u95f4\u8fdb\u884c\u64cd\u4f5c\u7684\u51fd\u6570\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"minute() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"hour() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"month() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"year() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"day_of_month() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"day_of_week() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"days_in_month() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"time() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"timestamp() \u51fd\u6570")),(0,l.kt)("h1",{id:"5-\u6807\u7b7e\u51fd\u6570"},"<5> \u6807\u7b7e\u51fd\u6570"),(0,l.kt)("p",null,"\u5bf9\u6307\u6807\u7684\u6807\u7b7e\uff08label\uff09\u8fdb\u884c\u64cd\u4f5c\u7684\u6570\u636e\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"label_join() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"label_replace() \u51fd\u6570")),(0,l.kt)("h1",{id:"6-\u7f3a\u5931\u4e0e\u6392\u5e8f\u51fd\u6570"},"<6> \u7f3a\u5931\u4e0e\u6392\u5e8f\u51fd\u6570"),(0,l.kt)("p",null,"\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\u3001\u4ee5\u53ca\u662f\u5426\u7f3a\u5931\u8fdb\u884c\u5224\u65ad\u7684\u4e00\u4e9b\u51fd\u6570\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"absent() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"histogram_quantile() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"sort() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"sort_desc() \u51fd\u6570")),(0,l.kt)("h1",{id:"7-\u8ba1\u6570\u5668"},"<7> \u8ba1\u6570\u5668"),(0,l.kt)("p",null,"\u9488\u5bf9\u8ba1\u6570\u5668\u7c7b\u578b\u6570\u636e\u7684\u4e00\u4e9b\u51fd\u6570\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"rate \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"increase() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"irate() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"resets() \u51fd\u6570")),(0,l.kt)("h1",{id:"8-gauge\u7c7b\u578b\u5904\u7406\u51fd\u6570"},"<8> Gauge\u7c7b\u578b\u5904\u7406\u51fd\u6570"),(0,l.kt)("p",null,"\u9488\u5bf9 Gauge \u7c7b\u578b\u6570\u636e\u7684\u4e00\u4e9b\u5904\u7406\u51fd\u6570"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"changes() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"deriv() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"predict_linear() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"delta() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"idelta() \u51fd\u6570"),(0,l.kt)("li",{parentName:"ul"},"holt_winters() \u51fd\u6570")),(0,l.kt)("h1",{id:"9-aggregation_over_time-\u968f\u65f6\u95f4\u805a\u5408\u51fd\u6570"},"<9> .\\<aggregation",">","_over_time() \u968f\u65f6\u95f4\u805a\u5408\u51fd\u6570"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"absent_over_time(range-vector) \uff1a\xa0\u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u8303\u56f4\u5411\u91cf\u6709\u4efb\u4f55\u5143\u7d20\u5219\u8fd4\u56de\u4e00\u4e2a\u7a7a\u5411\u91cf\uff0c\u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u8303\u56f4\u5411\u91cf\u6ca1\u6709\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u503c\u4e3a 1 \u7684 1 \u5143\u7d20\u5411\u91cf\u3002 "),(0,l.kt)("li",{parentName:"ul"},"avg_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u5e73\u5747\u503c\u3002"),(0,l.kt)("li",{parentName:"ul"},"min_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6700\u5c0f\u503c\u3002"),(0,l.kt)("li",{parentName:"ul"},"max_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6700\u5927\u503c\u3002"),(0,l.kt)("li",{parentName:"ul"},"sum_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6c42\u548c\u3002"),(0,l.kt)("li",{parentName:"ul"},"count_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u636e\u4e2a\u6570\u3002"),(0,l.kt)("li",{parentName:"ul"},"quantile_over_time(scalar, range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u636e\u503c\u5206\u4f4d\u6570\uff0c\u03c6-quantile (0 \u2264 \u03c6 \u2264 1)\u3002"),(0,l.kt)("li",{parentName:"ul"},"stddev_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u603b\u4f53\u6807\u51c6\u5dee\u3002"),(0,l.kt)("li",{parentName:"ul"},"stdvar_over_time(range-vector) : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u603b\u4f53\u6807\u51c6\u65b9\u5dee\u3002")),(0,l.kt)("h1",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"PromQL \u5f53\u524d\u652f\u6301\u7684\u51fd\u6570\u975e\u5e38\u4e30\u5bcc\uff0c\u4e00\u4e9b\u4e0d\u592a\u5e38\u7528\u7684\u51fd\u6570\u6211\u4e5f\u4f7f\u7528\u8f83\u5c11\uff0c\u4e0d\u662f\u5f88\u719f\u6089\uff0c\u6848\u4f8b\u4e5f\u4e0d\u591a\u3002\u4ee5\u540e\u719f\u6089\u4e86\u6211\u4f1a\u60f3\u529e\u6cd5\u8fdb\u884c\u66f4\u65b0\uff0c\u5206\u4eab\u7ed9\u5927\u5bb6\u3002"))}k.isMDXComponent=!0}}]);