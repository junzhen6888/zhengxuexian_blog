"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7758],{3905:(e,t,a)=>{a.d(t,{Zo:()=>i,kt:()=>d});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),m=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},i=function(e){var t=m(e.components);return r.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),c=m(a),d=n,h=c["".concat(p,".").concat(d)]||c[d]||u[d]||o;return a?r.createElement(h,l(l({ref:t},i),{},{components:a})):r.createElement(h,l({ref:t},i))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:n,l[1]=s;for(var m=2;m<o;m++)l[m]=a[m];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}c.displayName="MDXCreateElement"},52246:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>m});var r=a(87462),n=(a(67294),a(3905));const o={},l="JMX Exporter",s={unversionedId:"prometheus/Exporter/3.18-jmx-exporter",id:"prometheus/Exporter/3.18-jmx-exporter",title:"JMX Exporter",description:"JMX Exporter \u5229\u7528 Java \u7684 JMX \u673a\u5236\u6765\u8bfb\u53d6 JVM \u8fd0\u884c\u65f6\u7684\u4e00\u4e9b\u76d1\u63a7\u6570\u636e\uff0c\u7136\u540e\u5c06\u5176\u8f6c\u6362\u4e3a Prometheus \u6240\u8ba4\u77e5\u7684 Metrics \u683c\u5f0f\uff0c\u4ee5\u4fbf\u8ba9 Prometheus \u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\u91c7\u96c6\u3002",source:"@site/wiki/ops/prometheus/03-Exporter/3.18-jmx-exporter.md",sourceDirName:"prometheus/03-Exporter",slug:"/prometheus/Exporter/3.18-jmx-exporter",permalink:"/zhengxuexian_blog/ops/prometheus/Exporter/3.18-jmx-exporter",draft:!1,tags:[],version:"current",lastUpdatedBy:"zhengxuexian",lastUpdatedAt:1661407442,formattedLastUpdatedAt:"2022\u5e748\u670825\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Elasticsearch Exporter",permalink:"/zhengxuexian_blog/ops/prometheus/Exporter/3.17-elasticsearch-exporter"},next:{title:"Graphite Exporter",permalink:"/zhengxuexian_blog/ops/prometheus/Exporter/3.19-graphite-exporter"}},p={},m=[],i={toc:m};function u(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},i,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"jmx-exporter"},"JMX Exporter"),(0,n.kt)("p",null,"JMX Exporter \u5229\u7528 Java \u7684 JMX \u673a\u5236\u6765\u8bfb\u53d6 JVM \u8fd0\u884c\u65f6\u7684\u4e00\u4e9b\u76d1\u63a7\u6570\u636e\uff0c\u7136\u540e\u5c06\u5176\u8f6c\u6362\u4e3a Prometheus \u6240\u8ba4\u77e5\u7684 Metrics \u683c\u5f0f\uff0c\u4ee5\u4fbf\u8ba9 Prometheus \u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\u91c7\u96c6\u3002"),(0,n.kt)("p",null,"JMX \u662f Java Management Extensions \u7684\u7f29\u5199\uff0c\u662f\u7ba1\u7406 Java \u7684\u4e00\u79cd\u6269\u5c55\u6846\u67b6\uff0cJMX Exporter \u6b63\u662f\u57fa\u4e8e\u6b64\u6846\u67b6\u6765\u8bfb\u53d6 JVM \u7684\u8fd0\u884c\u65f6\u72b6\u6001\u7684\u3002"),(0,n.kt)("p",null,"Prometheus \u5b98\u65b9\u63d0\u4f9b\u4e86\u8fd9\u4e2a JMX Exporter \uff0c\u4ed3\u5e93\u5730\u5740\u662f ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/prometheus/jmx_exporter"},"https://github.com/prometheus/jmx_exporter")," \uff0c\u5f53\u524d\u6700\u65b0\u7248\u672c\u662f v0.16.1 \uff0c\u53d1\u5e03\u4e8e 2021 \u5e74 7 \u6708 14 \u65e5\uff0c\u6700\u8fd1\u7684\u53d1\u7248\u4f1a\u4e00\u6b21\u53d1\u4e24\u4e2a JAR \u5305\u51fa\u6765\uff0c\u4e00\u4e2a\u662f Java 7 \u4ee5\u53ca\u4ee5\u4e0a\u7528\u7684\uff0c\u53e6\u4e00\u4e2a\u662f\u517c\u5bb9 Java 6 \u7684\uff0c\u5927\u5bb6\u5728\u4e0b\u8f7d\u7684\u65f6\u5019\u4f7f\u7528\u5bf9\u5e94\u7684\u7248\u672c\u5c31\u597d\u3002"),(0,n.kt)("h1",{id:"\u5b89\u88c5\u8fd0\u884c"},"\u5b89\u88c5\u8fd0\u884c"),(0,n.kt)("p",null,"JMX Exporter \u4f1a\u4f5c\u4e3a Java \u7684 Agent \u8fd0\u884c\uff0c\u901a\u8fc7 HTTP \u7aef\u53e3\u66b4\u9732\u672c\u5730 JVM \u7684\u6307\u6807\u3002\u5b83\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684HTTP \u670d\u52a1\u8fd0\u884c\uff0c\u5e76\u83b7\u53d6\u8fdc\u7a0b JMX \u76ee\u6807\uff0c\u4f46\u8fd9\u6837\u505a\u6709\u5f88\u591a\u7f3a\u70b9\uff0c\u6bd4\u5982\u96be\u4ee5\u914d\u7f6e\u548c\u65e0\u6cd5\u66b4\u9732\u8fdb\u7a0b\u6307\u6807(\u4f8b\u5982\uff0c\u5185\u5b58\u548cCPU\u4f7f\u7528\u60c5\u51b5)\u3002\u56e0\u6b64\u5f3a\u70c8\u5efa\u8bae\u5c06 JMX Exporter \u4f5c\u4e3a Java Agent \u8fd0\u884c\u3002"),(0,n.kt)("p",null,"\u524d\u8fb9\u8bf4\u8fc7\uff0cJMX Exporter \u4f1a\u53d1\u5e03\u4e24\u4e2a JAR \u5305\uff0c\u4e00\u4e2a\u517c\u5bb9 Java 6 \uff0c\u4e00\u4e2a\u662f Java 7 \u4ee5\u53ca\u4ee5\u4e0a\u7684\uff0c\u4e0b\u8f7d\u597d\u5bf9\u5e94\u7684 JAR \u5305\u4ee5\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u548c Java \u7a0b\u5e8f\u4e00\u8d77\u542f\u52a8\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"java -javaagent:./jmx_prometheus_javaagent-0.16.1.jar=8080:config.yaml -jar yourJar.jar\n")),(0,n.kt)("p",null,"\u542f\u52a8\u597d\u4ee5\u540e\uff0c\u53ef\u4ee5\u8bbf\u95ee http://localhost:8080/metrics \u6765\u83b7\u53d6\u76d1\u63a7\u6307\u6807\u3002"),(0,n.kt)("p",null,"\u7ed1\u5b9a\u7279\u6b8a\u7684 ip \u548c\u7aef\u53e3\u53ef\u4ee5\u4f7f\u7528 ",(0,n.kt)("inlineCode",{parentName:"p"},"host:port")," \u3002"),(0,n.kt)("p",null,"\u4e0a\u8fb9\u8bf4\u9053\uff0cJMX Exporter \u53ef\u4ee5\u901a\u8fc7 HTTP \u670d\u52a1\u7684\u65b9\u5f0f\u5355\u72ec\u542f\u52a8\uff0c\u542f\u52a8\u53ef\u4ee5\u4f7f\u7528 ",(0,n.kt)("inlineCode",{parentName:"p"},"run_sample_httpserver.sh")," \u811a\u672c\uff0c\u811a\u672c\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"#!/usr/bin/env bash\n# Script to run a java application for testing jmx4prometheus.\n\nversion=$(sed -n -e 's#.*<version>\\(.*-SNAPSHOT\\)</version>#\\1#p' pom.xml)\n\n# Note: You can use localhost:5556 instead of 5556 for configuring socket hostname.\njava -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=5555 -jar jmx_prometheus_httpserver/target/jmx_prometheus_httpserver-${version}-jar-with-dependencies.jar 5556 example_configs/httpserver_sample_config.yml\n")),(0,n.kt)("p",null,"\u8bf7\u6ce8\u610f\uff0c\u7531\u4e8e JMX \u7684\u6027\u8d28\uff0c",(0,n.kt)("inlineCode",{parentName:"p"},"/metrics")," \u63a5\u53e3\u53ef\u80fd\u4f1a\u8d85\u8fc7 Prometheus \u7684\u9ed8\u8ba4\u6293\u53d6\u8d85\u65f610\u79d2\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u8c03\u6574 Prometheus \u7684\u503c\u3002"),(0,n.kt)("h1",{id:"\u914d\u7f6e"},"\u914d\u7f6e"),(0,n.kt)("p",null,"\u4e0b\u9762\u662f\u5b98\u65b9\u7ed9\u51fa\u7684 jmx_exporter \u7684\u914d\u7f6e\u6837\u4f8b\uff0c\u6587\u4ef6\u662f YAML \u683c\u5f0f\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u793a\u4f8b\u6587\u4ef6\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'---\nstartDelaySeconds: 0\nhostPort: 127.0.0.1:1234\nusername: \npassword: \njmxUrl: service:jmx:rmi:///jndi/rmi://127.0.0.1:1234/jmxrmi\nssl: false\nlowercaseOutputName: false\nlowercaseOutputLabelNames: false\nwhitelistObjectNames: ["org.apache.cassandra.metrics:*"]\nblacklistObjectNames: ["org.apache.cassandra.metrics:type=ColumnFamily,*"]\nrules:\n  - pattern: \'org.apache.cassandra.metrics<type=(\\w+), name=(\\w+)><>Value: (\\d+)\'\n    name: cassandra_$1_$2\n    value: $3\n    valueFactor: 0.001\n    labels: {}\n    help: "Cassandra metric $1 $2"\n    cache: false\n    type: GAUGE\n    attrNameSnakeCase: false\n\n')),(0,n.kt)("p",null,"\u914d\u7f6e\u6587\u4ef6\u91cc\u53c2\u6570\u7684\u542b\u4e49\u5982\u4e0b\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"startDelaySeconds\tstart delay before serving requests. Any requests within the delay period will result in an empty metrics set."),(0,n.kt)("li",{parentName:"ul"},"hostPort\tThe host and port to connect to via remote JMX. If neither this nor jmxUrl is specified, will talk to the local JVM."),(0,n.kt)("li",{parentName:"ul"},"username\tThe username to be used in remote JMX password authentication."),(0,n.kt)("li",{parentName:"ul"},"password\tThe password to be used in remote JMX password authentication."),(0,n.kt)("li",{parentName:"ul"},"jmxUrl\tA full JMX URL to connect to. Should not be specified if hostPort is."),(0,n.kt)("li",{parentName:"ul"},"ssl\tWhether JMX connection should be done over SSL. To configure certificates you have to set following system properties:\n-Djavax.net.ssl.keyStore=/home/user/.keystore\n-Djavax.net.ssl.keyStorePassword=changeit\n-Djavax.net.ssl.trustStore=/home/user/.truststore\n-Djavax.net.ssl.trustStorePassword=changeit"),(0,n.kt)("li",{parentName:"ul"},"lowercaseOutputName\tLowercase the output metric name. Applies to default format and name. Defaults to false."),(0,n.kt)("li",{parentName:"ul"},"lowercaseOutputLabelNames\tLowercase the output metric label names. Applies to default format and labels. Defaults to false."),(0,n.kt)("li",{parentName:"ul"},"whitelistObjectNames\tA list of ObjectNames to query. Defaults to all mBeans."),(0,n.kt)("li",{parentName:"ul"},"blacklistObjectNames\tA list of ObjectNames to not query. Takes precedence over whitelistObjectNames. Defaults to none."),(0,n.kt)("li",{parentName:"ul"},"rules\tA list of rules to apply in order, processing stops at the first matching rule. Attributes that aren't matched aren't collected. If not specified, defaults to collecting everything in the default format."),(0,n.kt)("li",{parentName:"ul"},"pattern\tRegex pattern to match against each bean attribute. The pattern is not anchored. Capture groups can be used in other options. Defaults to matching everything."),(0,n.kt)("li",{parentName:"ul"},"attrNameSnakeCase\tConverts the attribute name to snake case. This is seen in the names matched by the pattern and the default format. For example, anAttrName to an_attr_name. Defaults to false."),(0,n.kt)("li",{parentName:"ul"},"name\tThe metric name to set. Capture groups from the pattern can be used. If not specified, the default format will be used. If it evaluates to empty, processing of this attribute stops with no output."),(0,n.kt)("li",{parentName:"ul"},"value\tValue for the metric. Static values and capture groups from the pattern can be used. If not specified the scraped mBean value will be used."),(0,n.kt)("li",{parentName:"ul"},"valueFactor\tOptional number that value (or the scraped mBean value if value is not specified) is multiplied by, mainly used to convert mBean values from milliseconds to seconds."),(0,n.kt)("li",{parentName:"ul"},"labels\tA map of label name to label value pairs. Capture groups from pattern can be used in each. name must be set to use this. Empty names and values are ignored. If not specified and the default format is not being used, no labels are set."),(0,n.kt)("li",{parentName:"ul"},"help\tHelp text for the metric. Capture groups from pattern can be used. name must be set to use this. Defaults to the mBean attribute description and the full name of the attribute."),(0,n.kt)("li",{parentName:"ul"},"cache\tWhether to cache bean name expressions to rule computation (match and mismatch). Not recommended for rules matching on bean value, as only the value from the first scrape will be cached and re-used. This can increase performance when collecting a lot of mbeans. Defaults to false."),(0,n.kt)("li",{parentName:"ul"},"type\tThe type of the metric, can be GAUGE, COUNTER or UNTYPED. name must be set to use this. Defaults to UNTYPED.")),(0,n.kt)("p",null,"Metric \u540d\u79f0\u548c label  \u540d\u79f0\u662f\u7ecf\u8fc7\u6574\u7406\u7684\uff0c\u7b26\u5408\u89c4\u8303\u7684\u3002"),(0,n.kt)("p",null,"\u4e00\u4e2a\u6700\u5c0f\u7684\u914d\u7f6e\u662f{}\uff0c\u5b83\u5c06\u8fde\u63a5\u5230\u672c\u5730 JVM \u5e76\u4ee5\u9ed8\u8ba4\u683c\u5f0f\u6536\u96c6\u6240\u6709\u5185\u5bb9\u3002\u6ce8\u610f\uff0c\u83b7\u53d6\u76d1\u63a7\u6307\u6807\u7684\u65f6\u5019\u4f1a\u5904\u7406\u6240\u6709 mbean\uff0c\u5373\u4f7f\u5b83\u4eec\u6ca1\u6709\u88ab\u5bfc\u51fa\u3002"),(0,n.kt)("p",null,"Javaagent \u7684\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u53ef\u4ee5\u5728 ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/prometheus/jmx_exporter/tree/master/example_configs"},"https://github.com/prometheus/jmx_exporter/tree/master/example_configs")," \u91cc\u627e\u5230\u3002"),(0,n.kt)("h1",{id:"\u8f93\u5165\u683c\u5f0f"},"\u8f93\u5165\u683c\u5f0f"),(0,n.kt)("p",null,"\u8f93\u5165\u683c\u5f0f\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"domain<beanpropertyName1=beanPropertyValue1, beanpropertyName2=beanPropertyValue2, ...><key1, key2, ...>attrName: value\n")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Part"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"domain"),(0,n.kt)("td",{parentName:"tr",align:null},"Bean name. This is the part before the colon in the JMX object name.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"beanPropertyName/Value"),(0,n.kt)("td",{parentName:"tr",align:null},"Bean properties. These are the key/values after the colon in the JMX object name.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"keyN"),(0,n.kt)("td",{parentName:"tr",align:null},"If composite or tabular data is encountered, the name of the attribute is added to this list.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"attrName"),(0,n.kt)("td",{parentName:"tr",align:null},"The name of the attribute. For tabular data, this will be the name of the column. If attrNameSnakeCase is set, this will be converted to snake case.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"value"),(0,n.kt)("td",{parentName:"tr",align:null},"The value of the attribute.")))),(0,n.kt)("p",null,"\u9664\u4e86\u8bbe\u7f6e\u4e86 ",(0,n.kt)("inlineCode",{parentName:"p"},"attrNameSnakeCase")," \u4e4b\u5916\uff0c\u4e0d\u4f1a\u5bf9\u8fd9\u4e9b\u503c\u8fdb\u884c\u8f6c\u4e49\u6216\u5176\u4ed6\u66f4\u6539\u3002\u9ed8\u8ba4\u5e2e\u52a9\u5305\u62ec\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u9664\u4e86\u503c\u3002"),(0,n.kt)("p",null,"\u8f93\u51fa\u683c\u5f0f\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'domain_beanPropertyValue1_key1_key2_...keyN_attrName{beanpropertyName2="beanPropertyValue2", ...}: value\n')),(0,n.kt)("h1",{id:"rules-\u7684\u4f7f\u7528"},"rules \u7684\u4f7f\u7528"),(0,n.kt)("p",null,"rules\u7684\u4e3b\u8981\u529f\u80fd\u662f\u8fdb\u884c\u6307\u6807\u7684\u8fc7\u6ee4\u548c\u6e05\u6d17\u3002\u8fd8\u6709\u4e00\u4e2a\u529f\u80fd\u662f\u5bf9value\u8fdb\u884c\u8f6c\u5316\u3002prometheus\u65e0\u6cd5\u63a5\u53d7\u5b57\u7b26\u6570\u636e\uff0c\u4f46\u6709\u65f6\u5019\u6211\u4eec\u786e\u5b9e\u9700\u8981\u8fd9\u4e2a\u5b57\u7b26\u4e32\u4fe1\u606f\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u7528rules\u8fdb\u884c\u914d\u7f6e\u8f6c\u5316\u3002\n\u4e0b\u9762\u4ee5\u4e00\u4e2a\u6848\u4f8b\u6765\u4ecb\u7ecdrules\u7684\u4f7f\u7528\u3002"),(0,n.kt)("p",null,"JMX \u7684\u683c\u5f0f\u4e3a\u4e00\u4e2a JSON \u5bf9\u8c61,\u91cc\u9762\u662f\u4e00\u4e2a\u5305\u542b\u591a\u4e2abean\u5bf9\u8c61\u7684\u6570\u7ec4\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{ \n "beans":[\n  {bean},\n  {bean}\n ]\n}\n')),(0,n.kt)("p",null,"\u4e0b\u9762\u662f Hadoop \u76d1\u63a7\u65f6\u5019\u7684\u4e00\u4e2a bean \u5bf9\u8c61\uff0c"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{\n   "name" : "Hadoop:service=NameNode,name=FSNamesystemState",\n   "modelerType" : "org.apache.hadoop.hdfs.server.namenode.FSNamesystem",\n   "PendingReplicationBlocks" : 0,\n   "PendingReconstructionBlocks" : 0,\n   "UnderReplicatedBlocks" : 0,\n   "LowRedundancyBlocks" : 0,\n   "ScheduledReplicationBlocks" : 0,\n   "PendingDeletionBlocks" : 0,\n   "BlockDeletionStartTime" : 1591347343145,\n   "FSState" : "Operational",\n},\n')),(0,n.kt)("p",null,'\u5176\u4e2d "FSState"\u662fHDFS\u6587\u4ef6\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u6709\u4e24\u4e2a\u503c Safemode\uff08\u5b89\u5168\u6a21\u5f0f\uff09\u548cOperational\uff08\u53ef\u4f7f\u7528\uff09\u3002\u6211\u5e0c\u671b\u6211\u7684\u76d1\u63a7\u53ef\u4ee5\u76d1\u6d4b\u5230\u6587\u4ef6\u7cfb\u7edf\u7684\u72b6\u6001\u3002\u53efjmx_exporter\u4e2d\u786e\u627e\u4e0d\u5230\u8fd9\u4e2a\u6307\u6807\u3002\u56e0\u4e3a\u6211\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u7a7a\u7684\uff0cjmx_exporter\u4f1a\u8fc7\u6ee4\u5230\u6240\u6709\u5b57\u7b26\u4e32value\uff0c\u56e0\u4e3aprometheus\u65e0\u6cd5\u63a5\u6536\u3002\u56e0\u6b64\u6211\u9700\u8981\u914d\u7f6erules\u5c06\u5b57\u7b26\u4e32\u8f6c\u5316\u4e3a\u6570\u503c\u578b\u3002\n\u9996\u5148\u662f\u9700\u8981\u6839\u636epattern import\u7684\u683c\u5f0f\u628a\u6307\u6807\u7684\u8f93\u5165\u683c\u5f0f\u5199\u51fa\u6765\uff1a'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"Hadoop<service=NameNode, name=FSNamesystemState><>FSState\uff1avalue\n")),(0,n.kt)("p",null,"\u7136\u540e\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8fdb\u884c\u5224\u65ad\uff0cvalue\u542b\u6709Safemode \u4e3a 0\uff0c \u542b\u6709Operational\u4e3a1\n\u4e3a\u4e86\u4e0e\u5176\u4ed6\u6307\u6807\u7edf\u4e00\uff0c\u6211\u7684name\u7684\u5199\u6cd5\u4e0e\u9ed8\u8ba4\u8f93\u51fa\u76f8\u540c\u3002\n\u6700\u540e\u7684\u914d\u7f6e\u4e3a\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"---\nrules\uff1a\n  - pattern: 'Hadoop<service=NameNode, name=FSNamesystemState><>FSState:.*?Safemode.*?'\n    name: Hadoop_NameNode_FSState\n    value: 0\n  - pattern: 'Hadoop<service=NameNode, name=FSNamesystemState><>FSState:.*?Operational.*?'\n    name: Hadoop_NameNode_FSState\n    value: 1\n  - pattern: '.*'\n")),(0,n.kt)("p",null,"\u6ce8\u610f\u5230\u8fd9\u91cc\u6211\u6700\u540e\u52a0\u4e86\u4e00\u4e2a\u5339\u914d\u6240\u6709\u6307\u6807\u7684\u6b63\u5219\u8868\u8fbe\u3002\u5982\u679c\u4e0d\u52a0\u7684\u8bdd\uff0c\u6700\u540eexporter\u9664\u4e86jvm\u7684\u6307\u6807\uff0c\u53ea\u4f1a\u8f93\u51fa\u5728rules\u4e2d\u5339\u914d\u6210\u529f\u7684\u6307\u6807\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"**\u8fd8\u6709\u4e00\u4e2a\u5341\u5206 tricky \u7684\u70b9\uff01- pattern: \u2018.*\u2019 \u5fc5\u987b\u653e\u5728\u6700\u540e\u3002**\n")),(0,n.kt)("p",null,"\u6211\u4eec\u56de\u5934\u770b\u770brules\u7684\u63cf\u8ff0\uff0c\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6bcf\u4e2a\u6307\u6807\u800c\u4e14\u5b8c\u6210\u5339\u914d\u540e\u5c31\u4f1a\u505c\u6b62\u7ee7\u7eed\u5339\u914d\u3002\u5982\u679c\u628a\u5168\u5c40\u5339\u914d\u653e\u5728\u6700\u524d\uff0c\u90a3\u6240\u6709\u7684\u6307\u6807\u90fd\u4f1a\u88ab\u5339\u914d\u4e0a\uff0c\u5339\u914d\u5c31\u7ed3\u675f\u4e86\u3002\u4f46\u5e26\u5b57\u7b26\u4e32\u7684\u88ab\u8fc7\u6ee4\u6389\u4e86\uff0c\u800c\u4e14\u540e\u9762\u7684\u89c4\u5219\u4e5f\u4e0d\u4f1a\u751f\u6548\u3002\u90a3\u8fd9\u6761\u6307\u6807\u8fd8\u662f\u4e0d\u4f1a\u51fa\u73b0\u5728 jvm_exporter \u7684 httpserver \u4e0a\u3002"),(0,n.kt)("p",null,"\u6b64\u6307\u6807\u5728jmx_exporter\u4e0a\u7684\u5448\u73b0\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"# HELP Hadoop_NameNode_FSState Attribute exposed for management (Hadoop<service=NameNode, name=FSNamesystemState><>FSState)\n# TYPE Hadoop_NameNode_FSState untyped\nHadoop_NameNode_FSState 1.0\n")),(0,n.kt)("h1",{id:"kafka-\u4f7f\u7528-jmx-\u76d1\u63a7"},"Kafka \u4f7f\u7528 jmx \u76d1\u63a7"),(0,n.kt)("p",null,"\u5728 Kafka \u7684\u542f\u52a8\u811a\u672c\u5185\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'export PROMETHEUS_JMX=/usr/local/prometheus-jmx/kafka\nexport KAFKA_OPTS="$KAFKA_OPTS -javaagent:$PROMETHEUS_JMX/jmx_prometheus_javaagent-0.16.1.jar=7071:$PROMETHEUS_JMX/kafka-0-8-2.yml"\n')),(0,n.kt)("p",null,"kafka-0-8-2.yml \u914d\u7f6e\u6587\u4ef6\u6765\u81ea\u4e8e\u4ed3\u5e93 example_configs \u76ee\u5f55\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u9009\u62e9\u3002"),(0,n.kt)("p",null,"\u542f\u52a8\u540e\u8bbf\u95ee 127.0.0.1:7071 \u5c31\u53ef\u4ee5\u62ff\u5230\u76d1\u63a7\u6570\u636e\u3002"),(0,n.kt)("h1",{id:"\u5c0f\u7ed3"},"\u5c0f\u7ed3"),(0,n.kt)("p",null,"JMX Exporter \u7684\u9ed8\u8ba4\u6307\u6807\u6709\u5f88\u591a\uff0c\u5168\u90e8\u6536\u96c6\u5bf9\u76d1\u63a7\u7cfb\u7edf\u7684\u538b\u529b\u5f88\u5927\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\uff0c\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u6765\u5f00\u5173\u4e0d\u540c\u7684\u53c2\u6570\u3002"))}u.isMDXComponent=!0}}]);