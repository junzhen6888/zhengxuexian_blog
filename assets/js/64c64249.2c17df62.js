"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2487],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=u(n),d=a,b=m["".concat(o,".").concat(d)]||m[d]||c[d]||s;return n?r.createElement(b,l(l({ref:t},p),{},{components:n})):r.createElement(b,l({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,l=new Array(s);l[0]=m;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var u=2;u<s;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92207:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var r=n(87462),a=(n(67294),n(3905));const s={},l="Kubernetes \u76d1\u63a7\u6570\u636e\u91c7\u96c6",i={unversionedId:"prometheus/Exporter/3.9-kube-state-metrics",id:"prometheus/Exporter/3.9-kube-state-metrics",title:"Kubernetes \u76d1\u63a7\u6570\u636e\u91c7\u96c6",description:"\u5bf9\u4e8e Kubernetes \u7684\u76d1\u63a7\u5176\u5b9e\u662f\u65e0\u6cd5\u901a\u8fc7\u4e00\u4e2a\u7ec4\u4ef6\u6765\u5b8c\u6210\u76d1\u63a7\u7684\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u5e9e\u5927\u7684\u7cfb\u7edf\u3002\u76ee\u524d\u6765\u8bf4\u76d1\u63a7\u4e00\u4e2a Kubernetes \u6700\u5c11\u9700\u8981\u8fd9\u4e48\u51e0\u4e2a\u7ec4\u4ef6\uff1a",source:"@site/wiki/ops/prometheus/03-Exporter/3.9-kube-state-metrics.md",sourceDirName:"prometheus/03-Exporter",slug:"/prometheus/Exporter/3.9-kube-state-metrics",permalink:"/zhengxuexian_blog/ops/prometheus/Exporter/3.9-kube-state-metrics",draft:!1,tags:[],version:"current",lastUpdatedBy:"zhengxuexian",lastUpdatedAt:1661407442,formattedLastUpdatedAt:"2022\u5e748\u670825\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ClickHouse Exporter",permalink:"/zhengxuexian_blog/ops/prometheus/Exporter/3.8-clickhouse-exporter"},next:{title:"\u5c0f\u7ed3",permalink:"/zhengxuexian_blog/ops/prometheus/Exporter/END"}},o={},u=[],p={toc:u};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"kubernetes-\u76d1\u63a7\u6570\u636e\u91c7\u96c6"},"Kubernetes \u76d1\u63a7\u6570\u636e\u91c7\u96c6"),(0,a.kt)("p",null,"\u5bf9\u4e8e Kubernetes \u7684\u76d1\u63a7\u5176\u5b9e\u662f\u65e0\u6cd5\u901a\u8fc7\u4e00\u4e2a\u7ec4\u4ef6\u6765\u5b8c\u6210\u76d1\u63a7\u7684\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u5e9e\u5927\u7684\u7cfb\u7edf\u3002\u76ee\u524d\u6765\u8bf4\u76d1\u63a7\u4e00\u4e2a Kubernetes \u6700\u5c11\u9700\u8981\u8fd9\u4e48\u51e0\u4e2a\u7ec4\u4ef6\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Node Exporter \uff1aPrometheus \u51fa\u54c1\uff0c\u76d1\u63a7\u6240\u6709\u7684\u5bbf\u4e3b\u673a"),(0,a.kt)("li",{parentName:"ul"},"cAdvisor \uff1a Google \u51fa\u54c1\uff0c\u76d1\u63a7\u6240\u6709\u7684\u5bb9\u5668"),(0,a.kt)("li",{parentName:"ul"},"kube-state-metrics \uff1aKubernetes \u51fa\u54c1\uff0c\u76d1\u63a7 Kubernetes \u81ea\u5df1\u96c6\u7fa4\u8fd9\u4e2a\u5c42\u9762\u7684\u6307\u6807\u3002")),(0,a.kt)("p",null,"\u8fd9\u662f\u6700\u7cbe\u7b80\u7684\u7ec4\u5408\u4e86\uff0c\u5982\u679c Kubernetes \u7684 Master \u5c06\u6570\u636e\u5b58\u50a8\u5728\u4e86 Etcd \u96c6\u7fa4\u7684\u6362\u8fd8\u9700\u8981 Etcd Exporter \u3002\u5982\u679c Kubernetes \u542f\u7528\u4e86 ingress \u7b49\u7f51\u7edc\u4ee3\u7406\u4e5f\u9700\u8981\u8fdb\u884c\u76d1\u63a7\u3002\u5982\u679c Kubernetes \u6302\u8f7d\u4e86\u5b58\u50a8\u96c6\u7fa4\u6765\u63d0\u4f9b\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b58\u50a8\u96c6\u7fa4\u4e5f\u9700\u8981\u76d1\u63a7\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u6211\u4eec\u6765\u770b\u770b kube-state-metrics \u600e\u4e48\u4f7f\u7528\u3002\u8bdd\u8bf4 Kubernetes \u672c\u8eab\u5176\u5b9e\u662f\u63d0\u4f9b\u4e86Prometheus \u6570\u636e\u91c7\u96c6\u63a5\u53e3\u7684\uff0c\u4f46\u662f\u914d\u7f6e\u8d77\u6765\u592a\u9ebb\u70e6\u4e86\u3002\u6211\u89c9\u5f97\u8fd8\u662f\u7528 kube-state-metrics \u7b80\u5355\u4e00\u4e9b\u3002\u5f53\u7136\uff0c\u5177\u4f53\u751f\u4ea7\u8fc7\u7a0b\u4e2d\u770b\u9700\u6c42\u3002"),(0,a.kt)("p",null,"\u5f53\u524d kube-state-metrics \u7248\u672c\u662f v2.2.4 \uff0c\u53d1\u5e03\u4e8e 2021.11.11 \uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d \u8fd9\u4e2a\u7248\u672c\u7684\u9009\u62e9\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u662f\u548c Kubernetes \u7684\u7248\u672c\u6709\u5173\u8054\u7684\uff0c\u5982\u679cKubernetes \u7248\u672c\u592a\u4f4e\u7684\u8bdd\uff0c\u9700\u8981\u4f7f\u7528\u5386\u53f2\u7248\u672c\uff0c\u5e76\u4e14 Kubernetes \u5347\u7ea7\u7684\u65f6\u5019\u4e5f\u8981\u8bc4\u4f30 kube-state-metrics \u662f\u5426\u4e5f\u8981\u4e00\u8d77\u5347\u7ea7\u3002"),(0,a.kt)("p",null,"\u9020\u6210\u8fd9\u4e2a\u5173\u8054\u5173\u7cfb\u7684\u539f\u56e0\u662f kube-state-metrics \u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/client-go"},"client-go")," \u4e0e Kubernetes \u96c6\u7fa4\u4ea4\u4e92\u3002\u53d7\u652f\u6301\u7684 Kubernetes \u96c6\u7fa4\u7248\u672c\u7531 client-go \u51b3\u5b9a\u3002client-go \u548c Kubernetes \u96c6\u7fa4\u7684\u517c\u5bb9\u6027\u77e9\u9635\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,"\u4e0b\u9762\u662f kube-state-metrics \u6700\u65b0 5 \u4e2a\u7248\u672c\u548c Kubernetes \u6700\u65b0 5 \u4e2a\u7248\u672c\u7684\u517c\u5bb9\u60c5\u51b5\u3002"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"kube-state-metrics"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes 1.18"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes 1.19"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes 1.20"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes 1.21"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes 1.22"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"v1.9.8"),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"-"),(0,a.kt)("td",{parentName:"tr",align:null},"-")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"v2.0.0"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"v2.1.1"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"v2.2.4"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"master"),(0,a.kt)("td",{parentName:"tr",align:null},"-/\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2713")))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u2713 \u8868\u793a\u5b8c\u5168\u652f\u6301\u8fd9\u4e2a\u7248\u672c\u533a\u95f4\u5185\u7684\u529f\u80fd"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u8868\u793a Kubernetes \u96c6\u7fa4\u6709\u4e00\u4e9b client-go \u5e93\u65e0\u6cd5\u4f7f\u7528\u7684\u7279\u6027(\u6bd4\u5982\u989d\u5916\u7684API\u5bf9\u8c61\u3001\u5f03\u7528\u7684API\u7b49)\u3002")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5f53\u524d\u7684 kube-state-metrics v2.0.0+ \u7248\u672c\u5728 Kubernetes v1.17 \u548c v1.18 \u4e0a\u5de5\u4f5c\uff0c\u4e0d\u5305\u62ec Ingress \u6216 CertificateSigningRequest \u8d44\u6e90\u6307\u6807\u3002\u5982\u679c\u5728\u8f83\u65e7\u7684 Kubernetes \u7248\u672c\u4e0a\u9700\u8981\u8fd9\u4e9b\u5ea6\u91cf\uff0c\u8bf7\u4f7f\u7528 kube-state-metrics v1.9.8 \u7248\u672c\u3002")),(0,a.kt)("p",null,"Kubernetes \u5728\u540c\u4e00\u4e2a\u7248\u672c\u7684\u4ece alpha \u5230 beta \u5230 \u6700\u540e GA\uff0c\u5176\u4e2d\u7684\u4e00\u4e9b\u63d2\u4ef6\u7684\u7248\u672c\u53ef\u80fd\u4f1a\u6709\u53d8\u5316\uff0ckube-state-metrics \u53ef\u4ee5\u5728\u8be5\u7248\u672c\u7684\u91cc\u6700\u8001\u7684 API \u7248\u672c\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u4e3e\u4f8b\uff1a\u7248\u672c\u662f\u968f\u4fbf\u5199\u7684\uff0c\u6bd4\u5982\u5728 Kubernetes 1.20.0  \u7684 alph \u3001Beta\u3001GA \u7248\u672c\u4e2d\uff0c\u67d0\u4e2a\u63a5\u53e3\u4ece 1.0 \u53d8\u5316\u5230\u4e86 1.5 \uff0c\u90a3\u4e48\uff0ckube-state-metrics \u662f\u652f\u6301\u8be5\u63a5\u53e3\u7684 1.0 \u7248\u672c\u7684\u3002\u5c31\u662f\u8fd9\u4e2a\u610f\u601d\u3002"),(0,a.kt)("h1",{id:"\u6307\u6807"},"\u6307\u6807"),(0,a.kt)("p",null,"kube-state-metrics \u56e0\u4e3a\u5bfc\u51fa\u4e86 Kubernetes \u96c6\u7fa4\u91cc\u96c6\u7fa4\u7ea7\u522b\u7684\u6240\u6709\u6307\u6807\uff0c\u6240\u4ee5\u6307\u6807\u6570\u91cf\u5de8\u591a\uff0c\u8be6\u7ec6\u7684\u6307\u6807\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u6587\u6863  ",(0,a.kt)("inlineCode",{parentName:"p"},"https://github.com/kubernetes/kube-state-metrics/tree/master/docs")," \uff0c\u5212\u5206\u7684\u8bdd\u6709\u4ee5\u4e0b\u7c7b\u578b\u7684\u6307\u6807\u53ef\u4ee5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"CertificateSigningRequest Metrics\nConfigMap Metrics\nCronJob Metrics\nDaemonSet Metrics\nDeployment Metrics\nEndpoint Metrics\nHorizontal Pod Autoscaler Metrics\nIngress Metrics\nJob Metrics\nLease Metrics\nLimitRange Metrics\nMutatingWebhookConfiguration Metrics\nNamespace Metrics\nNetworkPolicy Metrics\nNode Metrics\nPersistentVolume Metrics\nPersistentVolumeClaim Metrics\nPod Disruption Budget Metrics\nPod Metrics\nReplicaSet Metrics\nReplicationController Metrics\nResourceQuota Metrics\nSecret Metrics\nService Metrics\nStatefulSet Metrics\nStorageClass Metrics\nValidatingWebhookConfiguration Metrics\nVerticalPodAutoscaler Metrics\nVolumeAttachment Metrics\n")),(0,a.kt)("p",null,"\u8fd9\u4e9b\u6307\u6807\u7684\u9636\u6bb5\u5206\u6210 3 \u7c7b\uff0c\u5206\u522b\u662f EXPERIMENTAL \u3001STABLE \u3001DEPRECATED \u4e09\u4e2a\u9636\u6bb5\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"EXPERIMENTAL \u662f\u4e00\u4e9b\u5904\u4e8e\u5b9e\u9a8c\u6027\u8d28\u7684\u6307\u6807\uff0c\u5728\u540e\u8fb9\u7684\u7248\u672c\u4e2d\u6709\u53ef\u80fd\u8fd8\u6709\uff0c\u6709\u53ef\u80fd\u5c31\u6ca1\u6709\u4e86\u3002"),(0,a.kt)("li",{parentName:"ul"},"STABLE \u662f\u7a33\u5b9a\u7684\u6307\u6807\uff0c\u5728\u6bcf\u4e2a\u4e3b\u677f\u7684\u66f4\u65b0\u4e2d\u90fd\u6709\u3002"),(0,a.kt)("li",{parentName:"ul"},"DEPRECATED \u662f\u5230\u4e86\u65e2\u5b9a\u7684\u65f6\u95f4\u4f1a\u5e9f\u5f03\u7684\u6307\u6807\u3002")),(0,a.kt)("p",null,"\u5f53\u9700\u8981\u4e00\u4e2a\u989d\u5916\u7684\uff0c\u9ed8\u8ba4\u6ca1\u6709\u63d0\u4f9b\u7684\u6807\u7b7e\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 Prometheus \u5339\u914d\u64cd\u4f5c\u7b26\u6765\u6269\u5c55\u5355\u4e2a\u5ea6\u91cf\u8f93\u51fa\u3002"),(0,a.kt)("p",null,"\u4e0b\u8fb9\u8fd9\u4e2a\u4f8b\u5b50\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"label_release")," \u6dfb\u52a0\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"kube_pod_status_ready")," \u6307\u6807\u7684\u9ed8\u8ba4\u6807\u7b7e\u96c6\u5408\uff0c\u5e76\u5141\u8bb8\u60a8\u901a\u8fc7 Helm \u53d1\u5e03 label \u6216\u5206\u7ec4\u6307\u6807:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kube_pod_status_ready * on (namespace, pod) group_left(label_release) kube_pod_labels\n")),(0,a.kt)("p",null,"\u53e6\u4e00\u4e2a\u6709\u7528\u7684\u4f8b\u5b50\u662f\u6309\u9636\u6bb5\u67e5\u8be2 pod \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u4f8b\u5982 Running :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'sum(kube_pod_container_resource_requests{resource="memory"}) by (namespace, pod, node)\n  * on (namespace, pod) group_left() (sum(kube_pod_status_phase{phase="Running"}) by (pod, namespace) == 1)\n')),(0,a.kt)("h1",{id:"\u542f\u52a8\u53c2\u6570"},"\u542f\u52a8\u53c2\u6570"),(0,a.kt)("p",null,"kube-state-metrics \u542f\u52a8\u7684\u65f6\u5019\u6709\u4e00\u4e9b\u529f\u80fd\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u53bb\u63a7\u5236\uff0c\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u5728\u672c\u5730\u8fd0\u884c\u65f6\u7684\u542f\u52a8\u8fc7\u7a0b\u4e2d\u4f20\u9012: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kube-state-metrics --telemetry-port=8081 --kubeconfig=<KUBE-CONFIG> --apiserver=<APISERVER> \n")),(0,a.kt)("p",null,"\u9664\u4e86\u57fa\u672c\u7684\u6307\u5b9a\u7aef\u53e3\u548c\u914d\u7f6e\u6587\u4ef6\uff0c\u8fd8\u6709\u5176\u4ed6\u5f88\u591a\u53c2\u6570\u53ef\u4ee5\u4f7f\u7528\uff0c\u5177\u4f53\u5982\u4e0b\uff0c\u6211\u4eec\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u8fdb\u884c\u9009\u62e9\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ kube-state-metrics -h\nUsage of ./kube-state-metrics:\n      --add_dir_header                        If true, adds the file directory to the header of the log messages\n      --alsologtostderr                       log to standard error as well as files\n      --apiserver string                      The URL of the apiserver to use as a master\n      --enable-gzip-encoding                  Gzip responses when requested by clients via 'Accept-Encoding: gzip' header.\n  -h, --help                                  Print Help text\n      --host string                           Host to expose metrics on. (default \"::\")\n      --kubeconfig string                     Absolute path to the kubeconfig file\n      --log_backtrace_at traceLocation        when logging hits line file:N, emit a stack trace (default :0)\n      --log_dir string                        If non-empty, write log files in this directory\n      --log_file string                       If non-empty, use this log file\n      --log_file_max_size uint                Defines the maximum size a log file can grow to. Unit is megabytes. If the value is 0, the maximum file size is unlimited. (default 1800)\n      --logtostderr                           log to standard error instead of files (default true)\n      --metric-allowlist string               Comma-separated list of metrics to be exposed. This list comprises of exact metric names and/or regex patterns. The allowlist and denylist are mutually exclusive.\n      --metric-annotations-allowlist string   Comma-separated list of Kubernetes annotations keys that will be used in the resource' labels metric. By default the metric contains only name and namespace labels. To include additional annotations provide a list of resource names in their plural form and Kubernetes annotation keys you would like to allow for them (Example: '=namespaces=[kubernetes.io/team,...],pods=[kubernetes.io/team],...)'. A single '*' can be provided per resource instead to allow any annotations, but that has severe performance implications (Example: '=pods=[*]').\n      --metric-denylist string                Comma-separated list of metrics not to be enabled. This list comprises of exact metric names and/or regex patterns. The allowlist and denylist are mutually exclusive.\n      --metric-labels-allowlist string        Comma-separated list of additional Kubernetes label keys that will be used in the resource' labels metric. By default the metric contains only name and namespace labels. To include additional labels provide a list of resource names in their plural form and Kubernetes label keys you would like to allow for them (Example: '=namespaces=[k8s-label-1,k8s-label-n,...],pods=[app],...)'. A single '*' can be provided per resource instead to allow any labels, but that has severe performance implications (Example: '=pods=[*]').\n      --namespaces string                     Comma-separated list of namespaces to be enabled. Defaults to \"\"\n      --namespaces-denylist string            Comma-separated list of namespaces not to be enabled. If namespaces and namespaces-denylist are both set, only namespaces that are excluded in namespaces-denylist will be used.\n      --one_output                            If true, only write logs to their native severity level (vs also writing to each lower severity level)\n      --pod string                            Name of the pod that contains the kube-state-metrics container. When set, it is expected that --pod and --pod-namespace are both set. Most likely this should be passed via the downward API. This is used for auto-detecting sharding. If set, this has preference over statically configured sharding. This is experimental, it may be removed without notice.\n      --pod-namespace string                  Name of the namespace of the pod specified by --pod. When set, it is expected that --pod and --pod-namespace are both set. Most likely this should be passed via the downward API. This is used for auto-detecting sharding. If set, this has preference over statically configured sharding. This is experimental, it may be removed without notice.\n      --port int                              Port to expose metrics on. (default 8080)\n      --resources string                      Comma-separated list of Resources to be enabled. Defaults to \"certificatesigningrequests,configmaps,cronjobs,daemonsets,deployments,endpoints,horizontalpodautoscalers,ingresses,jobs,leases,limitranges,mutatingwebhookconfigurations,namespaces,networkpolicies,nodes,persistentvolumeclaims,persistentvolumes,poddisruptionbudgets,pods,replicasets,replicationcontrollers,resourcequotas,secrets,services,statefulsets,storageclasses,validatingwebhookconfigurations,volumeattachments\"\n      --shard int32                           The instances shard nominal (zero indexed) within the total number of shards. (default 0)\n      --skip_headers                          If true, avoid header prefixes in the log messages\n      --skip_log_headers                      If true, avoid headers when opening log files\n      --stderrthreshold severity              logs at or above this threshold go to stderr (default 2)\n      --telemetry-host string                 Host to expose kube-state-metrics self metrics on. (default \"::\")\n      --telemetry-port int                    Port to expose kube-state-metrics self metrics on. (default 8081)\n      --tls-config string                     Path to the TLS configuration file\n      --total-shards int                      The total number of shards. Sharding is disabled when total shards is set to 1. (default 1)\n      --use-apiserver-cache                   Sets resourceVersion=0 for ListWatch requests, using cached resources from the apiserver instead of an etcd quorum read.\n  -v, --v Level                               number for the log level verbosity\n      --version                               kube-state-metrics build version information\n      --vmodule moduleSpec                    comma-separated list of pattern=N settings for file-filtered logging\n")),(0,a.kt)("h1",{id:"\u81ea\u8eab\u76d1\u63a7"},"\u81ea\u8eab\u76d1\u63a7"),(0,a.kt)("p",null,"\u57fa\u4e8e\u4e91\u539f\u751f\u548c Prometheus \u7684\u76d1\u63a7\u8bbe\u8ba1\u601d\u60f3\uff0c\u4e00\u4e2a\u7ec4\u4ef6\u662f\u8981\u80fd\u63d0\u4f9b\u81ea\u5df1\u7684\u8fd0\u884c\u72b6\u6001\u3002Kube-state-metrics  \u4e5f\u662f\u80fd\u505c\u81ea\u5df1\u7684\u8fd0\u884c\u60c5\u51b5\u7684\uff0c\u5b83\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"-\u2014telemetry-host")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"-\u2014telemetry-port"),"(\u9ed8\u8ba48081)\u4e0b\u516c\u5f00\u81ea\u5df1\u7684\u901a\u7528\u8fdb\u7a0b\u6307\u6807\u3002"),(0,a.kt)("p",null,"Kube-state-metrics \u4f1a\u516c\u5f00\u67e5\u770b\u6210\u529f\u548c\u9519\u8bef\u6307\u6807\u7684\u5217\u8868\uff0c\u8fd9\u4e9b\u53ef\u4ee5\u7528\u6765\u8ba1\u7b97\u76d1\u89c6\u8d44\u6e90\u7684\u9519\u8bef\u7387\u3002\u5982\u679c\u5728 Metric \u4e2d\u9047\u5230\u8fd9\u4e9b\u9519\u8bef\uff0c\u5f88\u53ef\u80fd\u662f\u914d\u7f6e\u6216\u6743\u9650\u95ee\u9898\uff0c\u63a5\u4e0b\u6765\u8981\u67e5\u770b\u7684\u662f kube-state-metrics \u7684\u65e5\u5fd7\u6765\u8fdb\u884c\u5b9a\u4f4d\u95ee\u9898\u539f\u56e0\u3002"),(0,a.kt)("p",null,"\u91c7\u96c6\u6307\u6807\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'kube_state_metrics_list_total{resource="*v1.Node",result="success"} 1\nkube_state_metrics_list_total{resource="*v1.Node",result="error"} 52\nkube_state_metrics_watch_total{resource="*v1beta1.Ingress",result="success"} 1\n')),(0,a.kt)("h1",{id:"\u8d44\u6e90\u5efa\u8bae"},"\u8d44\u6e90\u5efa\u8bae"),(0,a.kt)("p",null,"Kubernetes \u96c6\u7fa4\u4e2d Pods/Nodes/Deployments/Secrets \u7b49\u7b49\u7684\u6570\u91cf\u51b3\u5b9a\u4e86 Kubernetes \u96c6\u7fa4\u7684\u89c4\u6a21\u3002\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\uff0c\u96c6\u7fa4\u4e2d\u7684 Kubernetes \u89c4\u6a21\u4e0e\u96c6\u7fa4\u7684\u8282\u70b9\u6570\u91cf\u6210\u6b63\u6bd4\u3002"),(0,a.kt)("p",null,"\u4e00\u822c\u6765\u8bf4 kube-state-metrics \u5e94\u8be5\u6700\u5c11\u5206\u914d 256 MiB \u7684\u5185\u5b58\u548c 0.1 Core \u7684 CPU \u3002\u8fd9\u4e2a\u914d\u7f6e\u4e00\u822c\u6765\u8bf4\u5728 Kubernetes \u96c6\u7fa4 work \u8282\u70b9\u5c0f\u4e8e 100 \u7684\u65f6\u5019\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5927\u4e8e 100 \u5c0f\u4e8e 1000 \u7684\u65f6\u5019\u8bf7\u9002\u91cf\u653e\u5f00\u8fd9\u4e2a\u9650\u5236\uff0c\u5f53\u5927\u4e8e 1000 \u8282\u70b9\u65f6\uff0c\u8bf7\u5148\u8fdb\u884c\u538b\u6d4b\u3002"),(0,a.kt)("p",null,"\u6ce8\u610f\uff0c\u5982\u679cCPU\u9650\u5236\u8bbe\u7f6e\u5f97\u592a\u4f4e\uff0ckube-state-metrics\u7684\u5185\u90e8\u961f\u5217\u5c06\u65e0\u6cd5\u8db3\u591f\u5feb\u5730\u5b8c\u6210\u5de5\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u968f\u7740\u961f\u5217\u957f\u5ea6\u7684\u589e\u957f\u800c\u589e\u52a0\u5185\u5b58\u6d88\u8017\u3002\u5982\u679c\u9047\u5230\u7531\u9ad8\u5185\u5b58\u5206\u914d\u6216CPU\u8282\u6d41\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u8bf7\u5c1d\u8bd5\u63d0\u9ad8CPU\u9650\u5236\u3002"),(0,a.kt)("p",null,"kube-state-metrics \u5b98\u65b9\u8fdb\u884c\u4e86\u5ef6\u8fdf\u7684\u6d4b\u8bd5\uff0c\u5728 100 \u4e2a\u8282\u70b9\u7684 Kubernetes \u96c6\u7fa4\u4e2d\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'"Perc50": 259615384 ns,\n"Perc90": 475000000 ns,\n"Perc99": 906666666 ns.\n')),(0,a.kt)("h1",{id:"\u5c0f\u7ed3"},"\u5c0f\u7ed3"),(0,a.kt)("p",null,"\u5148\u5c31\u8fd9\u4e9b\u5427\uff0c\u548c Kubernetes \u4e00\u6837\uff0c\u91cc\u8fb9\u7684\u6307\u6807\u9009\u53d6\uff0c\u8fd8\u6709\u76d1\u63a7\u753b\u56fe\u90fd\u662f\u5927\u5934\uff0c\u6709\u65f6\u95f4\u4e86\u518d\u804a\u3002"))}c.isMDXComponent=!0}}]);