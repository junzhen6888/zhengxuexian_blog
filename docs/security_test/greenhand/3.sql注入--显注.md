---
title: sql注入--显注
description: sql注入--显注
sidebar_position: 3
last_update:
  author: 郑学贤
---
# sql注入--显注

## 什么是sql注入

SQL注入，就是通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令，比如先前的很多影视网站泄露VIP会员密码大多就是通过WEB表单递交查询字符暴出的，这类表单特别容易受到SQL注入式攻击。

## sql注入的危害

数据库信息泄漏：数据库中存放的用户的隐私信息的泄露。
网页篡改：通过操作数据库对特定网页进行篡改。
网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。
数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。
服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。
破坏硬盘数据，瘫痪全系统。

## mysql数据库基本常识

查操作系统版本信息：@@global.version_compile_os
查数据库版本信息：version() 
查当前应用数据库：database()
查当前用户：user()
mysql默认库information_schema  
数据库视图表schemata   
表视图表tables
列视图表columns

## mysql注入原理

SQL注入攻击指的是通过构建特殊的输入作为参数传入Web应用程序，而这些输入大都是SQL语法里的一些组合，通过执行SQL语句进而执行攻击者所要的操作，其主要原因是程序没有细致地过滤用户输入的数据，致使非法数据侵入系统。
根据相关技术原理，SQL注入可以分为平台层注入和代码层注入。前者由不安全的数据库配置或数据库平台的漏洞所致；后者主要是由于程序员对输入未进行细致地过滤，从而执行了非法的数据查询。基于此，SQL注入的产生原因通常表现在以下几方面：
1. 不当的类型处理；
2. 不安全的数据库配置；
3. 不合理的查询集处理；
4. 不当的错误处理；
5. 转义字符处理不合适；
6. 多个提交处理不当。

找注入点思路：
1. and  1=1   和 and  1=2  寻找是否有注入点 
2. order  by 猜列
3. and 1=2 union  select  1,2,3,…,n  找出可以注入的列位置
4. 判断版本 and 1=2 union select 1,2,version(),4,5,6,7
5. 获取数据库名  and 1=2 union select SCHEMA_NAME,2 from information_schema.SCHEMATA limit 0,1
6. 获取表名  and 1=2 union select TABLE_NAME,2 from information_schema.TABLES where TABLE_SCHEMA=0x636E775F70617373706F7274 limit 0,1
7. 获取列名 and 1=2 union select column_name,2 from information_schema.columns where table_name=0x75736572 limit 1,1
8. 获取表中的数据and 1=2 union select  列名  from  表名

## 寻找注入点

表单提交，主要是POST、GET请求
Cookie参数提交
HTTP请求头部的一些可修改的值，比如Referer、User_Agent等
一些边缘的输入点，比如.mp3文件的一些文件信息等。

## 如何防范sql注入

1. 有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到SQL语句中。当前几乎所有的数据库系统都提供了参数化SQL语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。

2. 对进入数据库的特殊字符（'"\尖括号&*;等）进行转义处理，或编码转换。

3. 严格限制变量类型，比如整型变量就采用intval()函数过滤，数据库中的存储字段必须对应为int型。

4. 数据长度应该严格规定，能在一定程度上防止比较长的SQL注入语句无法正确执行。
   
5. 网站每个数据层的编码统一，建议全部使用UTF-8编码，上下层编码不一致有可能导致一些过滤模型被绕过。

6. 严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击对数据库的危害。

7. 避免网站显示SQL错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。

8. 在网站发布之前建议使用一些专业的SQL注入检测工具进行检测，及时修补这些SQL注入漏洞。

9. 确认PHP配置文件中的magicquotesgpc选项保持开启

10. 通过白名单思路，使用间接对象引用。前端传递引用数字或者字符串等，用于与后端做数组映射，这样可以隐藏数据库数据字典效果，避免直接引用带来的危害。

11. 防火墙中过滤关键字（order by、union等）

### 防范sql注入高级思维

简单的二次开发都可以防御很多攻击：
1. 假如自己能对mysql进行二次开发，把所有的selectunion命令简单的改名，改成没有人知道的只有你自己知道的名字，你用担心sql注入吗？
2. 假如自己对mysql进行二次开发，改变sql标准，逻辑，你还怕or/and注入吗？
3. 假如自己定义一套自己的开发语言，不用什么cphp你还怕什么?
4. 大规模定制改造linux把所有的命令，系统调用经行二次开发，你还怕黑客入侵吗？人家连ls命令都不知道怎么弄！
5. 完全抛弃mysql/mongodb等有sql注入风险的数据库，采用redis或其他简单的能满足你当前业务的nosql数据库,实在要逻辑，要什么触发功能，请用lua/php实现，清除所有无用的功能，就和linux权限一样颗粒化一切，不要的，无用的统统丢掉，一个不剩！
6. 对当前采用linux系统nginx/apache等等，全部进行源代码简单修改，核心功能算法不能更改，我们就不能更改命令名称，用户ui接口？打个比方把mysql的select命令和各种对应的编码调用名称改掉，哪里来的sql注入呢？




