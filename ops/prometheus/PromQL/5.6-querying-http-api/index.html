<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-ops docs-doc-id-prometheus/PromQL/5.6-querying-http-api">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/zhengxuexian_blog/blog/rss.xml" title="zhengxuexian_blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zhengxuexian_blog/blog/atom.xml" title="zhengxuexian_blog Atom Feed"><title data-rh="true">Prometheus HTTP API 查询 | zhengxuexian_blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/PromQL/5.6-querying-http-api"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="keywords" content="功能测试, app测试, web测试, api, 接口测试, 自动化测试, python, java, 性能测试, 渗透测试"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-ops-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-ops-current"><meta data-rh="true" property="og:title" content="Prometheus HTTP API 查询 | zhengxuexian_blog"><meta data-rh="true" name="description" content="在 Prometheus 服务器的 /api/v1 下可以访问当前稳定的 HTTP API。新添加的 API 接口在如果没有任务破坏性，也会加在这个 endpoint 。"><meta data-rh="true" property="og:description" content="在 Prometheus 服务器的 /api/v1 下可以访问当前稳定的 HTTP API。新添加的 API 接口在如果没有任务破坏性，也会加在这个 endpoint 。"><link data-rh="true" rel="icon" href="/zhengxuexian_blog/img/logo.png"><link data-rh="true" rel="canonical" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/PromQL/5.6-querying-http-api"><link data-rh="true" rel="alternate" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/PromQL/5.6-querying-http-api" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/PromQL/5.6-querying-http-api" hreflang="x-default"><link rel="stylesheet" href="/zhengxuexian_blog/assets/css/styles.5e821d6f.css">
<link rel="preload" href="/zhengxuexian_blog/assets/js/runtime~main.f31cac53.js" as="script">
<link rel="preload" href="/zhengxuexian_blog/assets/js/main.06701ae6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zhengxuexian_blog/"><b class="navbar__title text--truncate">🛫 测试博客</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🛴 功能测试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/greenhand">新手村</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/flow">测试流程</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/guide">测试规范</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/kbs">测试知识</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/auto">🚚 自动化</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🚑 性能测试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/base">性能基础</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/ctrl">性能监控</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/jmeter">jmeter汇总</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/locust">locust汇总</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">⚔️ 渗透测试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/kali">kali汇总</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/new">安全入门</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/manage">🧮 测试管理</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🚌 开发百科</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/dev">程序语言</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/database">数据库</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zhengxuexian_blog/ops">网络运维</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/algo">逻辑算法</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/tool">⛽ 测试工具</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/zhengxuexian_blog/"><b>🛫 测试博客</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zhengxuexian_blog/ops/">云服务器使用注意事项</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zhengxuexian_blog/ops/category/linux基础">linux基础</a><button aria-label="打开/收起侧边栏菜单「linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zhengxuexian_blog/ops/category/docker基础">docker基础</a><button aria-label="打开/收起侧边栏菜单「docker基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zhengxuexian_blog/ops/category/prometheus">prometheus</a><button aria-label="打开/收起侧边栏菜单「prometheus」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Basic/">第一章 认识 Prometheus</a><button aria-label="打开/收起侧边栏菜单「第一章 认识 Prometheus」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Server/">第二章 Prometehus 服务</a><button aria-label="打开/收起侧边栏菜单「第二章 Prometehus 服务」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Exporter/">第三章</a><button aria-label="打开/收起侧边栏菜单「第三章」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/AlarmManager/">README</a><button aria-label="打开/收起侧边栏菜单「README」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/">第五章</a><button aria-label="打开/收起侧边栏菜单「第五章」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.1-querying-basics">Prometheus 基础查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.2-querying-operators">Prometheus 查询操作符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.3-querying-operator-examples">Prometheus查询操作符例子</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.4-querying-functions">Prometheus 内置函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.5-querying-functions-examples">子查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.6-querying-http-api">Prometheus HTTP API 查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.7-querying-http-admin-api">查询 Prometheus 管理员接口</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/END">小结</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Instrumenting/grafana-kubernetes-config-persistence">Instrumenting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/">第七章 集群与高可用</a><button aria-label="打开/收起侧边栏菜单「第七章 集群与高可用」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ServiceDiscovery/">第八章 服务发现</a><button aria-label="打开/收起侧边栏菜单「第八章 服务发现」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/BestPractices/">第十章  最佳实践</a><button aria-label="打开/收起侧边栏菜单「第十章  最佳实践」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/">云计算服务提供商</a><button aria-label="打开/收起侧边栏菜单「云计算服务提供商」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Troubleshoot/">问题排查</a><button aria-label="打开/收起侧边栏菜单「问题排查」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Prometheus HTTP API 查询</h1><p>在 Prometheus 服务器的 <code>/api/v1</code> 下可以访问当前稳定的 HTTP API。新添加的 API 接口在如果没有任务破坏性，也会加在这个 endpoint 。</p><h1>接口格式</h1><p>Prometheus 的 API 响应格式是 JSON，每一个成功的 API 请求都会返回 <code>2xx</code> 的状态码。</p><p>针对 Prometheus 的 API 的无效请求会返回一个 JSON 的错误对象，并且会返回下列 HTTP 响应码：</p><ul><li>400 Bad Request  ： 一般情况下是参数丢失或者错误造成的。</li><li>422 Unprocessable Entity ：一般情况下是表达式无法执行。</li><li>503 Service Unavailable ： 一般情况下是请求超时或者被中止了。</li></ul><p>当请求没有到达 API 就发生错误的时候，会返回其他非 2xx 的状态码。</p><p>如果请求中存在不妨碍请求执行的错误， Prometheus 可能返回一组警告。所有请求成功的数据将在对应的数据字段中返回。</p><p>JSON  响应的返回格式如下：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot; | &quot;error&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">data</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 仅当 status 为 error 时设置。数据字段仍然可以保存额外的数据。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;errorType&quot;: &quot;\</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">string\</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error&quot;: &quot;\</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">string\</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 仅当执行请求时有警告时，数据字段中仍然有数据.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;warnings&quot;: [&quot;\</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">string\</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通用的占位符定义如下：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">rfc3339</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">|</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">unix_timestamp</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">: 一般输入的时间戳以 RFC3339 的格式来进行提供，或者是一个单位是秒的 Unix 时间戳， 可选的小数位数表示秒级精度。输出时间戳是 Unix时间戳，单位为秒。 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">series_selector</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">: Prometheus 时间序列选择器像</span><span class="token code-snippet code keyword" style="color:#00009f">`http_requests_total`</span><span class="token plain"> 或 </span><span class="token code-snippet code keyword" style="color:#00009f">`http_requests_total{方法=~&quot;(GET|POST)}`</span><span class="token plain">，需要 URL-encoded。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> \</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">duration\</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">: Prometheus 的时间字符。比如 </span><span class="token code-snippet code keyword" style="color:#00009f">`5m`</span><span class="token plain"> 表示 5 分钟。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">bool</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">: 布尔值， true 或者 false 。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>表达式查询</h1><p>查询语言表达式可以在计算瞬间向量，也可以在计算范围向量。下面的小节描述每种类型的表达式查询的API端点。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="瞬时查询">瞬时查询<a class="hash-link" href="#瞬时查询" title="标题的直接链接">​</a></h2><p>使用 GET 或者 POST 访问下列 API 接口，可以在单个时间点计算瞬时查询:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /api/v1/query</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>URL</code> 查询参数：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> query=\</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">string\</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> : Prometheus 查询表达式。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> time=</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">rfc3339</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">|</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">unix_timestamp</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> : 时间戳，可选的一个选项，不填的话查询当前时间的值，支持 UNIX 时间戳和 RFC 3339 格式的时间描述。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">*</span><span class="token plain"> timeout=\</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">duration\</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> : 超时时间，是一个可选的选项。默认使用 </span><span class="token code-snippet code keyword" style="color:#00009f">`-query.timeout`</span><span class="token plain">  指定的值。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在请求 API 接口时可以使用 POST 方法 并且 header 头可以使用 <code>Content-Type: application/x-www-form-urlencoded</code> , 当大查询中包含违反服务端 URL 字符限制时比较有用。</p><p>查询结果的数据部分格式如下:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;resultType&quot;: &quot;matrix&quot; | &quot;vector&quot; | &quot;scalar&quot; | &quot;string&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;result&quot;: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>&lt;value&gt;</code> 是查询结果，根据查询的类型不同，格式也不一样。</p><p>下面这个示例会查询 <code>up</code> 指标在 <code>2021-11-08T23:10:51.781Z</code> 时间的值。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;http://localhost:9090/api/v1/query?query=up&amp;time=2021-11-08T23:10:51.781Z&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;status&quot; : &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;data&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;resultType&quot; : &quot;vector&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;result&quot; : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;metric&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;job&quot; : &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;instance&quot; : &quot;localhost:9090&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;value&quot;: [ 1636384171.781, &quot;1&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;metric&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;job&quot; : &quot;node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;instance&quot; : &quot;localhost:9100&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;value&quot; : [ 1636384171.781, &quot;0&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="范围时间查询">范围时间查询<a class="hash-link" href="#范围时间查询" title="标题的直接链接">​</a></h2><p>使用 GET 或者 POST 访问下列 API 接口，可以在一个时间段内计算查询表达式：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/query_range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /api/v1/query_range</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>URL</code> 查询参数：</p><ul><li>query=\&lt;string<!-- -->&gt;<!-- --> : Prometheus 查询表达式</li><li>start=&lt;rfc3339 | unix_timestamp&gt; : 开始时间戳</li><li>end=&lt;rfc3339 | unix_timestamp&gt; : 结束时间戳</li><li>step=&lt;duration | float&gt; : 步长。简单理解就是查询的这段时间中两个数据点的间隔是多长时间，比如每分钟一个点，或者每十秒一个点，这就是步长。格式是 1m 、10s 这种。</li><li>timeout=\&lt;duration<!-- -->&gt;<!-- --> : 超时时间，是一个可选的选项。如果不指定，默认使用 <code>-query.timeout</code>  指定的值。</li></ul><p>和进行瞬时查询一样，在请求 API 接口时可以使用 POST 方法 并且 header 头可以使用 <code>Content-Type: application/x-www-form-urlencoded</code> , 当大查询中包含违反服务端 URL 字符限制时比较有用。</p><p>查询结果的数据部分格式如下:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;resultType&quot;: &quot;matrix&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;result&quot;: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>&lt;value&gt;</code> 是查询结果，</p><p>下面的示例在 30 秒范围内查询表达式 <code>up</code> 的值，查询步长为15秒。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;http://localhost:9090/api/v1/query_range?query=up&amp;start=2021-11-08T23:10:51.781Z&amp;end=2021-11-08T23:10:51.781Z&amp;step=15s&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;status&quot; : &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;data&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;resultType&quot; : &quot;matrix&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;result&quot; : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;metric&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;job&quot; : &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;instance&quot; : &quot;localhost:9090&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;values&quot; : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               [ 1636384171.781, &quot;1&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               [ 1636384186.781, &quot;1&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               [ 1636384201.781, &quot;1&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;metric&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;job&quot; : &quot;node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               &quot;instance&quot; : &quot;localhost:9091&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;values&quot; : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               [ 1636384171.781, &quot;0&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               [ 1636384186.781, &quot;0&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               [ 1636384201.781, &quot;1&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查询元数据</h1><p>Prometheus 提供了一组 API 接口来查询关于 series 及其 label 的元数据。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通过-label-查找-series">通过 Label 查找 Series<a class="hash-link" href="#通过-label-查找-series" title="标题的直接链接">​</a></h2><p>个人理解，不一定对。Label 是 Metric 的一个标签，一个 Metric 的所有 Label 构成了这个 Metric 的 Series。</p><p>下面的接口会返回匹配 Label 的时间序列列表</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/series</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /api/v1/series</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL 查询参数如下：</p><ul><li>match[]=&lt;series_selector&gt; : 要查询的指标的 Series，要至少提供一个<code>match[]</code> 参数。</li><li>start=&lt;rfc3339 | unix_timestamp&gt; : 开始时间戳</li><li>end=&lt;rfc3339 | unix_timestamp&gt; : 结束时间戳</li></ul><p>在请求 API 接口时可以使用 POST 方法 并且 header 头可以使用 <code>Content-Type: application/x-www-form-urlencoded</code> , 当大查询中包含违反服务端 URL 字符限制时比较有用。</p><p>查询结果的数据部分由一个对象列表组成，其中包含标识每个 series 的 label 名称和 label值，以成对的方式出现。</p><p>下面的例子会返回 <code>up</code> 和 <code>process_start_time_seconds{job=&quot;prometheus&quot;}</code> 所有匹配的 Series :</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl -g &#x27;http://localhost:9090/api/v1/series?&#x27; --data-urlencode &#x27;match[]=up&#x27; --data-urlencode &#x27;match[]=process_start_time_seconds{job=&quot;prometheus&quot;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;status&quot; : &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;data&quot; : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;job&quot; : &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;instance&quot; : &quot;localhost:9090&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;job&quot; : &quot;node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;instance&quot; : &quot;localhost:9091&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot; : &quot;process_start_time_seconds&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;job&quot; : &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;instance&quot; : &quot;localhost:9090&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取-label-名称">获取 label 名称<a class="hash-link" href="#获取-label-名称" title="标题的直接链接">​</a></h2><p>这个接口会返回一个 Label 名称的列表：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /api/v1/labels</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL 查询参数如下：</p><ul><li>match[]=&lt;series_selector&gt; : 要查询的指标的 Series，可选。</li><li>start=&lt;rfc3339 | unix_timestamp&gt; : 开始时间戳，可选。</li><li>end=&lt;rfc3339 | unix_timestamp&gt; : 结束时间戳，可选。</li></ul><p>这个接口最后返回的是一个 JSON 格式，是一个字符类型的 Label 名称列表。</p><p>我们来看一个例子：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;localhost:9090/api/v1/labels&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;call&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;code&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;config&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;dialer_name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;endpoint&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;event&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;goversion&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;handler&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;instance&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;interval&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;job&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;le&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;listener_name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;quantile&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reason&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;role&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;scrape_job&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;slice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;version&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取-label-的值">获取 label 的值<a class="hash-link" href="#获取-label-的值" title="标题的直接链接">​</a></h2><p>这个接口可以获取指定 Label 名称的值：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/label/</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">label_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">/values</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL 查询参数如下：</p><ul><li>match[]=&lt;series_selector&gt; : 要查询的指标的 Series，可选。</li><li>start=&lt;rfc3339 | unix_timestamp&gt; : 开始时间戳，可选。</li><li>end=&lt;rfc3339 | unix_timestamp&gt; : 结束时间戳，可选。</li></ul><p>这个接口最后返回的是一个 JSON 格式，是一个字符类型的 Label 名称列表。</p><p>我们来看一个例子，我们指定一个 Label 名称 <code>job</code>，</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://localhost:9090/api/v1/label/job/values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;status&quot; : &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;data&quot; : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查询 Exemplar</h1><p>这是一个实验性的接口，未来可能会改变，当前版本是 v2.31.0。 这个接口需要使用 <code>--enable-feature=exemplar-storage</code> 来进行开启，不开启是无法使用的。</p><p>Exemplars 这个接口包含 <code>seriesLabels</code> 、<code>exemplars</code> 两个字段，</p><p><code>seriesLabels</code> 是一个 Label 键值对的列表，列举了当前 Metric 的所有 Label。</p><p><code>exemplars</code> 是列举了存储的 traceID=\&lt;jaeger-trace-id<!-- -->&gt;<!-- --> 和他的值。</p><p>后边我们专门找个时间聊聊这些实验特性。</p><p>以下接口返回特定时间范围内有效 PromQL 查询的示例列表:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/query_exemplars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /api/v1/query_exemplars</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL 查询参数如下：</p><ul><li>query=\&lt;string<!-- -->&gt;<!-- --> : Prometheus 表达式查询语句。</li><li>start=&lt;rfc3339 | unix_timestamp&gt; : 开始时间戳。</li><li>end=&lt;rfc3339 | unix_timestamp&gt; : 结束时间戳。</li></ul><p>我们来看个例子，指定 <code>test_exemplar_metric_total</code> 这个 Metric 去查询</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl -g &#x27;http://localhost:9090/api/v1/query_exemplars?query=test_exemplar_metric_total&amp;start=2020-09-14T15:22:25.479Z&amp;end=2020-09-14T15:23:25.479Z&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;seriesLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;test_exemplar_metric_total&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;instance&quot;: &quot;localhost:8090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;job&quot;: &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;service&quot;: &quot;bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;exemplars&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;traceID&quot;: &quot;EpTxMJ40fUus7aGY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;value&quot;: &quot;6&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;timestamp&quot;: 1600096945.479,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;seriesLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;test_exemplar_metric_total&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;instance&quot;: &quot;localhost:8090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;job&quot;: &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;service&quot;: &quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;exemplars&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;traceID&quot;: &quot;Olp9XHlq763ccsfa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;value&quot;: &quot;19&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;timestamp&quot;: 1600096955.479,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;traceID&quot;: &quot;hCtjygkIHwAN9vs4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;value&quot;: &quot;20&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;timestamp&quot;: 1600096965.489,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Target 查询结果格式</h1><h1>Target</h1><p>这个接口会返回 Prometheus Target 发现的当前状态。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/targets</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认情况下 <code>activeTargets</code> 和 <code>droppedTargets</code> 都是请求响应的一部分。</p><p><code>discoveredLabels</code> 表示在进行 Label 重新标记发生之前，服务发现找到的未修改的原始 Label。</p><p><code>labels</code> 表示 Label 重新标记后的结果。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://localhost:9090/api/v1/targets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;activeTargets&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discoveredLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">address</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">metrics_path__&quot;: &quot;/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;__scheme__&quot;: &quot;http&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;scrapePool&quot;: &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;scrapeUrl&quot;: &quot;http://127.0.0.1:9090/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;globalUrl&quot;: &quot;http://example-prometheus:9090/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;lastError&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;lastScrape&quot;: &quot;2017-01-17T15:07:44.723715405+01:00&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;lastScrapeDuration&quot;: 0.050688943,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;health&quot;: &quot;up&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;scrapeInterval&quot;: &quot;1m&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;scrapeTimeout&quot;: &quot;10s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">    &quot;droppedTargets&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">        &quot;discoveredLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;__address__&quot;: &quot;127.0.0.1:9100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;__metrics_path</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">scheme</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;http&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">scrape_interval__&quot;: &quot;1m&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token bold content">          &quot;__scrape_timeout</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;10s&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;job&quot;: &quot;node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于上边的这个查询，可以添加一个查询参数 <code>state</code> ，这个参数可以指定对应的 Target 状态，比如 <code>state=active</code>, <code>state=dropped</code>, <code>state=any</code> 。当然，这是个可选参数，不是必须的。</p><p>注意，对于过滤掉的目标，仍然返回一个空数组，里边的值会丢掉。比如：</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl &#x27;http://localhost:9090/api/v1/targets?state=active&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;activeTargets&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discoveredLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">address</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;__metrics_path__&quot;: &quot;/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token bold content">scheme</span><span class="token bold punctuation" style="color:#393A34">__</span><span class="token plain">&quot;: &quot;http&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;scrapePool&quot;: &quot;prometheus&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;scrapeUrl&quot;: &quot;http://127.0.0.1:9090/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;globalUrl&quot;: &quot;http://example-prometheus:9090/metrics&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastError&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastScrape&quot;: &quot;2017-01-17T15:07:44.723715405+01:00&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;lastScrapeDuration&quot;: 50688943,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;health&quot;: &quot;up&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;droppedTargets&quot;: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查询结果格式</h1><p>我们通过表达式对 Prometheus 进行查询，会将返回的值放在结果的 <code>data</code> 部分。</p><p><code>&lt;sample_value&gt;</code> 是数值的例子。</p><p>JSON 不支持特殊浮点值，比如 <code>NaN</code> 、<code>Inf</code> 、<code>-Inf</code> ，所以样本值是作为引用的 JSON 字符串而不是原始数字传输的。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="范围向量">范围向量<a class="hash-link" href="#范围向量" title="标题的直接链接">​</a></h2><p>范围向量返回的结果类型是 <code>matrix</code> 。对应的result 属性的格式如下:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;metric&quot;: { &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">label_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;: &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">label_value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;, ... },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;values&quot;: [ [ </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">unix_time</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">, &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sample_value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot; ], ... ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="瞬时向量">瞬时向量<a class="hash-link" href="#瞬时向量" title="标题的直接链接">​</a></h2><p>瞬时向量返回的结果类型是 <code>vector</code> 。对应的result 属性的格式如下:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;metric&quot;: { &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">label_name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;: &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">label_value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;, ... },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: [ </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">unix_time</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">, &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sample_value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="标量">标量<a class="hash-link" href="#标量" title="标题的直接链接">​</a></h2><p>标量返回的结果类型是 <code>scalar</code> 。对应的result 属性的格式如下:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">unix_time</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">, &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">scalar_value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot; ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="字符串">字符串<a class="hash-link" href="#字符串" title="标题的直接链接">​</a></h2><p>字符串返回的结果类型是 <code>string</code> 。对应的result 属性的格式如下:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">unix_time</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">, &quot;</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">string_value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot; ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Alertmanagers</h1><p>下面这个接口会返回 Prometheus 当前的告警管理状态。我想了一阵子，暂时没想到这个接口的应用场景，大家有找到这个接口的使用场景可以告诉我一下。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/alertmanagers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在响应里会包含活跃的告警管理和被遗弃的告警管理。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://localhost:9090/api/v1/alertmanagers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;activeAlertmanagers&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;url&quot;: &quot;http://127.0.0.1:9090/api/v1/alerts&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;droppedAlertmanagers&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;url&quot;: &quot;http://127.0.0.1:9093/api/v1/alerts&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Rules</h1><p>Prometheus 的 <code>/rules</code> 接口会返回当前加载的已经触发的告警规则和记录的告警规则列表。
此外，它还返回由每个警报规则的 Prometheus 实例触发的当前处于 <code>active</code> 状态的告警。</p><p><code>/rules</code> 是一个新的接口，当然和总体的 API v1 接口的稳定性相比还差一些。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/rules</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对这个接口进行访问的时候可以使用一个<code>type</code> 参数可以对结果进行过滤，这个参数有两个值，当 <code>type=alert</code> 时只返回告警规则，当<code>type=record</code>时，只返回记录规则。当没有参数或者参数为空的时候，不对结果进行过滤。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://localhost:9090/api/v1/rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;groups&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;rules&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;alerts&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;activeAt&quot;: &quot;2018-07-04T20:27:12.60602144+02:00&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;annotations&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    &quot;summary&quot;: &quot;High request latency&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    &quot;alertname&quot;: &quot;HighRequestLatency&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    &quot;severity&quot;: &quot;page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;state&quot;: &quot;firing&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                &quot;value&quot;: &quot;1e+00&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;annotations&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;summary&quot;: &quot;High request latency&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;duration&quot;: 600,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;health&quot;: &quot;ok&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &quot;severity&quot;: &quot;page&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;name&quot;: &quot;HighRequestLatency&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;query&quot;: &quot;job:request_latency_seconds:mean5m{job=\&quot;myjob\&quot;} &gt; 0.5&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;type&quot;: &quot;alerting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;health&quot;: &quot;ok&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;name&quot;: &quot;job:http_inprogress_requests:sum&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;query&quot;: &quot;sum by (job) (http_inprogress_requests)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;type&quot;: &quot;recording&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;file&quot;: &quot;/rules.yaml&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;interval&quot;: 60,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;name&quot;: &quot;example&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Alerts</h1><p><code>/alerts</code> 接口会返回一个活跃的告警列表。</p><p>和 <code>/rules</code> 一样是一个新的 接口，稳定性还在进一步验证当中。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/alerts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们来看一个例子。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://localhost:9090/api/v1/alerts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;alerts&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;activeAt&quot;: &quot;2018-07-04T20:27:12.60602144+02:00&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;annotations&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;labels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;alertname&quot;: &quot;my-alert&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;state&quot;: &quot;firing&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;value&quot;: &quot;1e+00&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查询 Target 和 Metric 元数据</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查询-target-元数据">查询 Target 元数据<a class="hash-link" href="#查询-target-元数据" title="标题的直接链接">​</a></h2><p>这个接口会返回 Metric 当前可以获取到的所有 Target 的元数据。这也是一个实验性的接口。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/targets/metadata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL query parameters:</p><ul><li>match_target=&lt;label_selectors&gt;: Label 选项，会匹配指定好的 Label，如果为空会返回所有。</li><li>metric=\&lt;string<!-- -->&gt;<!-- -->: 指定要查询的 Metric 名字，如果不指定会返回所有，建议指定，不然太恐怖。</li><li>limit=\&lt;number<!-- -->&gt;<!-- -->: 一个限制，最大要返回的 Target 的数量。</li></ul><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -G http://localhost:9091/api/v1/targets/metadata \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --data-urlencode &#x27;metric=go_goroutines&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --data-urlencode &#x27;match_target={job=&quot;prometheus&quot;}&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --data-urlencode &#x27;limit=2&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;target&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;gauge&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;help&quot;: &quot;Number of goroutines that currently exist.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;target&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;instance&quot;: &quot;127.0.0.1:9091&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;gauge&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;help&quot;: &quot;Number of goroutines that currently exist.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面这个例子会返回 Target 中所有包含 <code>instance=&quot;127.0.0.1:9090</code> 这个 Label 的 Metric .</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -G http://localhost:9091/api/v1/targets/metadata \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --data-urlencode &#x27;match_target={instance=&quot;127.0.0.1:9090&quot;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;target&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;metric&quot;: &quot;prometheus_treecache_zookeeper_failures_total&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;counter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;help&quot;: &quot;The total number of ZooKeeper failures.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;target&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;metric&quot;: &quot;prometheus_tsdb_reloads_total&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;counter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;help&quot;: &quot;Number of times the database reloaded block data from disk.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查询--metric-元数据">查询  Metric 元数据<a class="hash-link" href="#查询--metric-元数据" title="标题的直接链接">​</a></h2><p>这个接口会返回 Metric 的元数据，比如 HELP 、TYPE、UNIT 等信息。
如果有缺失的会留空，这也是个实验性的接口。不过看起来比较有用，比如在展示页面中展示某个指标的时候可以把他的 HELP 信息拿出来直接展示。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/v1/metadata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URL query parameters:</p><ul><li>limit=\&lt;number<!-- -->&gt;<!-- -->: 要返回的 Metric 的最大数量.</li><li>metric=\&lt;string<!-- -->&gt;<!-- -->: 要查询的 Metric 名字，如果为空返回所有.</li></ul><p>下面我们来看一个例子，由于只指定了 <code>limit</code> 参数，所有按照这个数量进行过滤，获取到了 <code>cortex_ring_tokens</code> <code>http_requests_total</code> 两个 Metric 的元数据。<code>http_requests_total</code> 有多个对象，不太清楚为什么是一样的两个数据。每个指标会至少有一个 HELP 信息，因为 Prometheus 规定了</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -G http://localhost:9090/api/v1/metadata?limit=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;cortex_ring_tokens&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;gauge&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;help&quot;: &quot;Number of tokens in the ring&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http_requests_total&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;counter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;help&quot;: &quot;Number of HTTP requests&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;counter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;help&quot;: &quot;Amount of HTTP requests&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面这个例子会返回 Metric <code>http_requests_total</code> 的元数据。</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -G http://localhost:9090/api/v1/metadata?metric=http_requests_total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;status&quot;: &quot;success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http_requests_total&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;counter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;help&quot;: &quot;Number of HTTP requests&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;counter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;help&quot;: &quot;Amount of HTTP requests&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unit&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>zhengxuexian</b> <!-- -->于 <b><time datetime="2022-09-01T10:07:45.000Z">2022年9月1日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.5-querying-functions-examples"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">子查询</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zhengxuexian_blog/ops/prometheus/PromQL/5.7-querying-http-admin-api"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">查询 Prometheus 管理员接口</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#瞬时查询" class="table-of-contents__link toc-highlight">瞬时查询</a></li><li><a href="#范围时间查询" class="table-of-contents__link toc-highlight">范围时间查询</a></li><li><a href="#通过-label-查找-series" class="table-of-contents__link toc-highlight">通过 Label 查找 Series</a></li><li><a href="#获取-label-名称" class="table-of-contents__link toc-highlight">获取 label 名称</a></li><li><a href="#获取-label-的值" class="table-of-contents__link toc-highlight">获取 label 的值</a></li><li><a href="#范围向量" class="table-of-contents__link toc-highlight">范围向量</a></li><li><a href="#瞬时向量" class="table-of-contents__link toc-highlight">瞬时向量</a></li><li><a href="#标量" class="table-of-contents__link toc-highlight">标量</a></li><li><a href="#字符串" class="table-of-contents__link toc-highlight">字符串</a></li><li><a href="#查询-target-元数据" class="table-of-contents__link toc-highlight">查询 Target 元数据</a></li><li><a href="#查询--metric-元数据" class="table-of-contents__link toc-highlight">查询  Metric 元数据</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/zhengxuexian_blog/assets/js/runtime~main.f31cac53.js"></script>
<script src="/zhengxuexian_blog/assets/js/main.06701ae6.js"></script>
</body>
</html>