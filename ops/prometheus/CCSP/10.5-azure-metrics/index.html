<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-ops docs-doc-id-prometheus/CCSP/10.5-azure-metrics">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/zhengxuexian_blog/blog/rss.xml" title="zhengxuexian_blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zhengxuexian_blog/blog/atom.xml" title="zhengxuexian_blog Atom Feed"><title data-rh="true">Azure ç›‘æ§ | zhengxuexian_blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/CCSP/10.5-azure-metrics"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="keywords" content="åŠŸèƒ½æµ‹è¯•, appæµ‹è¯•, webæµ‹è¯•, api, æ¥å£æµ‹è¯•, è‡ªåŠ¨åŒ–æµ‹è¯•, python, java, æ€§èƒ½æµ‹è¯•, æ¸—é€æµ‹è¯•"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-ops-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-ops-current"><meta data-rh="true" property="og:title" content="Azure ç›‘æ§ | zhengxuexian_blog"><meta data-rh="true" name="description" content="æœ¬æ–‡çš„ Azure ç›‘æ§ä¸»è¦æè¿° Azure ä¸­å›½çš„ç›‘æ§æ–¹å¼ï¼Œå…¶ä»–å›½å®¶çš„ Azure æˆ–è€… Azure å…¨çƒå¯ä»¥å‚è€ƒï¼Œå¹¶ä¸”æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£è¿›è¡Œç›¸åº”çš„é…ç½®æ›´æ”¹ã€‚"><meta data-rh="true" property="og:description" content="æœ¬æ–‡çš„ Azure ç›‘æ§ä¸»è¦æè¿° Azure ä¸­å›½çš„ç›‘æ§æ–¹å¼ï¼Œå…¶ä»–å›½å®¶çš„ Azure æˆ–è€… Azure å…¨çƒå¯ä»¥å‚è€ƒï¼Œå¹¶ä¸”æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£è¿›è¡Œç›¸åº”çš„é…ç½®æ›´æ”¹ã€‚"><link data-rh="true" rel="icon" href="/zhengxuexian_blog/img/logo.png"><link data-rh="true" rel="canonical" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/CCSP/10.5-azure-metrics"><link data-rh="true" rel="alternate" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/CCSP/10.5-azure-metrics" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/CCSP/10.5-azure-metrics" hreflang="x-default"><link rel="stylesheet" href="/zhengxuexian_blog/assets/css/styles.5e821d6f.css">
<link rel="preload" href="/zhengxuexian_blog/assets/js/runtime~main.4da680e9.js" as="script">
<link rel="preload" href="/zhengxuexian_blog/assets/js/main.b63cdd20.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zhengxuexian_blog/"><b class="navbar__title text--truncate">ğŸ›« æµ‹è¯•åšå®¢</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ğŸ›´ åŠŸèƒ½æµ‹è¯•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/greenhand">æ–°æ‰‹æ‘</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/flow">æµ‹è¯•æµç¨‹</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/guide">æµ‹è¯•è§„èŒƒ</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/kbs">æµ‹è¯•çŸ¥è¯†</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/auto">ğŸšš è‡ªåŠ¨åŒ–</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ğŸš‘ æ€§èƒ½æµ‹è¯•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/base">æ€§èƒ½åŸºç¡€</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/ctrl">æ€§èƒ½ç›‘æ§</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/jmeter">jmeteræ±‡æ€»</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/locust">locustæ±‡æ€»</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">âš”ï¸ æ¸—é€æµ‹è¯•</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/kali">kaliæ±‡æ€»</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/new">å®‰å…¨å…¥é—¨</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/manage">ğŸ§® æµ‹è¯•ç®¡ç†</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ğŸšŒ å¼€å‘ç™¾ç§‘</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/dev">ç¨‹åºè¯­è¨€</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/database">æ•°æ®åº“</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zhengxuexian_blog/ops">ç½‘ç»œè¿ç»´</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/algo">é€»è¾‘ç®—æ³•</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/tool">â›½ æµ‹è¯•å·¥å…·</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="æœç´¢" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/zhengxuexian_blog/"><b>ğŸ›« æµ‹è¯•åšå®¢</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zhengxuexian_blog/ops/">äº‘æœåŠ¡å™¨ä½¿ç”¨æ³¨æ„äº‹é¡¹</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zhengxuexian_blog/ops/category/linuxåŸºç¡€">linuxåŸºç¡€</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒlinuxåŸºç¡€ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zhengxuexian_blog/ops/category/dockeråŸºç¡€">dockeråŸºç¡€</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒdockeråŸºç¡€ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zhengxuexian_blog/ops/category/prometheus">prometheus</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œprometheusã€" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Basic/">ç¬¬ä¸€ç«  è®¤è¯† Prometheus</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬ä¸€ç«  è®¤è¯† Prometheusã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Server/">ç¬¬äºŒç«  Prometehus æœåŠ¡</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬äºŒç«  Prometehus æœåŠ¡ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Exporter/">ç¬¬ä¸‰ç« </a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬ä¸‰ç« ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/AlarmManager/">README</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒREADMEã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/">ç¬¬äº”ç« </a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬äº”ç« ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Instrumenting/grafana-kubernetes-config-persistence">Instrumenting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/">ç¬¬ä¸ƒç«  é›†ç¾¤ä¸é«˜å¯ç”¨</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬ä¸ƒç«  é›†ç¾¤ä¸é«˜å¯ç”¨ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ServiceDiscovery/">ç¬¬å…«ç«  æœåŠ¡å‘ç°</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬å…«ç«  æœåŠ¡å‘ç°ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/BestPractices/">ç¬¬åç«   æœ€ä½³å®è·µ</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¬¬åç«   æœ€ä½³å®è·µã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/">äº‘è®¡ç®—æœåŠ¡æä¾›å•†</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œäº‘è®¡ç®—æœåŠ¡æä¾›å•†ã€" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.1-aliyun-cms">é˜¿é‡Œäº‘ç›‘æ§</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.2-huaweicloud-cloudeye">åä¸ºäº‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.3-aws-cloudwatch">AWS äº‘ç›‘æ§</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.4-tencentcloud-metrics">è…¾è®¯äº‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.5-azure-metrics">Azure ç›‘æ§</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.6-aws-cloudwatch-2"></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/END">å°ç»“</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Troubleshoot/">é—®é¢˜æ’æŸ¥</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œé—®é¢˜æ’æŸ¥ã€" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><h1>Azure ç›‘æ§</h1><p>æœ¬æ–‡çš„ Azure ç›‘æ§ä¸»è¦æè¿° Azure ä¸­å›½çš„ç›‘æ§æ–¹å¼ï¼Œå…¶ä»–å›½å®¶çš„ Azure æˆ–è€… Azure å…¨çƒå¯ä»¥å‚è€ƒï¼Œå¹¶ä¸”æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£è¿›è¡Œç›¸åº”çš„é…ç½®æ›´æ”¹ã€‚</p><p>é‡‡é›†ç»„ä»¶é‡‡ç”¨ RobustPerception çš„ azure_metrics_exporter ï¼Œè¿™ä¸ª Exporter ä¹Ÿåœ¨æŒç»­ç»´æŠ¤ä¸­ï¼Œç»´æŠ¤è€…æ˜¯ Prometheus çš„ä½œè€… Brian Brazil ï¼Œä¹Ÿç®—æ˜¯æŸç§æ„ä¹‰ä¸Šçš„å®˜æ–¹ï¼Œæ¯”è¾ƒé è°±ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯å·²ç»æœ‰ 1 å¹´æ²¡æœ‰æ›´æ–°ã€‚GitHub åœ°å€å¦‚ä¸‹ï¼š</p><p><a href="https://github.com/RobustPerception/azure_metrics_exporter" target="_blank" rel="noopener noreferrer">https://github.com/RobustPerception/azure_metrics_exporter</a></p><p>ä½¿ç”¨ Azure metrics exporter æ¥ç›‘æ§ Azure éœ€è¦å‡†å¤‡å¦‚ä¸‹æ­¥éª¤ã€‚</p><ul><li><ol><li>å¼€é€š Azure Monitor </li></ol></li><li><ol start="2"><li>Azure ä¸­æ³¨å†Œåº”ç”¨</li></ol></li><li><ol start="3"><li>é…ç½® Azure metrics exporter</li></ol></li><li><ol start="4"><li>é…ç½® Prometheus </li></ol></li><li><ol start="5"><li>Grafana ç”»å›¾</li></ol></li></ul><h1>å¼€é€š Azure Monitor</h1><p>è¦ç›‘æ§ Azure çš„äº‘æœåŠ¡èµ„æºä½¿ç”¨æƒ…å†µéœ€è¦å€ŸåŠ©è‡ªèº«çš„äº‘æœåŠ¡ Azure Monitor ï¼Œ
Azure Monitor æ˜¯ Azure ä¸­çš„ä¸€é¡¹å®Œæ•´çš„ç›‘è§†æœåŠ¡ï¼Œæä¾›äº†ä¸€æ•´å¥—ç”¨äºç›‘è§† Azure èµ„æºä»¥åŠå…¶ä»–äº‘å’Œæœ¬åœ°èµ„æºçš„åŠŸèƒ½ã€‚æ‰€ä»¥ä¸ºäº†ç›‘æ§ä¸Šè¾¹çš„è¿è¡Œçš„æœåŠ¡èµ„æºï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€ Azure Monitor æœåŠ¡ã€‚è¯¦ç»†çš„å¼€é€šæ­¥éª¤å¯ä»¥å‚è€ƒå®˜ç½‘ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šçš„æè¿°äº†ã€‚</p><h1>Azure ä¸­æ³¨å†Œåº”ç”¨</h1><p>Azure Monitor æ‰“å¼€ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Azure Monitor ä¸­çœ‹åˆ°å„ä¸ªèµ„æºçš„ç›‘æ§æŒ‡æ ‡ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½åªèƒ½åœ¨æ§åˆ¶å°ä¸ŠæŸ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç›‘æ§æ•°æ®ä¿å­˜åˆ°æˆ‘ä»¬çš„ Prometheus ä¸­ï¼Œåœ¨ç»Ÿä¸€çš„ç›‘æ§ç³»ç»Ÿé‡ŒæŸ¥çœ‹ã€‚</p><p>æˆ‘ä»¬éœ€è¦åœ¨ Azure é—¨æˆ·ä¸­æ³¨å†Œä¸€ä¸ªåº”ç”¨ï¼Œä»¥ä¾¿ Microsoft æ ‡è¯†å¹³å°å¯ä¸ºè¯¥åº”ç”¨ç¨‹åºåŠå…¶ç”¨æˆ·æä¾›èº«ä»½éªŒè¯å’ŒæˆæƒæœåŠ¡ã€‚</p><p>æ³¨å†Œåº”ç”¨ç¨‹åºä¼šåœ¨åº”ç”¨ä¸ Microsoft æ ‡è¯†å¹³å°ä¹‹é—´å»ºç«‹ä¿¡ä»»å…³ç³»ã€‚ ä¿¡ä»»æ˜¯å•å‘çš„ï¼šåº”ç”¨ä¿¡ä»» Microsoft æ ‡è¯†å¹³å°ï¼Œä½†æ ‡è¯†å¹³å°å¹¶ä¸ä¿¡ä»»åº”ç”¨ã€‚</p><p>Azure é‡Œè¿›è¡Œæ³¨å†Œä¸€ä¸ªç›‘æ§å¯ä»¥çš„åº”ç”¨ä¸»è¦æ˜¯ 2 éƒ¨åˆ†ï¼Œåº”ç”¨æ³¨å†Œå’Œæˆæƒã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="åº”ç”¨æ³¨å†Œ">åº”ç”¨æ³¨å†Œ<a class="hash-link" href="#åº”ç”¨æ³¨å†Œ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ç™»é™† Azure é—¨æˆ·ï¼Œè¿›å…¥æ§åˆ¶å°ï¼Œå¦‚æœå¯ä»¥çœ‹åˆ°å¤šä¸ªè´¦å·ï¼Œé‚£ä¹ˆé€‰æ‹©è¦æ³¨å†Œåº”ç”¨çš„è´¦å·ã€‚</p><p>æ¥ä¸‹æ¥åœ¨æ§åˆ¶å°é¡µé¢å¯»æ‰¾ Azure æ´»åŠ¨ç›®å½•ï¼ˆAzure Active Directoryï¼‰ï¼Œæ‰“å¼€è¿›å…¥ã€‚</p><p>åœ¨å³ä¾§ç®¡ç†æ ä¸‹æœ‰ä¸€ä¸ªåº”ç”¨æ³¨å†Œï¼ˆApp registrationsï¼‰çš„èœå•ï¼Œç‚¹å‡»æ‰“å¼€ã€‚</p><p>åœ¨é¡µé¢çš„ä¸Šæ–¹æœ‰ä¸€ä¸ªæ³¨å†Œæ–°åº”ç”¨ï¼ˆNew application registrationï¼‰çš„æŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®è¿›è¡Œåº”ç”¨åˆ›å»ºã€‚</p><p>åˆ›å»ºè¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><p>åç§°ï¼ˆNameï¼‰ï¼šåº”ç”¨çš„ç”¨æˆ·ä¼šçœ‹åˆ°è¿™ä¸ªåå­—ï¼ŒåæœŸå¯ä»¥ä¿®æ”¹ã€‚
æ”¯æŒçš„è´¦æˆ·ç±»å‹ï¼ˆSupported account typesï¼‰ï¼šæ”¯æŒä¸¤ç§è´¦æˆ·ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å½“å‰è´¦æˆ·å’Œå…¨å±€è´¦å·ï¼Œé€‰æ‹©å½“å‰åº”ç”¨åªèƒ½åœ¨è¿™ä¸ªè´¦æˆ·ä¸­çœ‹åˆ°ï¼Œé€‰æ‹©å…¨å±€è´¦å·ä»»æ„è´¦å·éƒ½èƒ½çœ‹åˆ°è¿™ä¸ªåº”ç”¨ã€‚ã€PSï¼šå®˜æ–¹æ–‡æ¡£ä¸è¿™ä¹ˆè¯´ï¼Œä½†æ˜¯æ˜¯è¿™ä¸ªæ„æ€ã€‘
é‡å®šå‘ URIï¼ˆRedirect URIï¼‰ï¼šè¿™ä¸ªé€‰é¡¹æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å¡«ï¼Œä¸å¡«ä¸ä¼šå½±å“åç»­çš„ä½¿ç”¨ã€‚</p><p>å¡«å†™å¥½ä»¥åç‚¹å‡»æ³¨å†Œï¼ˆRegisterï¼‰å³å¯ã€‚</p><p>æ³¨å†Œå®Œæˆåï¼ŒAzure æ§åˆ¶å°é¡µé¢ä¼šæ˜¾ç¤ºåº”ç”¨æ³¨å†Œçš„ <code>æ€»è§ˆ</code> é¡µé¢ã€‚ åœ¨è¿™ä¸ªé¡µé¢å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºID ï¼ˆApplication ID / client IDï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºå®¢æˆ·ç«¯ IDï¼Œå®ƒå¯å”¯ä¸€åœ°æ ‡è¯† Microsoft æ ‡è¯†å¹³å°ä¸­çš„åº”ç”¨ç¨‹åºã€‚</p><p>å¦å¤–è¿™ä¸ªé¡µé¢è¿˜å¯ä»¥çœ‹åˆ° Directory ID æˆ–è€… tenant ID ï¼Œè¿™ä¸¤ä¸ª ID å…ˆè®°ä¸‹æ¥ï¼Œåè¾¹ä¼šç”¨åˆ°ï¼Œå¿˜è®°äº†ä¹Ÿå¯ä»¥åˆ°è¿™ä¸ªé¡µé¢æ¥æŸ¥çœ‹ã€‚</p><p>åº”ç”¨åˆ›å»ºå¥½ä»¥åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªåº”ç”¨åˆ›å»ºä¸€ä¸ªå¯†ç ï¼Œæˆ–è€…å«å‡­è¯ã€‚</p><p>ç‚¹å‡»åº”ç”¨é¡µé¢å³ä¾§çš„ å‡­è¯å’Œç§˜é’¥ï¼ˆCertificates &amp; secretsï¼‰ï¼Œè¿™é‡Œè¿™æ ·åˆ›å»ºç§˜é’¥ï¼ˆè¯ä¹¦ï¼‰æ–¹å¼çš„ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå¯†ç æ–¹å¼çš„ï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹©åˆ›å»ºå¯†ç ï¼Œç‚¹å‡» <code>New client secret</code> ï¼Œå¡«å†™è¿™ä¸ªç§˜é’¥çš„æè¿°ï¼Œç„¶åé€‰æ‹©è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´å¯ä»¥æ˜¯ 1 å¹´ã€2 å¹´æˆ–è€…æ°¸ä¸è¿‡æœŸï¼Œç„¶åç‚¹å‡» æ·»åŠ  ï¼ˆaddï¼‰ å°±å¥½ã€‚æ°¸ä¸è¿‡æœŸå¹¶ä¸æ˜¯çœŸçš„æ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œè€Œä¸”æ˜¯è¿‡æœŸæ—¶é—´è¢«è®¾ç½®åœ¨äº†å¤§çº¦ 300 å¹´ä»¥åï¼Œæˆ‘è¿™é‡Œçœ‹åˆ°çš„æ˜¯ 2299.12.31 ã€‚</p><p>æˆåŠŸä»¥åä¼šçœ‹åˆ°è¿™ä¸ªæè¿°çš„åè¾¹æœ‰å‡ ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯ Expires ã€Value ã€ID ï¼Œå°†å…¶ä¸­çš„ Value è®°å½•ä¸‹æ¥ï¼Œåˆ‡è®°åˆ‡è®°ï¼Œä¸€å®šè¦è®°å½•å¥½äº†ã€‚è¿™ä¸ª Value å°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„å¯†ç ï¼Œè¿™ä¸ª Value çš„æ˜¾ç¤ºæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå‡ åˆ†é’Ÿçš„æ ·å­ï¼Œå¦‚æœæ²¡æœ‰è®°å½•ä¸‹æ¥ï¼Œä»¥åå°±çœ‹ä¸åˆ°äº†ï¼Œåªèƒ½åˆ äº†é‡æ–°åˆ›å»ºä¸€ä¸ªå¯†ç ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å°±æ”¶é›†åˆ°äº†åè¾¹è¦é…ç½®éœ€è¦çš„ 4 ä¸ªå‚æ•°ä¸­çš„ 3 ä¸ªã€‚</p><p>client_id
client_secret
tenant_id </p><p>æ¥ä¸‹æ¥å°±éœ€è¦æˆæƒäº†ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æˆæƒ">æˆæƒ<a class="hash-link" href="#æˆæƒ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä¸Šè¾¹åˆ›å»ºå¥½åº”ç”¨ä»¥åï¼Œæˆ‘ä»¬è·å¾—äº†éœ€è¦çš„ IDï¼Œä½†æ˜¯è¿™ä¸ªåº”ç”¨ç°åœ¨æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªåº”ç”¨è¿›è¡Œæˆæƒï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆç™»é™†è®¢é˜…æœåŠ¡çš„æ§åˆ¶å°ï¼Œåœ¨è®¢é˜…é¡µé¢çš„å·¦ä¾§ï¼Œæœ‰ä¸€ä¸ªè®¿é—®æ§åˆ¶ï¼ˆAccess control (IAM)ï¼‰ï¼Œç‚¹å‡»è¿™ä¸ªèœå•ã€‚</p><p>åœ¨æ‰“å¼€çš„é¡µé¢æŸ¥æ‰¾ è§’è‰²ç®¡ç† ï¼ˆRole assignmentï¼‰ï¼Œç‚¹å‡»æ–°å»ºï¼Œåœ¨æ–°å»ºé‡Œé€‰æ‹©æ·»åŠ è§’è‰² ï¼ˆAdd role assignmentï¼‰ã€‚</p><p>åœ¨æ·»åŠ è§’è‰²é¡µé¢è¿›è¡Œæˆæƒï¼Œåœ¨è¿™ä¸ªå°é¡µé¢é‡Œï¼ŒRole ä¸€æ é€‰ â€œMonitoring Readerâ€ï¼Œåœ¨æœç´¢æ é‡Œæœç´¢æ‰¾åˆ°ä¸Šè¾¹åˆ›å»ºçš„åº”ç”¨ï¼Œå¹¶ä¸”é€‰ä¸­ã€‚å…¶ä»–é¡¹ä¿æŒé»˜è®¤å³å¯ã€‚</p><p>ç‚¹å‡»ä¿å­˜ï¼Œæˆæƒå°±å®Œæˆäº†ã€‚</p><p>è®°å½•ä¸‹è¿™ä¸ªè®¢é˜…çš„ subscription_id ï¼Œæˆ‘ä»¬éœ€è¦çš„é…ç½®å‚æ•°å°±æ”¶é›†å…¨äº†ã€‚</p><h1>é…ç½® Azure metrics exporter</h1><p>å®˜æ–¹æ²¡æœ‰æä¾›ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥è‡ªè¡Œç¼–è¯‘ï¼Œæˆ–è€…ä» docker images é‡Œæ‹·è´ä¸€ä¸ªå‡ºæ¥ã€‚</p><p>ä¸‹è½½ docker images , images ID  æ˜¯ 71b159cb4cb3</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull robustperception/azure_metrics_exporter:latest              </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å‡†å¤‡å¥½é•œåƒæ–‡ä»¶ä»¥åå°±å¯ä»¥å‡†å¤‡é…ç½®æ–‡ä»¶äº†ï¼Œé…ç½®æ–‡ä»¶é‡‡ç”¨ Yaml æ ¼å¼è¿›è¡Œæè¿°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¼ºçœçš„é…ç½®æ–‡ä»¶ã€‚</p><p>azure_metrics_exporter ç¼ºçœçš„é…ç½®æ–‡ä»¶ä¸º</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">active_directory_authority_url: &quot;https://login.microsoftonline.com/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource_manager_url: &quot;https://management.azure.com/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subscription_id: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">secret</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">secret</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_secret: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">secret</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id: </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">secret</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> resource: &quot;azure_resource_id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &quot;BytesReceived&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &quot;BytesSent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> resource: &quot;azure_resource_id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aggregations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Minimum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Maximum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &quot;Http2xx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &quot;Http5xx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> resource: &quot;azure_resource_id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metric_namespace: &quot;Azure.VM.Windows.GuestMetrics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &#x27;Process\Thread Count&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource_groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> resource_group: &quot;webapps&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_types:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> &quot;Microsoft.Compute/virtualMachines&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_name_include_re:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> &quot;testvm.*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_name_exclude_re:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> &quot;testvm12&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &quot;CPU Credits Consumed&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource_tags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> resource_tag_name: &quot;group&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_tag_value: &quot;tomonitor&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_types:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> &quot;Microsoft.Compute/virtualMachines&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> name: &quot;CPU Credits Consumed&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®˜æ–¹å¯¹é…ç½®æ–‡ä»¶çš„æè¿°å¦‚ä¸‹ï¼š</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azure_resource_id and subscription_id can be found under properties in the Azure portal for your application/service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azure_resource_id should start with /resourceGroups... (/subscriptions/xxxxxxxx-xxxx-xxxx-xxx-xxxxxxxxx must be removed from the begining of azure_resource_id property value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tenant_id is found under Azure Active Directory &gt; Properties and is listed as Directory ID.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The client_id and client_secret are obtained by registering an application under &#x27;Azure Active Directory&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_id is the application_id of your application and the client_secret is generated by selecting your application/service under Azure Active Directory, selecting &#x27;keys&#x27;, and generating a new key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you want to scrape metrics from Azure national clouds (e.g. AzureChinaCloud, AzureGermanCloud), you should provide active_directory_authority_url and resource_manager_url parameters. active_directory_authority_url is AzureAD url for getting access token. resource_manager_url is Azure API management url. If you won&#x27;t provide active_directory_authority_url and resource_manager_url parameters, azure-metrics-exporter scrapes metrics from global cloud. </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…¶ä¸­é…ç½®çš„ <code>active_directory_authority_url</code> å’Œ <code>resource_manager_url</code> ç¼ºçœé…ç½®çš„æ˜¯ Azure å…¨çƒçš„åœ°å€ï¼Œä½¿ç”¨å…¶ä»–å›½å®¶åŒºåŸŸçš„å»ºè®®é€šè¿‡ <a href="https://www.azurespeed.com/Information/AzureEnvironments" target="_blank" rel="noopener noreferrer">Azure Environments</a> æŸ¥æ‰¾å¯¹åº”çš„ç¯å¢ƒæ¥è¿›è¡Œé…ç½®ï¼Œè¿™æ ·å¯èƒ½ä¼šå¿«ä¸€äº›ï¼Œä¸­å›½åŒºå»ºè®®é…ç½® <code>AzureChinaCloud</code> é‡Œçš„ URLã€‚</p><p>subscription_idã€client_idã€client_secretã€tenant_id è¿™ 4 ä¸ªå‚æ•°åœ¨ä¸Šè¾¹å·²ç»æ”¶é›†å¥½äº†ï¼Œå¡«å…¥å³å¯ã€‚</p><p>å¾®è½¯é…ç½®ç›‘æ§
<a href="https://blog.csdn.net/sickles/article/details/81156659" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/sickles/article/details/81156659</a></p><p>å¯¹è±¡å­˜å‚¨ç›‘æ§æŒ‡æ ‡
<a href="https://docs.azure.cn/zh-cn/storage/common/monitor-storage-reference#metrics-dimensions" target="_blank" rel="noopener noreferrer">https://docs.azure.cn/zh-cn/storage/common/monitor-storage-reference#metrics-dimensions</a></p><p>å…¨éƒ¨æŒ‡æ ‡
<a href="https://docs.azure.cn/zh-cn/azure-monitor/essentials/metrics-supported" target="_blank" rel="noopener noreferrer">https://docs.azure.cn/zh-cn/azure-monitor/essentials/metrics-supported</a></p><p>èµ„æºç±»å‹åˆ—è¡¨ </p><p><a href="https://docs.azure.cn/zh-cn/azure-resource-manager/management/azure-services-resource-providers" target="_blank" rel="noopener noreferrer">https://docs.azure.cn/zh-cn/azure-resource-manager/management/azure-services-resource-providers</a></p><p>æ— æ³•ç›‘æ§åˆ°æ‰€æœ‰æŒ‡æ ‡ï¼Œè¯¦è§é—®é¢˜ 1 ã€‚</p><h1>é…ç½® Prometheus</h1><p>Azure metric exporter é…ç½®å¥½ä»¥åæ˜¯å¯ä»¥é€šè¿‡ <code>curl</code> å‘½ä»¤æ¥æŸ¥çœ‹é‡‡é›†åˆ°çš„æ•°æ®çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® Prometheus ï¼Œè®©ç›‘æ§æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œæ–¹ä¾¿æŸ¥è¯¢å’Œå‘Šè­¦ã€‚</p><p>åœ¨ Prometheus ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ·»åŠ å¥½ä»¥åé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶æˆ–è€…é‡å¯ Prometheus æœåŠ¡ä½¿å¾—é…ç½®ç”Ÿæ•ˆã€‚</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> job_name: azure-metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scrape_interval: 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scrape_timeout: 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> targets: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.1.1:9109</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é…ç½®ä¸­é…ç½®äº† Prometheus æ¯éš” 60 ç§’ä¼šä» Exporter è·å–ä¸€æ¬¡æ•°æ®å­˜å‚¨åˆ° TSDBï¼Œè¶…æ—¶æ—¶é—´ä¸º 60 ç§’ã€‚Azure API å¯¹äºç›‘æ§æœ‰ä¸€ä¸ªæ‹‰å–æ•°æ®é¢‘ç‡çš„é™åˆ¶ï¼Œé»˜è®¤æ˜¯æ¯å°æ—¶ 12000 æ¬¡è¯·æ±‚ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶ä»¥åä¼šè¢«é™åˆ¶ï¼Œåœ¨é…ç½®çš„æ—¶å€™éœ€è¦è®¡ç®—æ‰€æœ‰çš„è¯·æ±‚æ˜¯å¦ä¼šè¶…å‡ºé™åˆ¶ã€‚</p><p>æ‰“å¼€ Prometheus çš„ Graph é¡µé¢ï¼Œè¾“å…¥è¦é‡‡é›†çš„ Metric ï¼Œä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œæ˜¯å¯ä»¥çœ‹åˆ°è¦é‡‡é›†çš„æŒ‡æ ‡çš„ã€‚</p><p><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/request-limits-and-throttling" target="_blank" rel="noopener noreferrer">API è¯»è¯·æ±‚æ¯å°æ—¶é™åˆ¶ 12000 æ¬¡</a></p><h1>Grafana ç”»å›¾</h1><p>åœ¨ Prometheus ä¸­é…ç½®å¥½é‡‡é›†ä»¥åï¼Œè™½ç„¶åœ¨ Prometheus Graph é¡µé¢å¯ä»¥çœ‹åˆ°é‡‡é›†çš„æŒ‡æ ‡ï¼Œä½†æ˜¯å¹¶ä¸èƒ½é•¿ä¹…å­˜å‚¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨ Grafana ä¸­è¿›è¡Œç”»å›¾ã€‚</p><p>Grafana æ­å»ºå’Œ Prometheus æ•°æ®æºçš„é…ç½®å°±ä¸åœ¨è¿™é‡Œè®²è§£äº†ï¼Œæˆ‘ä»¬è®²æ¥ä¸‹æ¥çš„ç”»å›¾éƒ¨åˆ†ã€‚</p><p>å¯¹äºç”»å›¾ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆæŠŠè¦é‡‡é›†çš„æŒ‡æ ‡åˆ—åˆ°ä¸€ä¸ªè¡¨é‡Œï¼Œå¹¶ä¸”æŠŠå„ä¸ªæŒ‡æ ‡çš„æ•°æ®ç±»å‹ä¹Ÿå¤‡æ³¨ä¸Šï¼Œå¯¹äº Azure çš„ç›‘æ§ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„è¡¨æ ¼æ¥è¿›è¡Œæ¢³ç†ã€‚</p><table><thead><tr><th>Metric åç§°</th><th>æ•°æ®ç±»å‹</th><th>å•ä½</th><th>Aggregation Type</th><th>æè¿°</th></tr></thead><tbody><tr><td>availability_percent_average</td><td>gauge</td><td>Percent</td><td>Average</td><td>å¯ç”¨æ€§</td></tr><tr><td>egress_bytes_total</td><td>gauge</td><td>Bytes</td><td>Total</td><td>å‡ºæµé‡</td></tr><tr><td>...</td><td></td><td></td><td></td><td></td></tr></tbody></table><p>æ¢³ç†å¥½ä»¥åé€‰æ‹©åˆé€‚çš„ Panel ç±»å‹å°†æ•°æ®ç”»å‡ºæ¥ã€‚</p><p>å¦‚æœè§‰å¾—è‡ªå·±ç”»å›¾æ¯”è¾ƒéº»çƒ¦ï¼Œä¹Ÿå¯ä»¥åˆ° Grafana Dashboards ä¸Šå»æœç´¢åˆ«äººç”»å¥½çš„ Dashboard ï¼Œä½†æ˜¯ Azure ç›¸å…³çš„ Dashboards æ¯”è¾ƒå°‘ï¼ŒåŸºäº Prometheus çš„æ›´å°‘ï¼Œå¤§æ¦‚ç‡çš„æƒ…å†µä¸‹è¿˜æ˜¯éœ€è¦è‡ªå·±ç”»çš„ã€‚</p><h1>é‡åˆ°çš„é—®é¢˜</h1><p>1ã€åªèƒ½ç›‘æ§åˆ° account æŒ‡æ ‡ï¼Œæ— æ³•ç›‘æ§åˆ° blob ã€queue ç­‰æŒ‡æ ‡ã€‚
å½“å‰ç‰ˆæœ¬æ— æ³•ç›‘æ§æ‰€æœ‰æŒ‡æ ‡ï¼Œå› ä¸º apiversion ç‰ˆæœ¬çš„é™åˆ¶ï¼Œ</p><p>exporter åœ¨è·å– aipversion çš„æ—¶å€™è·å–çš„æ˜¯ 2018-02-01 </p><p>åœ¨ <a href="https://github.com/RobustPerception/azure_metrics_exporter/blob/HEAD/azure.go" target="_blank" rel="noopener noreferrer">https://github.com/RobustPerception/azure_metrics_exporter/blob/HEAD/azure.go</a>  çš„ 401 ~ 424 è¡Œæ˜¯ç”¨æ¥è¿”å›æŒ‡å®šçš„èµ„æºç»„å’Œèµ„æºçš„ï¼Œ</p><p>åœ¨è¿™ä¸€æ®µï¼ŒæŒ‡å®šäº† apiVersion ä¸º 2018-02-01</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns all resources for given resource group and types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (ac *AzureClient) listFromResourceGroup(resourceGroup string, resourceTypes []string) ([]AzureResource, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion := &quot;2018-02-01&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>azure çš„æœ€æ–°apiversion ç‰ˆæœ¬ä¸º 2019-06-01 ï¼Œ</p><p>åœ¨ 2018-02-01 ç‰ˆæœ¬ä¸Šé’ˆå¯¹çš„ Storage  çš„ Resource Type åªæœ‰ Storage Accountsï¼Œ</p><p>åœ¨ 2019-06-01 ç‰ˆæœ¬ä¸Šé’ˆå¯¹çš„ Storage  çš„ Resource Type æœ‰ Storage Accounts ã€Blob Services ã€File Services ã€Queue Servicesã€Table Services ç­‰æ¥å£ã€‚</p><p>æ‰€ä»¥æ— æ³•ç›‘æ§åˆ° Blob ã€Fileã€Queueã€Table ç­‰æ•°æ®ã€‚</p><p><a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.storage/2018-02-01/storageaccounts?tabs=json" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/templates/microsoft.storage/2018-02-01/storageaccounts?tabs=json</a>
2ã€æ— æ³•ç›‘æ§åˆ°éƒ¨åˆ†è´Ÿè½½å‡è¡¡çš„æŒ‡æ ‡</p><p>è´Ÿè½½å‡è¡¡æœ‰ä¸¤ç§ SKU ï¼Œåˆ†åˆ«æ˜¯æ ‡å‡†ç‰ˆå’ŒåŸºç¡€ç‰ˆï¼Œä¸¤è€…åœ¨åŠŸèƒ½ã€è§„æ¨¡ã€å”®ä»·æ–¹é¢æœ‰åŒºåˆ«ï¼Œå¯¹äºç›‘æ§æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ Azure Metric Exporter ä¸»è¦æ˜¯è·å–æŒ‡æ ‡æ•°æ®ã€‚æ ‡å‡†ç‰ˆæä¾›åŸºäº Azure Monitor çš„ç›‘æ§æŒ‡æ ‡ï¼ŒåŸºç¡€ç‰ˆåªæä¾›åŸºäº Azure Log çš„æ—¥å¿—ã€‚æ‰€ä»¥æ— æ³•è·å–åŸºç¡€ç‰ˆçš„ç›‘æ§æŒ‡æ ‡ã€‚å¦å¤–æ–‡æ¡£é‡Œæåˆ°SKU æ˜¯ä¸å¯å˜çš„ï¼Œæ— æ³•æ›´æ”¹ç°æœ‰èµ„æºçš„ SKUã€‚æ‰€ä»¥åªæœ‰è¿ç§»æ‰èƒ½å˜æ›´SKUï¼Œå¦‚æœéœ€è¦å‡çº§å¯ä»¥å‚è€ƒå‡çº§æ–‡æ¡£ã€‚</p><p>SKU å¯¹æ¯”æ–‡æ¡£ï¼š
<a href="https://docs.microsoft.com/zh-cn/azure/load-balancer/skus" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/azure/load-balancer/skus</a></p><p>å‡çº§æ–‡æ¡£ï¼š
<a href="https://docs.microsoft.com/zh-cn/azure/virtual-network/virtual-network-public-ip-address-upgrade?tabs=option-upgrade-powershell%2Coption-migrate-powershell" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/azure/virtual-network/virtual-network-public-ip-address-upgrade?tabs=option-upgrade-powershell%2Coption-migrate-powershell</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">æœ€å<!-- -->ç”± <b>zhengxuexian</b> <!-- -->äº <b><time datetime="2022-08-25T06:04:02.000Z">2022å¹´8æœˆ25æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£åˆ†é¡µå¯¼èˆª"><a class="pagination-nav__link pagination-nav__link--prev" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.4-tencentcloud-metrics"><div class="pagination-nav__sublabel">ä¸Šä¸€é¡µ</div><div class="pagination-nav__label">è…¾è®¯äº‘</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zhengxuexian_blog/ops/prometheus/CCSP/10.6-aws-cloudwatch-2"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label"></div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#åº”ç”¨æ³¨å†Œ" class="table-of-contents__link toc-highlight">åº”ç”¨æ³¨å†Œ</a></li><li><a href="#æˆæƒ" class="table-of-contents__link toc-highlight">æˆæƒ</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/zhengxuexian_blog/assets/js/runtime~main.4da680e9.js"></script>
<script src="/zhengxuexian_blog/assets/js/main.b63cdd20.js"></script>
</body>
</html>