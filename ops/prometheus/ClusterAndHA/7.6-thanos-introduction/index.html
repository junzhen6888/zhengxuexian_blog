<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-ops docs-doc-id-prometheus/ClusterAndHA/7.6-thanos-introduction">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/zhengxuexian_blog/blog/rss.xml" title="zhengxuexian_blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zhengxuexian_blog/blog/atom.xml" title="zhengxuexian_blog Atom Feed"><title data-rh="true">Thanos | zhengxuexian_blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.6-thanos-introduction"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="keywords" content="功能测试, app测试, web测试, api, 接口测试, 自动化测试, python, java, 性能测试, 渗透测试"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-ops-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-ops-current"><meta data-rh="true" property="og:title" content="Thanos | zhengxuexian_blog"><meta data-rh="true" name="description" content="Thanos 是什么，是打了响指灭了一半人类的灭霸吗？不是，在监控领域，Thanos 是 Prometheus 的高可用解决方案，由英国游戏技术公司 Improbable 开源，在 2018 年的 9 月 14 日发布了第一个版本，v0.1.0，到现在已经发布了 v0.23.1。"><meta data-rh="true" property="og:description" content="Thanos 是什么，是打了响指灭了一半人类的灭霸吗？不是，在监控领域，Thanos 是 Prometheus 的高可用解决方案，由英国游戏技术公司 Improbable 开源，在 2018 年的 9 月 14 日发布了第一个版本，v0.1.0，到现在已经发布了 v0.23.1。"><link data-rh="true" rel="icon" href="/zhengxuexian_blog/img/logo.png"><link data-rh="true" rel="canonical" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.6-thanos-introduction"><link data-rh="true" rel="alternate" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.6-thanos-introduction" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://junzhen6888.github.io/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.6-thanos-introduction" hreflang="x-default"><link rel="stylesheet" href="/zhengxuexian_blog/assets/css/styles.5e821d6f.css">
<link rel="preload" href="/zhengxuexian_blog/assets/js/runtime~main.48bcd497.js" as="script">
<link rel="preload" href="/zhengxuexian_blog/assets/js/main.861625e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zhengxuexian_blog/"><b class="navbar__title text--truncate">🛫 测试博客</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🛴 功能测试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/greenhand">新手村</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/flow">测试流程</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/guide">测试规范</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/kbs">测试知识</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/auto">🚚 自动化</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🚑 性能测试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/base">性能基础</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/ctrl">性能监控</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/jmeter">jmeter汇总</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/locust">locust汇总</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">⚔️ 渗透测试</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/kali">kali汇总</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/new">安全入门</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/manage">🧮 测试管理</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">🚌 开发百科</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zhengxuexian_blog/dev">程序语言</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/database">数据库</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zhengxuexian_blog/ops">网络运维</a></li><li><a class="dropdown__link" href="/zhengxuexian_blog/algo">逻辑算法</a></li></ul></div><a class="navbar__item navbar__link" href="/zhengxuexian_blog/tool">⛽ 测试工具</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/zhengxuexian_blog/"><b>🛫 测试博客</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zhengxuexian_blog/ops/">云服务器使用注意事项</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zhengxuexian_blog/ops/category/linux基础">linux基础</a><button aria-label="打开/收起侧边栏菜单「linux基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zhengxuexian_blog/ops/category/docker基础">docker基础</a><button aria-label="打开/收起侧边栏菜单「docker基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zhengxuexian_blog/ops/category/prometheus">prometheus</a><button aria-label="打开/收起侧边栏菜单「prometheus」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Basic/">第一章 认识 Prometheus</a><button aria-label="打开/收起侧边栏菜单「第一章 认识 Prometheus」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Server/">第二章 Prometehus 服务</a><button aria-label="打开/收起侧边栏菜单「第二章 Prometehus 服务」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Exporter/">第三章</a><button aria-label="打开/收起侧边栏菜单「第三章」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/AlarmManager/">README</a><button aria-label="打开/收起侧边栏菜单「README」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/PromQL/">第五章</a><button aria-label="打开/收起侧边栏菜单「第五章」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Instrumenting/grafana-kubernetes-config-persistence">Instrumenting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/">第七章 集群与高可用</a><button aria-label="打开/收起侧边栏菜单「第七章 集群与高可用」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.1-minio-introduction">MinIO 搭建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.10-thanos-compactor">Thanos Compactor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.11-thanos-rule">Thanos Rule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.12-thanos-history-query">Thanos  查询历史数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.13-cortex-introduction">Cortex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.14-kvass-introduction">Kvass</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.15-victoriametrics-introduction">VictoriaMetrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.2-minio-cluster">MinIO 分布式集群搭建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.3-minio-parameter-and-limit">MinIO 参数解析与限制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.4-minio-benchmark">7.4-minio-benchmark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.5-minio-mc-tool">7.5-minio-mc-tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.6-thanos-introduction">Thanos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.7-thanos-query">Thanos Query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.8-thanos-sidecar">Thanos Sidecar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.9-thanos-store">Thanos Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/END">小结</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/ServiceDiscovery/">第八章 服务发现</a><button aria-label="打开/收起侧边栏菜单「第八章 服务发现」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/BestPractices/">第十章  最佳实践</a><button aria-label="打开/收起侧边栏菜单「第十章  最佳实践」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/CCSP/">云计算服务提供商</a><button aria-label="打开/收起侧边栏菜单「云计算服务提供商」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zhengxuexian_blog/ops/prometheus/Troubleshoot/">问题排查</a><button aria-label="打开/收起侧边栏菜单「问题排查」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Thanos</h1><p>Thanos 是什么，是打了响指灭了一半人类的灭霸吗？不是，在监控领域，Thanos 是 Prometheus 的高可用解决方案，由英国游戏技术公司 Improbable 开源，在 2018 年的 9 月 14 日发布了第一个版本，v0.1.0，到现在已经发布了 v0.23.1。</p><p>Thanos 官网主页上简单易懂一段英文介绍如下：Open source, highly available Prometheus setup with long term storage capabilities。开源，高可用性的 Prometheus 设置，并提供长期存储能力。这是对 Thanos 最准确的描述。</p><p>Thanos 以简单且高成本效益的方式，为 Prometheus 提供一个集群，目的是要实现大规模的监控。Thanos目前的核心维护者来自 Polar Signals、红帽和 字节跳动，已经被字节跳动、腾讯、华为、VIVO、eBay 等公司用于生产环境。</p><p>Thanos 很早就进入了 CNCF 的沙盒阶段，在 2020.08.19 通过 TOC 的审核进入 CNCF 的孵化阶段，目前已经稳定发布一年多了，在不久的将来也许就毕业了。</p><p>Thanos 维护者 Frederic Branczyk 提到，Thanos 是一种易于安装的解决方案，可以将用户的 Prometheus 执行个体过渡到具有长期储存功能的监控系统。大多数的 Thanos 都部署在 Kubernetes 上，可用来监控跨多集群与多云的微服务或是基础设施。</p><h1>Thanos 的特点</h1><p>Thanos 在首页就大方的放出了自己的 4 个优点，分别是：</p><ul><li>全局查询</li><li>无限制的存储</li><li>兼容 Prometheus</li><li>数据降准和压缩
其实 Thanos 还有第 5 个优点，那就是高可用集群。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="全局查询">全局查询<a class="hash-link" href="#全局查询" title="标题的直接链接">​</a></h2><p>Thanos 可以跨多个 Prometheus 实例来查询存储的监控指标，这样就实现了 Prometheus 的水平扩展，当单机 Prometheus 性能不足时，通过水平拆分就可以完成扩展 Prometheus 的承载能力。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="无限制存储">无限制存储<a class="hash-link" href="#无限制存储" title="标题的直接链接">​</a></h2><p>Thanos 本身不提供存储，但是它支持多种对象存储系统，使用对象存储来扩容数据存储，以此来无限的存储监控数据，它支持 Google 的 GCP、AWS 的 S3、Azure、Swift、Tencent 的 COS、AliYun 的 OSS。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="兼容-prometheus">兼容 Prometheus<a class="hash-link" href="#兼容-prometheus" title="标题的直接链接">​</a></h2><p>Thanos 完全兼容 Prometheus 的 API 接口，无论你使用 Grafana 或者其他支持 Prometheus API 的工具，使用过程非常丝滑，一点都感觉不到在使用 Thanos ，就像在直接操作 Prometheus 一样。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据降准和压缩">数据降准和压缩<a class="hash-link" href="#数据降准和压缩" title="标题的直接链接">​</a></h2><p>Thanos 会对 Prometheus 的数据进行降准，当查询大时间范围的监控数据或者配置复杂的保留策略时可以加快查询速度，另外也会对实时数据进行压缩，这样可以节省一定的存储空间。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="高可用集群">高可用集群<a class="hash-link" href="#高可用集群" title="标题的直接链接">​</a></h2><p>Thanos 可以针对 Prometheus 提供高可用集群，并且对重复数据进行删除和合并。</p><h1>Thanos 架构</h1><p>Thanos 的架构看起来非常复杂，但是分析以后非常简单。</p><p>Thanos 提供了 Sidecar、Query、Store、Receive、Rule、Compact、Query Frontend、tools 8 个组件，但是构建一个 Thanos 集群最少使用 4 个就可以完成一个简单的集群，最多也只要 6 个组件就可以构建非常复杂的集群。</p><p>这些组件的功能分别是：</p><ul><li>Sidecar： Thanos 的数据上传组件，用来和 Prometheus 通信，并且将 Prometheus 的监控数据上传到对象存储</li><li>Query：Thanos 的查询组件，用来查询监控数据</li><li>Store：Thanos 的数据存储组件，用来和对象存储通信，为对象存储提供数据代理服务。</li><li>Receive：Thanos 的数据收取组件，支持 Prometheus 的远程写功能，对于同一个 Prometheus 实例，只能在 Sidecar 和 Receiver 中间二选一。</li><li>Rule：Thanos 的集中的告警管理组件</li><li>Compactor：Thanos 的数据处理组件，用来将监控数据降准和压缩</li><li>Query Frontend：Thanos 的查询前端</li><li>tools：Thanos 的运维工具，用途很多。</li></ul><p>Thanos 看上去有这么多组件，其实部署的时候只有一个二进制包，搭配不同的参数实现不同的功能，非常方便，比如 Query 组件就是 <code>./thanos query</code> ，Sidecar 组件就是 <code>./thanos sidecar</code> ，所有组件在同一个包里，而且包的体积很小。</p><p>Thanos 集群有两种模式，分别是使用 Sidecar 来进行监控数据上传的边车模式和使用 Receive 来接受数据的收取模式，两种模式只有数据从 Prometheus 到对象存储的方式有区别，其他结构是一样的。</p><p>我们首先来看边车模式：
从数据发生的 Prometheus 看起，Prometheus 在获取数据以后，通过 Sidecar 将数据上传到 对象存储，Store 从对象存储读取数据供其他组件查询，Query 从 Sidecar 获取实时数据、从 Store 获取历史数据对外提供查询功能，Rule 从 Sidecar 和 Store 获取数据进行规则计算，如果触发告警就推送给 AlertManager ，Compactor 对对象存储进行读写，下载数据进行数据降准和压缩，将处理好的数据上传到对象存储，并且删除已经降准过和压缩过的数据。Query Frontend 在 Query 前边提供查询缓存和查询分解的功能。</p><p>接着我们来看收取模式：
对于收取模式，大致的结构和边车模式是一样的，只是没有了 Sidecar 组件，Prometheus 通过远程写功能将数据直接写给 Receive ，Receiver 将数据写给对象存储，Query 查询数据从 Receive 和 Store 获取，Rule 从 Receive 和 Store 获取数据进行规则计算，Store 和 Compacter 的功能不变。</p><p>如果要在一台机器上部署 Thanos 的所有组件，那么可以按照下边的表格来规划端口。</p><table><thead><tr><th>组件</th><th>接口协议</th><th>端口</th></tr></thead><tbody><tr><td>Sidecar</td><td>gRPC</td><td>10901</td></tr><tr><td>Sidecar</td><td>HTTP</td><td>10902</td></tr><tr><td>Query</td><td>gRPC</td><td>10903</td></tr><tr><td>Query</td><td>HTTP</td><td>10904</td></tr><tr><td>Store</td><td>gRPC</td><td>10905</td></tr><tr><td>Store</td><td>HTTP</td><td>10906</td></tr><tr><td>Receive</td><td>gRPC (store API)</td><td>10907</td></tr><tr><td>Receive</td><td>HTTP (remote write API)</td><td>10908</td></tr><tr><td>Receive</td><td>HTTP</td><td>10909</td></tr><tr><td>Rule</td><td>gRPC</td><td>10910</td></tr><tr><td>Rule</td><td>HTTP</td><td>10911</td></tr><tr><td>Compact</td><td>HTTP</td><td>10912</td></tr><tr><td>Query Frontend</td><td>HTTP</td><td>10913</td></tr></tbody></table><p>Component	Interface	Port
Sidecar	gRPC	10901
Sidecar	HTTP	10902
Query	gRPC	10903
Query	HTTP	10904
Store	gRPC	10905
Store	HTTP	10906
Receive	gRPC (store API)	10907
Receive	HTTP (remote write API)	10908
Receive	HTTP	10909
Rule	gRPC	10910
Rule	HTTP	10911
Compact	HTTP	10912
Query Frontend	HTTP	10913</p><h1>发布周期</h1><p>Thanos 的目标是每 6 周发布一个版本，这个是要严格执行的，如果没有紧急的 BUG 修复，那么等待一个多月就会有新的版本发布。不过最近好像有点延期。</p><p>在 2021.09.02 发布了 v0.23.0 ，按照计划，应该在 2021.10.28 发布 v0.24.0 ，在 2021.12.09 发布 v0.25.0 ，不过显然他们迟到了，现在只发布到了 v0.24.0-rc.1 ，距离 v0.24.0 快了，不过 v0.25.0 要再等一个多月了。</p><p>对于版本发布，Thanos 会在主分支上进行发布，每次都会有一个成员来负责这个版本的发布，包括从第一个 RC 版本到最终的正式版本，以及在所有的渠道上进行发布。</p><p>这次我们先有一个大概的了解，接下来，我们继续深入 Thanos 集群。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>zhengxuexian</b> <!-- -->于 <b><time datetime="2022-09-01T10:07:45.000Z">2022年9月1日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.5-minio-mc-tool"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">7.5-minio-mc-tool</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zhengxuexian_blog/ops/prometheus/ClusterAndHA/7.7-thanos-query"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Thanos Query</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#全局查询" class="table-of-contents__link toc-highlight">全局查询</a></li><li><a href="#无限制存储" class="table-of-contents__link toc-highlight">无限制存储</a></li><li><a href="#兼容-prometheus" class="table-of-contents__link toc-highlight">兼容 Prometheus</a></li><li><a href="#数据降准和压缩" class="table-of-contents__link toc-highlight">数据降准和压缩</a></li><li><a href="#高可用集群" class="table-of-contents__link toc-highlight">高可用集群</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/zhengxuexian_blog/assets/js/runtime~main.48bcd497.js"></script>
<script src="/zhengxuexian_blog/assets/js/main.861625e8.js"></script>
</body>
</html>